import{j as e,c as t}from"./three-fmD8HeMe.js";import{r as s,b as i,R as a}from"./vendor-DxKjgnCq.js";import{D as n}from"./discord-DbY_imvY.js";import{m as r,u as o,A as c}from"./ui-D6oc6lcc.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var l=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},h="undefined"==typeof window||"Deno"in globalThis;function d(){}function u(e,t){return"function"==typeof e?e(t):e}function m(e,t){const{type:s="all",exact:i,fetchStatus:a,predicate:n,queryKey:r,stale:o}=e;if(r)if(i){if(t.queryHash!==f(r,t.options))return!1}else if(!y(t.queryKey,r))return!1;if("all"!==s){const e=t.isActive();if("active"===s&&!e)return!1;if("inactive"===s&&e)return!1}return("boolean"!=typeof o||t.isStale()===o)&&((!a||a===t.state.fetchStatus)&&!(n&&!n(t)))}function p(e,t){const{exact:s,status:i,predicate:a,mutationKey:n}=e;if(n){if(!t.options.mutationKey)return!1;if(s){if(x(t.options.mutationKey)!==x(n))return!1}else if(!y(t.options.mutationKey,n))return!1}return(!i||t.state.status===i)&&!(a&&!a(t))}function f(e,t){return(t?.queryKeyHashFn||x)(e)}function x(e){return JSON.stringify(e,(e,t)=>v(t)?Object.keys(t).sort().reduce((e,s)=>(e[s]=t[s],e),{}):t)}function y(e,t){return e===t||typeof e==typeof t&&(!(!e||!t||"object"!=typeof e||"object"!=typeof t)&&Object.keys(t).every(s=>y(e[s],t[s])))}function g(e,t){if(e===t)return e;const s=b(e)&&b(t);if(s||v(e)&&v(t)){const i=s?e:Object.keys(e),a=i.length,n=s?t:Object.keys(t),r=n.length,o=s?[]:{},c=new Set(i);let l=0;for(let h=0;h<r;h++){const i=s?h:n[h];(!s&&c.has(i)||s)&&void 0===e[i]&&void 0===t[i]?(o[i]=void 0,l++):(o[i]=g(e[i],t[i]),o[i]===e[i]&&void 0!==e[i]&&l++)}return a===r&&l===a?e:o}return t}function b(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function v(e){if(!w(e))return!1;const t=e.constructor;if(void 0===t)return!0;const s=t.prototype;return!!w(s)&&(!!s.hasOwnProperty("isPrototypeOf")&&Object.getPrototypeOf(e)===Object.prototype)}function w(e){return"[object Object]"===Object.prototype.toString.call(e)}function j(e,t,s){return"function"==typeof s.structuralSharing?s.structuralSharing(e,t):!1!==s.structuralSharing?g(e,t):t}function S(e,t,s=0){const i=[...e,t];return s&&i.length>s?i.slice(1):i}function N(e,t,s=0){const i=[t,...e];return s&&i.length>s?i.slice(0,-1):i}var k=Symbol();function M(e,t){return!e.queryFn&&t?.initialPromise?()=>t.initialPromise:e.queryFn&&e.queryFn!==k?e.queryFn:()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`))}var C=new class extends l{#e;#t;#s;constructor(){super(),this.#s=e=>{if(!h&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#s=e,this.#t?.(),this.#t=e(e=>{"boolean"==typeof e?this.setFocused(e):this.onFocus()})}setFocused(e){this.#e!==e&&(this.#e=e,this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){return"boolean"==typeof this.#e?this.#e:"hidden"!==globalThis.document?.visibilityState}},A=new class extends l{#i=!0;#t;#s;constructor(){super(),this.#s=e=>{if(!h&&window.addEventListener){const t=()=>e(!0),s=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",s)}}}}onSubscribe(){this.#t||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#s=e,this.#t?.(),this.#t=e(this.setOnline.bind(this))}setOnline(e){this.#i!==e&&(this.#i=e,this.listeners.forEach(t=>{t(e)}))}isOnline(){return this.#i}};function T(e){return Math.min(1e3*2**e,3e4)}function P(e){return"online"!==(e??"online")||A.isOnline()}var _=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function E(e){return e instanceof _}function B(e){let t,s=!1,i=0,a=!1;const n=function(){let e,t;const s=new Promise((s,i)=>{e=s,t=i});function i(e){Object.assign(s,e),delete s.resolve,delete s.reject}return s.status="pending",s.catch(()=>{}),s.resolve=t=>{i({status:"fulfilled",value:t}),e(t)},s.reject=e=>{i({status:"rejected",reason:e}),t(e)},s}(),r=()=>C.isFocused()&&("always"===e.networkMode||A.isOnline())&&e.canRun(),o=()=>P(e.networkMode)&&e.canRun(),c=s=>{a||(a=!0,e.onSuccess?.(s),t?.(),n.resolve(s))},l=s=>{a||(a=!0,e.onError?.(s),t?.(),n.reject(s))},d=()=>new Promise(s=>{t=e=>{(a||r())&&s(e)},e.onPause?.()}).then(()=>{t=void 0,a||e.onContinue?.()}),u=()=>{if(a)return;let t;const n=0===i?e.initialPromise:void 0;try{t=n??e.fn()}catch(o){t=Promise.reject(o)}Promise.resolve(t).then(c).catch(t=>{if(a)return;const n=e.retry??(h?0:3),o=e.retryDelay??T,c="function"==typeof o?o(i,t):o,m=!0===n||"number"==typeof n&&i<n||"function"==typeof n&&n(i,t);var p;!s&&m?(i++,e.onFail?.(i,t),(p=c,new Promise(e=>{setTimeout(e,p)})).then(()=>r()?void 0:d()).then(()=>{s?l(t):u()})):l(t)})};return{promise:n,cancel:t=>{a||(l(new _(t)),e.abort?.())},continue:()=>(t?.(),n),cancelRetry:()=>{s=!0},continueRetry:()=>{s=!1},canStart:o,start:()=>(o()?u():d().then(u),n)}}var D=e=>setTimeout(e,0);var R=function(){let e=[],t=0,s=e=>{e()},i=e=>{e()},a=D;const n=i=>{t?e.push(i):a(()=>{s(i)})};return{batch:n=>{let r;t++;try{r=n()}finally{t--,t||(()=>{const t=e;e=[],t.length&&a(()=>{i(()=>{t.forEach(e=>{s(e)})})})})()}return r},batchCalls:e=>(...t)=>{n(()=>{e(...t)})},schedule:n,setNotifyFunction:e=>{s=e},setBatchNotifyFunction:e=>{i=e},setScheduler:e=>{a=e}}}(),O=class{#a;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),function(e){return"number"==typeof e&&e>=0&&e!==1/0}(this.gcTime)&&(this.#a=setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(h?1/0:3e5))}clearGcTimeout(){this.#a&&(clearTimeout(this.#a),this.#a=void 0)}},L=class extends O{#n;#r;#o;#c;#l;#h;#d;constructor(e){super(),this.#d=!1,this.#h=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#c=e.client,this.#o=this.#c.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#n=function(e){const t="function"==typeof e.initialData?e.initialData():e.initialData,s=void 0!==t,i=s?"function"==typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:s?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:s?"success":"pending",fetchStatus:"idle"}}(this.options),this.state=e.state??this.#n,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#l?.promise}setOptions(e){this.options={...this.#h,...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){this.observers.length||"idle"!==this.state.fetchStatus||this.#o.remove(this)}setData(e,t){const s=j(this.state.data,e,this.options);return this.#u({data:s,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),s}setState(e,t){this.#u({type:"setState",state:e,setStateOptions:t})}cancel(e){const t=this.#l?.promise;return this.#l?.cancel(e),t?t.then(d).catch(d):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#n)}isActive(){return this.observers.some(e=>{return!1!==(t=e.options.enabled,s=this,"function"==typeof t?t(s):t);var t,s})}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===k||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0&&this.observers.some(e=>"static"===u(e.options.staleTime,this))}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):void 0===this.state.data||this.state.isInvalidated}isStaleByTime(e=0){return void 0===this.state.data||"static"!==e&&(!!this.state.isInvalidated||!function(e,t){return Math.max(e+(t||0)-Date.now(),0)}(this.state.dataUpdatedAt,e))}onFocus(){const e=this.observers.find(e=>e.shouldFetchOnWindowFocus());e?.refetch({cancelRefetch:!1}),this.#l?.continue()}onOnline(){const e=this.observers.find(e=>e.shouldFetchOnReconnect());e?.refetch({cancelRefetch:!1}),this.#l?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#o.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(this.#l&&(this.#d?this.#l.cancel({revert:!0}):this.#l.cancelRetry()),this.scheduleGc()),this.#o.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#u({type:"invalidate"})}fetch(e,t){if("idle"!==this.state.fetchStatus)if(void 0!==this.state.data&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#l)return this.#l.continueRetry(),this.#l.promise;if(e&&this.setOptions(e),!this.options.queryFn){const e=this.observers.find(e=>e.options.queryFn);e&&this.setOptions(e.options)}const s=new AbortController,i=e=>{Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(this.#d=!0,s.signal)})},a=()=>{const e=M(this.options,t),s=(()=>{const e={client:this.#c,queryKey:this.queryKey,meta:this.meta};return i(e),e})();return this.#d=!1,this.options.persister?this.options.persister(e,s,this):e(s)},n=(()=>{const e={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:this.#c,state:this.state,fetchFn:a};return i(e),e})();this.options.behavior?.onFetch(n,this),this.#r=this.state,"idle"!==this.state.fetchStatus&&this.state.fetchMeta===n.fetchOptions?.meta||this.#u({type:"fetch",meta:n.fetchOptions?.meta});const r=e=>{E(e)&&e.silent||this.#u({type:"error",error:e}),E(e)||(this.#o.config.onError?.(e,this),this.#o.config.onSettled?.(this.state.data,e,this)),this.scheduleGc()};return this.#l=B({initialPromise:t?.initialPromise,fn:n.fetchFn,abort:s.abort.bind(s),onSuccess:e=>{if(void 0!==e){try{this.setData(e)}catch(t){return void r(t)}this.#o.config.onSuccess?.(e,this),this.#o.config.onSettled?.(e,this.state.error,this),this.scheduleGc()}else r(new Error(`${this.queryHash} data is undefined`))},onError:r,onFail:(e,t)=>{this.#u({type:"failed",failureCount:e,error:t})},onPause:()=>{this.#u({type:"pause"})},onContinue:()=>{this.#u({type:"continue"})},retry:n.options.retry,retryDelay:n.options.retryDelay,networkMode:n.options.networkMode,canRun:()=>!0}),this.#l.start()}#u(e){this.state=(t=>{switch(e.type){case"failed":return{...t,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...t,fetchStatus:"paused"};case"continue":return{...t,fetchStatus:"fetching"};case"fetch":return{...t,...(s=t.data,i=this.options,{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:P(i.networkMode)?"fetching":"paused",...void 0===s&&{error:null,status:"pending"}}),fetchMeta:e.meta??null};case"success":return this.#r=void 0,{...t,data:e.data,dataUpdateCount:t.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const a=e.error;return E(a)&&a.revert&&this.#r?{...this.#r,fetchStatus:"idle"}:{...t,error:a,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:a,fetchStatus:"idle",status:"error"};case"invalidate":return{...t,isInvalidated:!0};case"setState":return{...t,...e.state}}var s,i})(this.state),R.batch(()=>{this.observers.forEach(e=>{e.onQueryUpdate()}),this.#o.notify({query:this,type:"updated",action:e})})}};var I=class extends l{constructor(e={}){super(),this.config=e,this.#m=new Map}#m;build(e,t,s){const i=t.queryKey,a=t.queryHash??f(i,t);let n=this.get(a);return n||(n=new L({client:e,queryKey:i,queryHash:a,options:e.defaultQueryOptions(t),state:s,defaultOptions:e.getQueryDefaults(i)}),this.add(n)),n}add(e){this.#m.has(e.queryHash)||(this.#m.set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=this.#m.get(e.queryHash);t&&(e.destroy(),t===e&&this.#m.delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){R.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return this.#m.get(e)}getAll(){return[...this.#m.values()]}find(e){const t={exact:!0,...e};return this.getAll().find(e=>m(t,e))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(t=>m(e,t)):t}notify(e){R.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){R.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){R.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},z=class extends O{#p;#f;#l;constructor(e){super(),this.mutationId=e.mutationId,this.#f=e.mutationCache,this.#p=[],this.state=e.state||{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0},this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#p.includes(e)||(this.#p.push(e),this.clearGcTimeout(),this.#f.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#p=this.#p.filter(t=>t!==e),this.scheduleGc(),this.#f.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#p.length||("pending"===this.state.status?this.scheduleGc():this.#f.remove(this))}continue(){return this.#l?.continue()??this.execute(this.state.variables)}async execute(e){const t=()=>{this.#u({type:"continue"})};this.#l=B({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(e,t)=>{this.#u({type:"failed",failureCount:e,error:t})},onPause:()=>{this.#u({type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#f.canRun(this)});const s="pending"===this.state.status,i=!this.#l.canStart();try{if(s)t();else{this.#u({type:"pending",variables:e,isPaused:i}),await(this.#f.config.onMutate?.(e,this));const t=await(this.options.onMutate?.(e));t!==this.state.context&&this.#u({type:"pending",context:t,variables:e,isPaused:i})}const a=await this.#l.start();return await(this.#f.config.onSuccess?.(a,e,this.state.context,this)),await(this.options.onSuccess?.(a,e,this.state.context)),await(this.#f.config.onSettled?.(a,null,this.state.variables,this.state.context,this)),await(this.options.onSettled?.(a,null,e,this.state.context)),this.#u({type:"success",data:a}),a}catch(a){try{throw await(this.#f.config.onError?.(a,e,this.state.context,this)),await(this.options.onError?.(a,e,this.state.context)),await(this.#f.config.onSettled?.(void 0,a,this.state.variables,this.state.context,this)),await(this.options.onSettled?.(void 0,a,e,this.state.context)),a}finally{this.#u({type:"error",error:a})}}finally{this.#f.runNext(this)}}#u(e){this.state=(t=>{switch(e.type){case"failed":return{...t,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...t,isPaused:!0};case"continue":return{...t,isPaused:!1};case"pending":return{...t,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...t,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...t,data:void 0,error:e.error,failureCount:t.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}})(this.state),R.batch(()=>{this.#p.forEach(t=>{t.onMutationUpdate(e)}),this.#f.notify({mutation:this,type:"updated",action:e})})}};var U=class extends l{constructor(e={}){super(),this.config=e,this.#x=new Set,this.#y=new Map,this.#g=0}#x;#y;#g;build(e,t,s){const i=new z({mutationCache:this,mutationId:++this.#g,options:e.defaultMutationOptions(t),state:s});return this.add(i),i}add(e){this.#x.add(e);const t=F(e);if("string"==typeof t){const s=this.#y.get(t);s?s.push(e):this.#y.set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(this.#x.delete(e)){const t=F(e);if("string"==typeof t){const s=this.#y.get(t);if(s)if(s.length>1){const t=s.indexOf(e);-1!==t&&s.splice(t,1)}else s[0]===e&&this.#y.delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=F(e);if("string"==typeof t){const s=this.#y.get(t),i=s?.find(e=>"pending"===e.state.status);return!i||i===e}return!0}runNext(e){const t=F(e);if("string"==typeof t){const s=this.#y.get(t)?.find(t=>t!==e&&t.state.isPaused);return s?.continue()??Promise.resolve()}return Promise.resolve()}clear(){R.batch(()=>{this.#x.forEach(e=>{this.notify({type:"removed",mutation:e})}),this.#x.clear(),this.#y.clear()})}getAll(){return Array.from(this.#x)}find(e){const t={exact:!0,...e};return this.getAll().find(e=>p(t,e))}findAll(e={}){return this.getAll().filter(t=>p(e,t))}notify(e){R.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(e=>e.state.isPaused);return R.batch(()=>Promise.all(e.map(e=>e.continue().catch(d))))}};function F(e){return e.options.scope?.id}function q(e){return{onFetch:(t,s)=>{const i=t.options,a=t.fetchOptions?.meta?.fetchMore?.direction,n=t.state.data?.pages||[],r=t.state.data?.pageParams||[];let o={pages:[],pageParams:[]},c=0;const l=async()=>{let s=!1;const l=M(t.options,t.fetchOptions),h=async(e,i,a)=>{if(s)return Promise.reject();if(null==i&&e.pages.length)return Promise.resolve(e);const n=(()=>{const e={client:t.client,queryKey:t.queryKey,pageParam:i,direction:a?"backward":"forward",meta:t.options.meta};var n;return n=e,Object.defineProperty(n,"signal",{enumerable:!0,get:()=>(t.signal.aborted?s=!0:t.signal.addEventListener("abort",()=>{s=!0}),t.signal)}),e})(),r=await l(n),{maxPages:o}=t.options,c=a?N:S;return{pages:c(e.pages,r,o),pageParams:c(e.pageParams,i,o)}};if(a&&n.length){const e="backward"===a,t={pages:n,pageParams:r},s=(e?$:H)(i,t);o=await h(t,s,e)}else{const t=e??n.length;do{const e=0===c?r[0]??i.initialPageParam:H(i,o);if(c>0&&null==e)break;o=await h(o,e),c++}while(c<t)}return o};t.options.persister?t.fetchFn=()=>t.options.persister?.(l,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},s):t.fetchFn=l}}}function H(e,{pages:t,pageParams:s}){const i=t.length-1;return t.length>0?e.getNextPageParam(t[i],t,s[i],s):void 0}function $(e,{pages:t,pageParams:s}){return t.length>0?e.getPreviousPageParam?.(t[0],t,s[0],s):void 0}var G,W,V=s.createContext(void 0),K=({client:t,children:i})=>(s.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),e.jsx(V.Provider,{value:t,children:i}));
/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */
function Q(){return Q=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},Q.apply(this,arguments)}(W=G||(G={})).Pop="POP",W.Push="PUSH",W.Replace="REPLACE";const Y="popstate";function J(e){return void 0===e&&(e={}),function(e,t,s,i){void 0===i&&(i={});let{window:a=document.defaultView,v5Compat:n=!1}=i,r=a.history,o=G.Pop,c=null,l=h();null==l&&(l=0,r.replaceState(Q({},r.state,{idx:l}),""));function h(){return(r.state||{idx:null}).idx}function d(){o=G.Pop;let e=h(),t=null==e?null:e-l;l=e,c&&c({action:o,location:f.location,delta:t})}function u(e,t){o=G.Push;let s=te(f.location,e,t);l=h()+1;let i=ee(s,l),d=f.createHref(s);try{r.pushState(i,"",d)}catch(u){if(u instanceof DOMException&&"DataCloneError"===u.name)throw u;a.location.assign(d)}n&&c&&c({action:o,location:f.location,delta:1})}function m(e,t){o=G.Replace;let s=te(f.location,e,t);l=h();let i=ee(s,l),a=f.createHref(s);r.replaceState(i,"",a),n&&c&&c({action:o,location:f.location,delta:0})}function p(e){let t="null"!==a.location.origin?a.location.origin:a.location.href,s="string"==typeof e?e:se(e);return s=s.replace(/ $/,"%20"),X(t,"No window.location.(origin|href) available to create URL for href: "+s),new URL(s,t)}let f={get action(){return o},get location(){return e(a,r)},listen(e){if(c)throw new Error("A history only accepts one active listener");return a.addEventListener(Y,d),c=e,()=>{a.removeEventListener(Y,d),c=null}},createHref:e=>t(a,e),createURL:p,encodeLocation(e){let t=p(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:u,replace:m,go:e=>r.go(e)};return f}(function(e,t){let{pathname:s,search:i,hash:a}=e.location;return te("",{pathname:s,search:i,hash:a},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"==typeof t?t:se(t)},0,e)}function X(e,t){if(!1===e||null==e)throw new Error(t)}function Z(e,t){if(!e)try{throw new Error(t)}catch(ct){}}function ee(e,t){return{usr:e.state,key:e.key,idx:t}}function te(e,t,s,i){return void 0===s&&(s=null),Q({pathname:"string"==typeof e?e:e.pathname,search:"",hash:""},"string"==typeof t?ie(t):t,{state:s,key:t&&t.key||i||Math.random().toString(36).substr(2,8)})}function se(e){let{pathname:t="/",search:s="",hash:i=""}=e;return s&&"?"!==s&&(t+="?"===s.charAt(0)?s:"?"+s),i&&"#"!==i&&(t+="#"===i.charAt(0)?i:"#"+i),t}function ie(e){let t={};if(e){let s=e.indexOf("#");s>=0&&(t.hash=e.substr(s),e=e.substr(0,s));let i=e.indexOf("?");i>=0&&(t.search=e.substr(i),e=e.substr(0,i)),e&&(t.pathname=e)}return t}var ae,ne;function re(e,t,s){return void 0===s&&(s="/"),function(e,t,s){let i="string"==typeof t?ie(t):t,a=ve(i.pathname||"/",s);if(null==a)return null;let n=oe(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let s=e.length===t.length&&e.slice(0,-1).every((e,s)=>e===t[s]);return s?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(n);let r=null;for(let o=0;null==r&&o<n.length;++o){let e=be(a);r=ye(n[o],e)}return r}(e,t,s)}function oe(e,t,s,i){void 0===t&&(t=[]),void 0===s&&(s=[]),void 0===i&&(i="");let a=(e,a,n)=>{let r={relativePath:void 0===n?e.path||"":n,caseSensitive:!0===e.caseSensitive,childrenIndex:a,route:e};r.relativePath.startsWith("/")&&(X(r.relativePath.startsWith(i),'Absolute route path "'+r.relativePath+'" nested under path "'+i+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),r.relativePath=r.relativePath.slice(i.length));let o=Se([i,r.relativePath]),c=s.concat(r);e.children&&e.children.length>0&&(X(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),oe(e.children,t,c,o)),(null!=e.path||e.index)&&t.push({path:o,score:xe(o,e.index),routesMeta:c})};return e.forEach((e,t)=>{var s;if(""!==e.path&&null!=(s=e.path)&&s.includes("?"))for(let i of ce(e.path))a(e,t,i);else a(e,t)}),t}function ce(e){let t=e.split("/");if(0===t.length)return[];let[s,...i]=t,a=s.endsWith("?"),n=s.replace(/\?$/,"");if(0===i.length)return a?[n,""]:[n];let r=ce(i.join("/")),o=[];return o.push(...r.map(e=>""===e?n:[n,e].join("/"))),a&&o.push(...r),o.map(t=>e.startsWith("/")&&""===t?"/":t)}(ne=ae||(ae={})).data="data",ne.deferred="deferred",ne.redirect="redirect",ne.error="error";const le=/^:[\w-]+$/,he=3,de=2,ue=1,me=10,pe=-2,fe=e=>"*"===e;function xe(e,t){let s=e.split("/"),i=s.length;return s.some(fe)&&(i+=pe),t&&(i+=de),s.filter(e=>!fe(e)).reduce((e,t)=>e+(le.test(t)?he:""===t?ue:me),i)}function ye(e,t,s){let{routesMeta:i}=e,a={},n="/",r=[];for(let o=0;o<i.length;++o){let e=i[o],s=o===i.length-1,c="/"===n?t:t.slice(n.length)||"/",l=ge({path:e.relativePath,caseSensitive:e.caseSensitive,end:s},c),h=e.route;if(!l)return null;Object.assign(a,l.params),r.push({params:a,pathname:Se([n,l.pathname]),pathnameBase:Ne(Se([n,l.pathnameBase])),route:h}),"/"!==l.pathnameBase&&(n=Se([n,l.pathnameBase]))}return r}function ge(e,t){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[s,i]=function(e,t,s){void 0===t&&(t=!1);void 0===s&&(s=!0);Z("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let i=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,s)=>(i.push({paramName:t,isOptional:null!=s}),s?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(i.push({paramName:"*"}),a+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?a+="\\/*$":""!==e&&"/"!==e&&(a+="(?:(?=\\/|$))");let n=new RegExp(a,t?void 0:"i");return[n,i]}(e.path,e.caseSensitive,e.end),a=t.match(s);if(!a)return null;let n=a[0],r=n.replace(/(.)\/+$/,"$1"),o=a.slice(1),c=i.reduce((e,t,s)=>{let{paramName:i,isOptional:a}=t;if("*"===i){let e=o[s]||"";r=n.slice(0,n.length-e.length).replace(/(.)\/+$/,"$1")}const c=o[s];return e[i]=a&&!c?void 0:(c||"").replace(/%2F/g,"/"),e},{});return{params:c,pathname:n,pathnameBase:r,pattern:e}}function be(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return Z(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function ve(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,i=e.charAt(s);return i&&"/"!==i?null:e.slice(s)||"/"}function we(e,t,s,i){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(i)+"].  Please separate it out to the `to."+s+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function je(e,t,s,i){let a;void 0===i&&(i=!1),"string"==typeof e?a=ie(e):(a=Q({},e),X(!a.pathname||!a.pathname.includes("?"),we("?","pathname","search",a)),X(!a.pathname||!a.pathname.includes("#"),we("#","pathname","hash",a)),X(!a.search||!a.search.includes("#"),we("#","search","hash",a)));let n,r=""===e||""===a.pathname,o=r?"/":a.pathname;if(null==o)n=s;else{let e=t.length-1;if(!i&&o.startsWith("..")){let t=o.split("/");for(;".."===t[0];)t.shift(),e-=1;a.pathname=t.join("/")}n=e>=0?t[e]:"/"}let c=function(e,t){void 0===t&&(t="/");let{pathname:s,search:i="",hash:a=""}="string"==typeof e?ie(e):e,n=s?s.startsWith("/")?s:function(e,t){let s=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?s.length>1&&s.pop():"."!==e&&s.push(e)}),s.length>1?s.join("/"):"/"}(s,t):t;return{pathname:n,search:ke(i),hash:Me(a)}}(a,n),l=o&&"/"!==o&&o.endsWith("/"),h=(r||"."===o)&&s.endsWith("/");return c.pathname.endsWith("/")||!l&&!h||(c.pathname+="/"),c}const Se=e=>e.join("/").replace(/\/\/+/g,"/"),Ne=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),ke=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",Me=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";const Ce=["post","put","patch","delete"];new Set(Ce);const Ae=["get",...Ce];
/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */
function Te(){return Te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},Te.apply(this,arguments)}new Set(Ae);const Pe=s.createContext(null),_e=s.createContext(null),Ee=s.createContext(null),Be=s.createContext(null),De=s.createContext({outlet:null,matches:[],isDataRoute:!1}),Re=s.createContext(null);function Oe(){return null!=s.useContext(Be)}function Le(){return Oe()||X(!1),s.useContext(Be).location}function Ie(e){s.useContext(Ee).static||s.useLayoutEffect(e)}function ze(){let{isDataRoute:e}=s.useContext(De);return e?function(){let{router:e}=function(){let e=s.useContext(Pe);return e||X(!1),e}(Ge.UseNavigateStable),t=Ve(We.UseNavigateStable),i=s.useRef(!1);return Ie(()=>{i.current=!0}),s.useCallback(function(s,a){void 0===a&&(a={}),i.current&&("number"==typeof s?e.navigate(s):e.navigate(s,Te({fromRouteId:t},a)))},[e,t])}():function(){Oe()||X(!1);let e=s.useContext(Pe),{basename:t,future:i,navigator:a}=s.useContext(Ee),{matches:n}=s.useContext(De),{pathname:r}=Le(),o=JSON.stringify(function(e,t){let s=function(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}(e);return t?s.map((e,t)=>t===s.length-1?e.pathname:e.pathnameBase):s.map(e=>e.pathnameBase)}(n,i.v7_relativeSplatPath)),c=s.useRef(!1);return Ie(()=>{c.current=!0}),s.useCallback(function(s,i){if(void 0===i&&(i={}),!c.current)return;if("number"==typeof s)return void a.go(s);let n=je(s,JSON.parse(o),r,"path"===i.relative);null==e&&"/"!==t&&(n.pathname="/"===n.pathname?t:Se([t,n.pathname])),(i.replace?a.replace:a.push)(n,i.state,i)},[t,a,o,r,e])}()}function Ue(e,t){return function(e,t,i,a){Oe()||X(!1);let{navigator:n}=s.useContext(Ee),{matches:r}=s.useContext(De),o=r[r.length-1],c=o?o.params:{};!o||o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let h,d=Le();if(t){var u;let e="string"==typeof t?ie(t):t;"/"===l||(null==(u=e.pathname)?void 0:u.startsWith(l))||X(!1),h=e}else h=d;let m=h.pathname||"/",p=m;if("/"!==l){let e=l.replace(/^\//,"").split("/");p="/"+m.replace(/^\//,"").split("/").slice(e.length).join("/")}let f=re(e,{pathname:p}),x=function(e,t,i,a){var n;void 0===t&&(t=[]);void 0===i&&(i=null);void 0===a&&(a=null);if(null==e){var r;if(!i)return null;if(i.errors)e=i.matches;else{if(!(null!=(r=a)&&r.v7_partialHydration&&0===t.length&&!i.initialized&&i.matches.length>0))return null;e=i.matches}}let o=e,c=null==(n=i)?void 0:n.errors;if(null!=c){let e=o.findIndex(e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id]));e>=0||X(!1),o=o.slice(0,Math.min(o.length,e+1))}let l=!1,h=-1;if(i&&a&&a.v7_partialHydration)for(let s=0;s<o.length;s++){let e=o[s];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(h=s),e.route.id){let{loaderData:t,errors:s}=i,a=e.route.loader&&void 0===t[e.route.id]&&(!s||void 0===s[e.route.id]);if(e.route.lazy||a){l=!0,o=h>=0?o.slice(0,h+1):[o[0]];break}}}return o.reduceRight((e,a,n)=>{let r,d=!1,u=null,m=null;var p;i&&(r=c&&a.route.id?c[a.route.id]:void 0,u=a.route.errorElement||qe,l&&(h<0&&0===n?(Ke[p="route-fallback"]||(Ke[p]=!0),d=!0,m=null):h===n&&(d=!0,m=a.route.hydrateFallbackElement||null)));let f=t.concat(o.slice(0,n+1)),x=()=>{let t;return t=r?u:d?m:a.route.Component?s.createElement(a.route.Component,null):a.route.element?a.route.element:e,s.createElement($e,{match:a,routeContext:{outlet:e,matches:f,isDataRoute:null!=i},children:t})};return i&&(a.route.ErrorBoundary||a.route.errorElement||0===n)?s.createElement(He,{location:i.location,revalidation:i.revalidation,component:u,error:r,children:x(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):x()},null)}(f&&f.map(e=>Object.assign({},e,{params:Object.assign({},c,e.params),pathname:Se([l,n.encodeLocation?n.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?l:Se([l,n.encodeLocation?n.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),r,i,a);if(t&&x)return s.createElement(Be.Provider,{value:{location:Te({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:G.Pop}},x);return x}(e,t)}function Fe(){let e=function(){var e;let t=s.useContext(Re),i=function(){let e=s.useContext(_e);return e||X(!1),e}(),a=Ve();if(void 0!==t)return t;return null==(e=i.errors)?void 0:e[a]}(),t=function(e){return null!=e&&"number"==typeof e.status&&"string"==typeof e.statusText&&"boolean"==typeof e.internal&&"data"in e}(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,a={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return s.createElement(s.Fragment,null,s.createElement("h2",null,"Unexpected Application Error!"),s.createElement("h3",{style:{fontStyle:"italic"}},t),i?s.createElement("pre",{style:a},i):null,null)}const qe=s.createElement(Fe,null);class He extends s.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){}render(){return void 0!==this.state.error?s.createElement(De.Provider,{value:this.props.routeContext},s.createElement(Re.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function $e(e){let{routeContext:t,match:i,children:a}=e,n=s.useContext(Pe);return n&&n.static&&n.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=i.route.id),s.createElement(De.Provider,{value:t},a)}var Ge=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(Ge||{}),We=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(We||{});function Ve(e){let t=function(){let e=s.useContext(De);return e||X(!1),e}(),i=t.matches[t.matches.length-1];return i.route.id||X(!1),i.route.id}const Ke={};function Qe(e){X(!1)}function Ye(e){let{basename:t="/",children:i=null,location:a,navigationType:n=G.Pop,navigator:r,static:o=!1,future:c}=e;Oe()&&X(!1);let l=t.replace(/^\/*/,"/"),h=s.useMemo(()=>({basename:l,navigator:r,static:o,future:Te({v7_relativeSplatPath:!1},c)}),[l,c,r,o]);"string"==typeof a&&(a=ie(a));let{pathname:d="/",search:u="",hash:m="",state:p=null,key:f="default"}=a,x=s.useMemo(()=>{let e=ve(d,l);return null==e?null:{location:{pathname:e,search:u,hash:m,state:p,key:f},navigationType:n}},[l,d,u,m,p,f,n]);return null==x?null:s.createElement(Ee.Provider,{value:h},s.createElement(Be.Provider,{children:i,value:x}))}function Je(e){let{children:t,location:s}=e;return Ue(Xe(t),s)}function Xe(e,t){void 0===t&&(t=[]);let i=[];return s.Children.forEach(e,(e,a)=>{if(!s.isValidElement(e))return;let n=[...t,a];if(e.type===s.Fragment)return void i.push.apply(i,Xe(e.props.children,n));e.type!==Qe&&X(!1),e.props.index&&e.props.children&&X(!1);let r={id:e.props.id||n.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(r.children=Xe(e.props.children,n)),i.push(r)}),i}
/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */new Promise(()=>{});try{window.__reactRouterVersion="6"}catch(ct){}const Ze=i.startTransition;function et(e){let{basename:t,children:i,future:a,window:n}=e,r=s.useRef();null==r.current&&(r.current=J({window:n,v5Compat:!0}));let o=r.current,[c,l]=s.useState({action:o.action,location:o.location}),{v7_startTransition:h}=a||{},d=s.useCallback(e=>{h&&Ze?Ze(()=>l(e)):l(e)},[l,h]);return s.useLayoutEffect(()=>o.listen(d),[o,d]),s.useEffect(()=>{return null==(e=a)||e.v7_startTransition,void(null==e||e.v7_relativeSplatPath);var e},[a]),s.createElement(Ye,{basename:t,children:i,location:c.location,navigationType:c.action,navigator:o,future:a})}var tt,st,it,at;(st=tt||(tt={})).UseScrollRestoration="useScrollRestoration",st.UseSubmit="useSubmit",st.UseSubmitFetcher="useSubmitFetcher",st.UseFetcher="useFetcher",st.useViewTransitionState="useViewTransitionState",(at=it||(it={})).UseFetcher="useFetcher",at.UseFetchers="useFetchers",at.UseScrollRestoration="useScrollRestoration";let nt,rt,ot,ct={data:""},lt=e=>"object"==typeof window?((e?e.querySelector("#_goober"):window._goober)||Object.assign((e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:e||ct,ht=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,dt=/\/\*[^]*?\*\/|  +/g,ut=/\n+/g,mt=(e,t)=>{let s="",i="",a="";for(let n in e){let r=e[n];"@"==n[0]?"i"==n[1]?s=n+" "+r+";":i+="f"==n[1]?mt(r,n):n+"{"+mt(r,"k"==n[1]?"":t)+"}":"object"==typeof r?i+=mt(r,t?t.replace(/([^,])+/g,e=>n.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)):n):null!=r&&(n=/^--/.test(n)?n:n.replace(/[A-Z]/g,"-$&").toLowerCase(),a+=mt.p?mt.p(n,r):n+":"+r+";")}return s+(t&&a?t+"{"+a+"}":a)+i},pt={},ft=e=>{if("object"==typeof e){let t="";for(let s in e)t+=s+ft(e[s]);return t}return e},xt=(e,t,s,i,a)=>{let n=ft(e),r=pt[n]||(pt[n]=(e=>{let t=0,s=11;for(;t<e.length;)s=101*s+e.charCodeAt(t++)>>>0;return"go"+s})(n));if(!pt[r]){let t=n!==e?e:(e=>{let t,s,i=[{}];for(;t=ht.exec(e.replace(dt,""));)t[4]?i.shift():t[3]?(s=t[3].replace(ut," ").trim(),i.unshift(i[0][s]=i[0][s]||{})):i[0][t[1]]=t[2].replace(ut," ").trim();return i[0]})(e);pt[r]=mt(a?{["@keyframes "+r]:t}:t,s?"":"."+r)}let o=s&&pt.g?pt.g:null;return s&&(pt.g=pt[r]),((e,t,s,i)=>{i?t.data=t.data.replace(i,e):-1===t.data.indexOf(e)&&(t.data=s?e+t.data:t.data+e)})(pt[r],t,i,o),r};function yt(e){let t=this||{},s=e.call?e(t.p):e;return xt(s.unshift?s.raw?((e,t,s)=>e.reduce((e,i,a)=>{let n=t[a];if(n&&n.call){let e=n(s),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;n=t?"."+t:e&&"object"==typeof e?e.props?"":mt(e,""):!1===e?"":e}return e+i+(null==n?"":n)},""))(s,[].slice.call(arguments,1),t.p):s.reduce((e,s)=>Object.assign(e,s&&s.call?s(t.p):s),{}):s,lt(t.target),t.g,t.o,t.k)}yt.bind({g:1});let gt=yt.bind({k:1});function bt(e,t){let s=this||{};return function(){let t=arguments;return function i(a,n){let r=Object.assign({},a),o=r.className||i.className;s.p=Object.assign({theme:rt&&rt()},r),s.o=/ *go\d+/.test(o),r.className=yt.apply(s,t)+(o?" "+o:"");let c=e;return e[0]&&(c=r.as||e,delete r.as),ot&&c[0]&&ot(r),nt(c,r)}}}var vt=(e,t)=>(e=>"function"==typeof e)(e)?e(t):e,wt=(()=>{let e=0;return()=>(++e).toString()})(),jt=(()=>{let e;return()=>{if(void 0===e&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})(),St=(e,t)=>{switch(t.type){case 0:return{...e,toasts:[t.toast,...e.toasts].slice(0,20)};case 1:return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case 2:let{toast:s}=t;return St(e,{type:e.toasts.find(e=>e.id===s.id)?1:0,toast:s});case 3:let{toastId:i}=t;return{...e,toasts:e.toasts.map(e=>e.id===i||void 0===i?{...e,dismissed:!0,visible:!1}:e)};case 4:return void 0===t.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)};case 5:return{...e,pausedAt:t.time};case 6:let a=t.time-(e.pausedAt||0);return{...e,pausedAt:void 0,toasts:e.toasts.map(e=>({...e,pauseDuration:e.pauseDuration+a}))}}},Nt=[],kt={toasts:[],pausedAt:void 0},Mt=e=>{kt=St(kt,e),Nt.forEach(e=>{e(kt)})},Ct={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},At=e=>(t,s)=>{let i=((e,t="blank",s)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0,...s,id:(null==s?void 0:s.id)||wt()}))(t,e,s);return Mt({type:2,toast:i}),i.id},Tt=(e,t)=>At("blank")(e,t);Tt.error=At("error"),Tt.success=At("success"),Tt.loading=At("loading"),Tt.custom=At("custom"),Tt.dismiss=e=>{Mt({type:3,toastId:e})},Tt.remove=e=>Mt({type:4,toastId:e}),Tt.promise=(e,t,s)=>{let i=Tt.loading(t.loading,{...s,...null==s?void 0:s.loading});return"function"==typeof e&&(e=e()),e.then(e=>{let a=t.success?vt(t.success,e):void 0;return a?Tt.success(a,{id:i,...s,...null==s?void 0:s.success}):Tt.dismiss(i),e}).catch(e=>{let a=t.error?vt(t.error,e):void 0;a?Tt.error(a,{id:i,...s,...null==s?void 0:s.error}):Tt.dismiss(i)}),e};var Pt=(e,t)=>{Mt({type:1,toast:{id:e,height:t}})},_t=()=>{Mt({type:5,time:Date.now()})},Et=new Map,Bt=e=>{let{toasts:t,pausedAt:i}=((e={})=>{let[t,i]=s.useState(kt),a=s.useRef(kt);s.useEffect(()=>(a.current!==kt&&i(kt),Nt.push(i),()=>{let e=Nt.indexOf(i);e>-1&&Nt.splice(e,1)}),[]);let n=t.toasts.map(t=>{var s,i,a;return{...e,...e[t.type],...t,removeDelay:t.removeDelay||(null==(s=e[t.type])?void 0:s.removeDelay)||(null==e?void 0:e.removeDelay),duration:t.duration||(null==(i=e[t.type])?void 0:i.duration)||(null==e?void 0:e.duration)||Ct[t.type],style:{...e.style,...null==(a=e[t.type])?void 0:a.style,...t.style}}});return{...t,toasts:n}})(e);s.useEffect(()=>{if(i)return;let e=Date.now(),s=t.map(t=>{if(t.duration===1/0)return;let s=(t.duration||0)+t.pauseDuration-(e-t.createdAt);if(!(s<0))return setTimeout(()=>Tt.dismiss(t.id),s);t.visible&&Tt.dismiss(t.id)});return()=>{s.forEach(e=>e&&clearTimeout(e))}},[t,i]);let a=s.useCallback(()=>{i&&Mt({type:6,time:Date.now()})},[i]),n=s.useCallback((e,s)=>{let{reverseOrder:i=!1,gutter:a=8,defaultPosition:n}=s||{},r=t.filter(t=>(t.position||n)===(e.position||n)&&t.height),o=r.findIndex(t=>t.id===e.id),c=r.filter((e,t)=>t<o&&e.visible).length;return r.filter(e=>e.visible).slice(...i?[c+1]:[0,c]).reduce((e,t)=>e+(t.height||0)+a,0)},[t]);return s.useEffect(()=>{t.forEach(e=>{if(e.dismissed)((e,t=1e3)=>{if(Et.has(e))return;let s=setTimeout(()=>{Et.delete(e),Mt({type:4,toastId:e})},t);Et.set(e,s)})(e.id,e.removeDelay);else{let t=Et.get(e.id);t&&(clearTimeout(t),Et.delete(e.id))}})},[t]),{toasts:t,handlers:{updateHeight:Pt,startPause:_t,endPause:a,calculateOffset:n}}},Dt=gt`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Rt=gt`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Ot=gt`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Lt=bt("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Dt} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Rt} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${e=>e.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Ot} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,It=gt`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,zt=bt("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${e=>e.secondary||"#e0e0e0"};
  border-right-color: ${e=>e.primary||"#616161"};
  animation: ${It} 1s linear infinite;
`,Ut=gt`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Ft=gt`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,qt=bt("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Ut} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Ft} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${e=>e.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Ht=bt("div")`
  position: absolute;
`,$t=bt("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Gt=gt`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Wt=bt("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Gt} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Vt=({toast:e})=>{let{icon:t,type:i,iconTheme:a}=e;return void 0!==t?"string"==typeof t?s.createElement(Wt,null,t):t:"blank"===i?null:s.createElement($t,null,s.createElement(zt,{...a}),"loading"!==i&&s.createElement(Ht,null,"error"===i?s.createElement(Lt,{...a}):s.createElement(qt,{...a})))},Kt=e=>`\n0% {transform: translate3d(0,${-200*e}%,0) scale(.6); opacity:.5;}\n100% {transform: translate3d(0,0,0) scale(1); opacity:1;}\n`,Qt=e=>`\n0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}\n100% {transform: translate3d(0,${-150*e}%,-1px) scale(.6); opacity:0;}\n`,Yt=bt("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Jt=bt("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Xt=s.memo(({toast:e,position:t,style:i,children:a})=>{let n=e.height?((e,t)=>{let s=e.includes("top")?1:-1,[i,a]=jt()?["0%{opacity:0;} 100%{opacity:1;}","0%{opacity:1;} 100%{opacity:0;}"]:[Kt(s),Qt(s)];return{animation:t?`${gt(i)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${gt(a)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}})(e.position||t||"top-center",e.visible):{opacity:0},r=s.createElement(Vt,{toast:e}),o=s.createElement(Jt,{...e.ariaProps},vt(e.message,e));return s.createElement(Yt,{className:e.className,style:{...n,...i,...e.style}},"function"==typeof a?a({icon:r,message:o}):s.createElement(s.Fragment,null,r,o))});!function(e,t,s,i){mt.p=t,nt=e,rt=s,ot=i}(s.createElement);var Zt=({id:e,className:t,style:i,onHeightUpdate:a,children:n})=>{let r=s.useCallback(t=>{if(t){let s=()=>{let s=t.getBoundingClientRect().height;a(e,s)};s(),new MutationObserver(s).observe(t,{subtree:!0,childList:!0,characterData:!0})}},[e,a]);return s.createElement("div",{ref:r,className:t,style:i},n)},es=yt`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,ts=({reverseOrder:e,position:t="top-center",toastOptions:i,gutter:a,children:n,containerStyle:r,containerClassName:o})=>{let{toasts:c,handlers:l}=Bt(i);return s.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:16,left:16,right:16,bottom:16,pointerEvents:"none",...r},className:o,onMouseEnter:l.startPause,onMouseLeave:l.endPause},c.map(i=>{let r=i.position||t,o=((e,t)=>{let s=e.includes("top"),i=s?{top:0}:{bottom:0},a=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:jt()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(s?1:-1)}px)`,...i,...a}})(r,l.calculateOffset(i,{reverseOrder:e,gutter:a,defaultPosition:t}));return s.createElement(Zt,{id:i.id,key:i.id,onHeightUpdate:l.updateHeight,className:i.visible?es:"",style:o},"custom"===i.type?vt(i.message,i):n?n(i):s.createElement(Xt,{toast:i,position:r}))}))},ss={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const is=(e,t)=>{const i=s.forwardRef(({color:i="currentColor",size:a=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:o="",children:c,...l},h)=>{return s.createElement("svg",{ref:h,...ss,width:a,height:a,stroke:i,strokeWidth:r?24*Number(n)/Number(a):n,className:["lucide",`lucide-${d=e,d.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()}`,o].join(" "),...l},[...t.map(([e,t])=>s.createElement(e,t)),...Array.isArray(c)?c:[c]]);var d});return i.displayName=`${e}`,i},as=is("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),ns=is("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),rs=is("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),os=is("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),cs=is("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),ls=is("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]),hs=is("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),ds=is("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),us=is("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]),ms=is("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),ps=is("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),fs=is("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),xs=is("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),ys=is("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]),gs=is("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]),bs=is("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),vs=is("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),ws=is("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),js=is("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Ss=is("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Ns=is("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ks=is("Fingerprint",[["path",{d:"M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 4",key:"1jc9o5"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12c0-.7.12-1.37.34-2",key:"1mxgy1"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2c0 .47 0 1.17-.02 2",key:"1fgabc"}]]),Ms=is("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]),Cs=is("Gamepad2",[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]]),As=is("Gavel",[["path",{d:"m14 13-7.5 7.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L11 10",key:"c9cbz0"}],["path",{d:"m16 16 6-6",key:"vzrcl6"}],["path",{d:"m8 8 6-6",key:"18bi4p"}],["path",{d:"m9 7 8 8",key:"5jnvq1"}],["path",{d:"m21 11-8-8",key:"z4y7zo"}]]),Ts=is("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),Ps=is("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),_s=is("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),Es=is("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),Bs=is("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]),Ds=is("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Rs=is("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),Os=is("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),Ls=is("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),Is=is("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),zs=is("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),Us=is("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),Fs=is("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),qs=is("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]),Hs=is("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),$s=is("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Gs=is("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Ws=is("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Vs=is("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),Ks=is("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Qs=is("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),Ys=is("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]),Js=is("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),Xs=is("SkipBack",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]),Zs=is("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]),ei=is("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),ti=is("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),si=is("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),ii=is("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),ai=is("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),ni=is("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),ri=is("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),oi=is("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),ci=is("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),li=is("Volume",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}]]),hi=is("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),di=is("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),ui=s.createContext({discordSdk:null,user:null,channel:null,isLoading:!0,error:null,authenticate:async()=>{},ready:!1}),mi=()=>{const e=s.useContext(ui);if(!e)throw new Error("useDiscord must be used within a DiscordProvider");return e},pi=({children:t})=>{const[i,a]=s.useState(null),[r,o]=s.useState(null),[c,l]=s.useState(null),[h,d]=s.useState(!0),[u,m]=s.useState(null),[p,f]=s.useState(!1);s.useEffect(()=>{(async()=>{try{const t="1388207626944249856";if(!(window.parent!==window||window.location.ancestorOrigins?.length>0))return o({id:"browser-user-id",username:"Browser User",discriminator:"0001",avatar:null,bot:!1,system:!1,mfa_enabled:!1,verified:!0,email:null,flags:0,premium_type:0,public_flags:0}),void d(!1);const s=new n(t),i=setTimeout(()=>{m("Discord SDK initialization timeout"),d(!1)},1e4);await s.ready(),clearTimeout(i),a(s),f(!0);try{const e=await s.commands.authenticate({access_token:null});o(e?.user?e.user:{id:"discord-user-id",username:"Discord User",discriminator:"0001",avatar:null,bot:!1,system:!1,mfa_enabled:!1,verified:!0,email:null,flags:0,premium_type:0,public_flags:0})}catch(e){o({id:"discord-user-id",username:"Discord User",discriminator:"0001",avatar:null,bot:!1,system:!1,mfa_enabled:!1,verified:!0,email:null,flags:0,premium_type:0,public_flags:0})}d(!1)}catch(t){m(t instanceof Error?t.message:"Failed to initialize Discord SDK"),d(!1)}})()},[]);const x={discordSdk:i,user:r,channel:c,isLoading:h,error:u,authenticate:async()=>{if(i)try{d(!0),m(null);const{code:t}=await i.commands.authorize({client_id:"1388207626944249856",response_type:"code",state:"",prompt:"none",scope:["identify","guilds","applications.commands"]}),s=await fetch("/api/auth/discord",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t})});if(!s.ok)throw new Error("Failed to authenticate");const{access_token:a}=await s.json(),n=await fetch("https://discord.com/api/users/@me",{headers:{Authorization:`Bearer ${a}`}});if(!n.ok)throw new Error("Failed to get user info");const r=await n.json();o(r);try{const e=await i.commands.getChannel();l(e)}catch(e){}}catch(e){m(e instanceof Error?e.message:"Authentication failed")}finally{d(!1)}},ready:p};return e.jsx(ui.Provider,{value:x,children:t})};function fi(){const{user:t,participants:s,guild:i,channel:a}=mi(),n=ze(),o=[{icon:Hs,title:"Music Player",description:"AI-powered music experience with YouTube integration",action:()=>n("/music"),gradient:"from-pink-500 to-purple-600"},{icon:oi,title:"Multiplayer",description:"Real-time synchronized experience with friends",action:()=>n("/music"),gradient:"from-blue-500 to-cyan-600"},{icon:di,title:"Live Visualizers",description:"Reactive audio visualizations in real-time",action:()=>n("/music"),gradient:"from-yellow-500 to-orange-600"},{icon:ti,title:"AI Features",description:"Smart playlists and music recommendations",action:()=>n("/settings"),gradient:"from-green-500 to-teal-600"}];return e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center mb-12",children:[e.jsx(r.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-4xl sm:text-6xl font-bold mb-6 bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 bg-clip-text text-transparent",children:"Welcome to Opure"}),e.jsx(r.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"text-xl text-gray-300 mb-8 max-w-2xl mx-auto",children:"Next-generation Discord Activity with AI-powered music experiences, futuristic UI, and real-time multiplayer features."}),t&&e.jsx(r.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.6},className:"glass-card p-6 mb-8 max-w-md mx-auto",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden border-2 border-blue-400/30",children:t.avatar?e.jsx("img",{src:`https://cdn.discordapp.com/avatars/${t.id}/${t.avatar}.webp?size=128`,alt:t.username,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-purple-400 to-blue-600 flex items-center justify-center text-lg font-bold text-white",children:t.username.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"text-left",children:[e.jsxs("h3",{className:"font-semibold text-white",children:["Welcome, ",t.globalName||t.username,"!"]}),e.jsx("p",{className:"text-sm text-gray-300",children:i?`in ${i.name}`:"Ready to start"})]})]})})]}),a&&e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},className:"glass-card p-6 mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-400 animate-pulse"}),e.jsxs("span",{className:"text-white font-medium",children:["Active in #",a.name]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-gray-300",children:[e.jsx(oi,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.length," participant",1!==s.length?"s":""]})]})]})}),e.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-12",children:o.map((t,s)=>e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1+.1*s},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:t.action,className:"glass-card p-6 cursor-pointer group",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl bg-gradient-to-br ${t.gradient} flex items-center justify-center group-hover:scale-110 transition-transform duration-300`,children:e.jsx(t.icon,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2 group-hover:text-blue-400 transition-colors",children:t.title}),e.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",children:t.description})]})]})},t.title))}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1.4},className:"text-center",children:e.jsxs(r.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>n("/music"),className:"btn-primary text-lg px-8 py-4 rounded-2xl shadow-glow",children:[e.jsx(Hs,{className:"w-5 h-5 mr-2"}),"Start Music Experience"]})})]})})}function xi(){return e.jsxs("div",{className:"flex-1 flex flex-col p-6",children:[e.jsxs(r.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Music Player"}),e.jsx("p",{className:"text-gray-300",children:"AI-powered music experience"})]}),e.jsxs(r.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.2},className:"glass-card p-8 max-w-2xl mx-auto w-full",children:[e.jsx("div",{className:"w-64 h-64 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center",children:e.jsx("div",{className:"text-6xl text-white/30",children:"♪"})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"No track loaded"}),e.jsx("p",{className:"text-gray-400",children:"Select a track to begin"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"w-full bg-white/20 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full w-0 transition-all duration-300"})}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-400 mt-2",children:[e.jsx("span",{children:"0:00"}),e.jsx("span",{children:"0:00"})]})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-4 mb-6",children:[e.jsx("button",{className:"btn-icon",children:e.jsx(Xs,{className:"w-5 h-5"})}),e.jsx("button",{className:"btn-icon w-16 h-16 bg-blue-500 hover:bg-blue-600",children:e.jsx(Hs,{className:"w-8 h-8"})}),e.jsx("button",{className:"btn-icon",children:e.jsx(Zs,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ci,{className:"w-5 h-5 text-gray-400"}),e.jsx("div",{className:"flex-1 bg-white/20 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full w-full"})})]})]}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"text-center mt-8",children:e.jsx("p",{className:"text-gray-400",children:"🚧 Full music features coming soon!"})})]})}function yi(){const t=[{icon:ri,title:"Profile",description:"Manage your profile and preferences",items:["Display Name","Avatar","Status"]},{icon:li,title:"Audio",description:"Configure audio and music settings",items:["Volume","Quality","Crossfade"]},{icon:zs,title:"Appearance",description:"Customize the look and feel",items:["Theme","Animations","Layout"]}];return e.jsxs("div",{className:"flex-1 flex flex-col p-6",children:[e.jsxs(r.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx(Ks,{className:"w-8 h-8 text-blue-400"}),e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Settings"})]}),e.jsx("p",{className:"text-gray-300",children:"Customize your Opure experience"})]}),e.jsx("div",{className:"max-w-4xl mx-auto w-full space-y-6",children:t.map((t,s)=>e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*s},className:"glass-card p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:e.jsx(t.icon,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:t.title}),e.jsx("p",{className:"text-gray-400 mb-4",children:t.description}),e.jsx("div",{className:"space-y-2",children:t.items.map(t=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-gray-300",children:t}),e.jsx("div",{className:"text-gray-500 text-sm",children:"Coming soon"})]},t))})]})]})},t.title))}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"text-center mt-8",children:e.jsx("p",{className:"text-gray-400",children:"🚧 Settings panel coming soon!"})})]})}class gi{events=new Map;on(e,t){return this.events.has(e)||this.events.set(e,[]),this.events.get(e).push(t),this}once(e,t){const s=(...i)=>{this.removeListener(e,s),t(...i)};return this.on(e,s)}emit(e,...t){const s=this.events.get(e);return!(!s||0===s.length)&&(s.forEach(e=>{try{e(...t)}catch(s){}}),!0)}removeListener(e,t){const s=this.events.get(e);if(!s)return this;const i=s.indexOf(t);return i>-1&&s.splice(i,1),0===s.length&&this.events.delete(e),this}off(e,t){return this.removeListener(e,t)}removeAllListeners(e){return e?this.events.delete(e):this.events.clear(),this}listenerCount(e){const t=this.events.get(e);return t?t.length:0}eventNames(){return Array.from(this.events.keys())}}class bi extends gi{config;bodies=new Map;staticBodies=[];dynamicBodies=[];sleepingBodies=new Set;spatialGrid;broadPhaseEnabled=!0;lastUpdateTime=0;updateCount=0;collisionCount=0;constructor(e){super(),this.config={timeStep:1/60,velocityIterations:8,positionIterations:3,enableSleeping:!0,sleepThreshold:.1,...e},this.spatialGrid=new vi(this.config.worldBounds.width,this.config.worldBounds.height,64)}addBody(e){const t={id:e.id,position:{...e.position},velocity:{...e.velocity},acceleration:{x:0,y:0},mass:e.properties.mass||1,restitution:e.properties.restitution||.5,friction:e.properties.friction||.3,drag:e.properties.drag||.01,isStatic:e.properties.isStatic||!1,isKinematic:e.properties.isKinematic||!1,isSensor:e.properties.isSensor||!1,shape:this.createCollisionShape(e),bounds:this.calculateAABB(e),userData:e};return this.bodies.set(t.id,t),t.isStatic?this.staticBodies.push(t):this.dynamicBodies.push(t),this.spatialGrid.insert(t),t}removeBody(e){const t=this.bodies.get(e.id);if(t){if(this.bodies.delete(e.id),this.sleepingBodies.delete(e.id),t.isStatic){const e=this.staticBodies.indexOf(t);e>-1&&this.staticBodies.splice(e,1)}else{const e=this.dynamicBodies.indexOf(t);e>-1&&this.dynamicBodies.splice(e,1)}this.spatialGrid.remove(t)}}update(e){if(!this.config.enabled)return;const t=performance.now();this.updateCount++;const s=1e3*this.config.timeStep;let i=e;for(;i>=s;)this.step(s/1e3),i-=s;this.spatialGrid.clear();for(const a of this.dynamicBodies)this.sleepingBodies.has(a.id)||this.spatialGrid.insert(a);for(const a of this.staticBodies)this.spatialGrid.insert(a);this.lastUpdateTime=t}step(e){this.integrate(e),this.detectCollisions();for(let t=0;t<this.config.velocityIterations;t++)this.solveVelocityConstraints();for(let t=0;t<this.config.positionIterations;t++)this.solvePositionConstraints();this.config.enableSleeping&&this.updateSleepingBodies(),this.syncGameObjects()}integrate(e){for(const t of this.dynamicBodies){if(this.sleepingBodies.has(t.id)||t.isKinematic)continue;t.acceleration.x+=this.config.gravity.x,t.acceleration.y+=this.config.gravity.y;const s=-t.velocity.x*t.drag,i=-t.velocity.y*t.drag;t.acceleration.x+=s/t.mass,t.acceleration.y+=i/t.mass,t.velocity.x+=t.acceleration.x*e,t.velocity.y+=t.acceleration.y*e,t.position.x+=t.velocity.x*e,t.position.y+=t.velocity.y*e,t.acceleration.x=0,t.acceleration.y=0,this.updateBodyBounds(t),this.checkWorldBounds(t)}}detectCollisions(){this.collisionCount=0;const e=new Set;if(this.broadPhaseEnabled)for(const t of this.dynamicBodies){if(this.sleepingBodies.has(t.id))continue;const s=this.spatialGrid.query(t.bounds);for(const i of s){if(t.id===i.id)continue;const s=t.id<i.id?`${t.id}-${i.id}`:`${i.id}-${t.id}`;if(e.has(s))continue;e.add(s);const a=this.checkCollision(t,i);a&&(this.resolveCollision(a),this.emit("collision",a),this.collisionCount++)}}else for(let t=0;t<this.dynamicBodies.length;t++){const e=this.dynamicBodies[t];if(!this.sleepingBodies.has(e.id)){for(let s=t+1;s<this.dynamicBodies.length;s++){const t=this.dynamicBodies[s];if(this.sleepingBodies.has(t.id))continue;const i=this.checkCollision(e,t);i&&(this.resolveCollision(i),this.emit("collision",i),this.collisionCount++)}for(const t of this.staticBodies){const s=this.checkCollision(e,t);s&&(this.resolveCollision(s),this.emit("collision",s),this.collisionCount++)}}}}checkCollision(e,t){return this.aabbOverlap(e.bounds,t.bounds)?"circle"===e.shape.type&&"circle"===t.shape.type?this.circleCircleCollision(e,t):"rectangle"===e.shape.type&&"rectangle"===t.shape.type?this.rectangleRectangleCollision(e,t):"circle"===e.shape.type&&"rectangle"===t.shape.type?this.circleRectangleCollision(e,t):"rectangle"===e.shape.type&&"circle"===t.shape.type?this.circleRectangleCollision(t,e):null:null}circleCircleCollision(e,t){const s=t.position.x-e.position.x,i=t.position.y-e.position.y,a=Math.sqrt(s*s+i*i),n=(e.shape.radius||0)+(t.shape.radius||0);if(a<n){const r=a>0?{x:s/a,y:i/a}:{x:1,y:0};return{bodyA:e,bodyB:t,normal:r,penetration:n-a,contactPoints:[{x:e.position.x+r.x*(e.shape.radius||0),y:e.position.y+r.y*(e.shape.radius||0)}],timestamp:performance.now()}}return null}rectangleRectangleCollision(e,t){const s=Math.min(e.bounds.max.x,t.bounds.max.x)-Math.max(e.bounds.min.x,t.bounds.min.x),i=Math.min(e.bounds.max.y,t.bounds.max.y)-Math.max(e.bounds.min.y,t.bounds.min.y);if(s>0&&i>0){let a,n;return s<i?(n=s,a=e.position.x<t.position.x?{x:-1,y:0}:{x:1,y:0}):(n=i,a=e.position.y<t.position.y?{x:0,y:-1}:{x:0,y:1}),{bodyA:e,bodyB:t,normal:a,penetration:n,contactPoints:[{x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2}],timestamp:performance.now()}}return null}circleRectangleCollision(e,t){const s=e.shape.radius||0;t.shape.width,t.shape.height;const i=Math.max(t.bounds.min.x,Math.min(e.position.x,t.bounds.max.x)),a=Math.max(t.bounds.min.y,Math.min(e.position.y,t.bounds.max.y)),n=e.position.x-i,r=e.position.y-a,o=n*n+r*r;if(o<s*s){const c=Math.sqrt(o),l=s-c;let h;if(c>.001)h={x:n/c,y:r/c};else{h=Math.min(e.position.x-t.bounds.min.x,t.bounds.max.x-e.position.x)<Math.min(e.position.y-t.bounds.min.y,t.bounds.max.y-e.position.y)?e.position.x<t.position.x?{x:-1,y:0}:{x:1,y:0}:e.position.y<t.position.y?{x:0,y:-1}:{x:0,y:1}}return{bodyA:e,bodyB:t,normal:h,penetration:l,contactPoints:[{x:i,y:a}],timestamp:performance.now()}}return null}resolveCollision(e){const{bodyA:t,bodyB:s,normal:i,penetration:a}=e;if(t.isSensor||s.isSensor)return;if(t.isStatic||s.isStatic)t.isStatic?s.isStatic||(s.position.x+=i.x*a*.8,s.position.y+=i.y*a*.8):(t.position.x-=i.x*a*.8,t.position.y-=i.y*a*.8);else{const e=t.mass+s.mass,n=s.mass/e*a*.8,r=t.mass/e*a*.8;t.position.x-=i.x*n,t.position.y-=i.y*n,s.position.x+=i.x*r,s.position.y+=i.y*r}const n=s.velocity.x-t.velocity.x,r=s.velocity.y-t.velocity.y,o=n*i.x+r*i.y;if(o>0)return;let c=-(1+Math.min(t.restitution,s.restitution))*o;t.isStatic||s.isStatic?t.isStatic?s.isStatic||(c/=1/s.mass):c/=1/t.mass:c/=1/t.mass+1/s.mass;const l=c*i.x,h=c*i.y;t.isStatic||t.isKinematic||(t.velocity.x-=l/t.mass,t.velocity.y-=h/t.mass,this.wakeBody(t)),s.isStatic||s.isKinematic||(s.velocity.x+=l/s.mass,s.velocity.y+=h/s.mass,this.wakeBody(s)),this.applyFriction(e,c)}applyFriction(e,t){const{bodyA:s,bodyB:i,normal:a}=e,n=i.velocity.x-s.velocity.x,r=i.velocity.y-s.velocity.y,o=n-(n*a.x+r*a.y)*a.x,c=r-(n*a.x+r*a.y)*a.y,l=Math.sqrt(o*o+c*c);if(l<.001)return;const h=o/l,d=c/l,u=Math.sqrt(s.friction*i.friction),m=.8*u;let p=-(n*h+r*d);s.isStatic||i.isStatic?s.isStatic?i.isStatic||(p/=1/i.mass):p/=1/s.mass:p/=1/s.mass+1/i.mass;const f=Math.abs(p)<Math.abs(t)*u?p:-Math.sign(p)*Math.abs(t)*m,x=f*h,y=f*d;s.isStatic||s.isKinematic||(s.velocity.x-=x/s.mass,s.velocity.y-=y/s.mass),i.isStatic||i.isKinematic||(i.velocity.x+=x/i.mass,i.velocity.y+=y/i.mass)}solveVelocityConstraints(){}solvePositionConstraints(){}updateSleepingBodies(){for(const e of this.dynamicBodies){const t=Math.sqrt(e.velocity.x*e.velocity.x+e.velocity.y*e.velocity.y);t<this.config.sleepThreshold?this.sleepingBodies.add(e.id):t>2*this.config.sleepThreshold&&this.wakeBody(e)}}wakeBody(e){this.sleepingBodies.delete(e.id)}syncGameObjects(){for(const e of this.bodies.values())e.userData&&(e.userData.position.x=e.position.x,e.userData.position.y=e.position.y,e.userData.velocity.x=e.velocity.x,e.userData.velocity.y=e.velocity.y)}checkWorldBounds(e){const t=this.config.worldBounds;let s=!1;e.position.x<0?(e.position.x=0,e.velocity.x=-e.velocity.x*e.restitution,s=!0):e.position.x>t.width&&(e.position.x=t.width,e.velocity.x=-e.velocity.x*e.restitution,s=!0),e.position.y<0?(e.position.y=0,e.velocity.y=-e.velocity.y*e.restitution,s=!0):e.position.y>t.height&&(e.position.y=t.height,e.velocity.y=-e.velocity.y*e.restitution,s=!0),s&&this.emit("worldBoundsCollision",e)}createCollisionShape(e){const t=e.properties.shape||{type:"rectangle"};switch(t.type){case"circle":return{type:"circle",radius:t.radius||e.scale.x};case"rectangle":return{type:"rectangle",width:t.width||e.scale.x,height:t.height||e.scale.y};case"polygon":return{type:"polygon",vertices:t.vertices||[]};default:return{type:"rectangle",width:e.scale.x,height:e.scale.y}}}calculateAABB(e){const t=this.createCollisionShape(e);switch(t.type){case"circle":const s=t.radius||0;return{min:{x:e.position.x-s,y:e.position.y-s},max:{x:e.position.x+s,y:e.position.y+s}};case"rectangle":const i=(t.width||0)/2,a=(t.height||0)/2;return{min:{x:e.position.x-i,y:e.position.y-a},max:{x:e.position.x+i,y:e.position.y+a}};default:return{min:{x:e.position.x,y:e.position.y},max:{x:e.position.x,y:e.position.y}}}}updateBodyBounds(e){const t=e.userData;t&&(e.bounds=this.calculateAABB(t))}aabbOverlap(e,t){return e.min.x<t.max.x&&e.max.x>t.min.x&&e.min.y<t.max.y&&e.max.y>t.min.y}getBody(e){return this.bodies.get(e)}applyForce(e,t){const s=this.bodies.get(e);!s||s.isStatic||s.isKinematic||(s.acceleration.x+=t.x/s.mass,s.acceleration.y+=t.y/s.mass,this.wakeBody(s))}applyImpulse(e,t){const s=this.bodies.get(e);!s||s.isStatic||s.isKinematic||(s.velocity.x+=t.x/s.mass,s.velocity.y+=t.y/s.mass,this.wakeBody(s))}setVelocity(e,t){const s=this.bodies.get(e);s&&!s.isStatic&&(s.velocity.x=t.x,s.velocity.y=t.y,this.wakeBody(s))}getPerformanceStats(){return{bodyCount:this.bodies.size,dynamicBodies:this.dynamicBodies.length,staticBodies:this.staticBodies.length,sleepingBodies:this.sleepingBodies.size,collisionCount:this.collisionCount,updateCount:this.updateCount,spatialGridCells:this.spatialGrid.getCellCount()}}updateSettings(e){this.config={...this.config,...e},e.worldBounds&&(this.spatialGrid=new vi(e.worldBounds.width,e.worldBounds.height,64))}destroy(){this.bodies.clear(),this.staticBodies=[],this.dynamicBodies=[],this.sleepingBodies.clear(),this.spatialGrid.clear(),this.removeAllListeners()}}class vi{cellSize;width;height;cols;rows;cells=new Map;constructor(e,t,s){this.width=e,this.height=t,this.cellSize=s,this.cols=Math.ceil(e/s),this.rows=Math.ceil(t/s)}insert(e){const t=this.getCellsForAABB(e.bounds);for(const s of t)this.cells.has(s)||this.cells.set(s,[]),this.cells.get(s).push(e)}remove(e){const t=this.getCellsForAABB(e.bounds);for(const s of t){const t=this.cells.get(s);if(t){const s=t.indexOf(e);s>-1&&t.splice(s,1)}}}query(e){const t=new Set,s=this.getCellsForAABB(e);for(const i of s){const e=this.cells.get(i);if(e)for(const s of e)t.add(s)}return Array.from(t)}clear(){this.cells.clear()}getCellCount(){return this.cells.size}getCellsForAABB(e){const t=Math.max(0,Math.floor(e.min.x/this.cellSize)),s=Math.min(this.cols-1,Math.floor(e.max.x/this.cellSize)),i=Math.max(0,Math.floor(e.min.y/this.cellSize)),a=Math.min(this.rows-1,Math.floor(e.max.y/this.cellSize)),n=[];for(let r=t;r<=s;r++)for(let e=i;e<=a;e++)n.push(`${r},${e}`);return n}}class wi{config;rng;templates=new Map;generationHistory=new Map;themes=["forest","space","underwater","desert","city","fantasy","neon","retro"];colors=["blue","red","green","purple","orange","pink","yellow","cyan"];patterns=["grid","spiral","wave","random","symmetric","fractal","cluster","line"];difficultyTracker=new Si;contentBalancer=new Ni;constructor(e){this.config=e,this.rng=new ji(e.seed||Date.now()),this.initializeTemplates()}async generateLevel(e,t){const s=performance.now(),i=this.calculateTargetDifficulty(e,t),a=this.selectTheme(e),n=this.selectContentStyle(e,a),r=await this.generateGameObjects(e,i,n),o=this.generateObjectives(e,i,r),c=this.generateEnvironment(a,e),l=this.calculateRewards(e,i,o),h=this.balanceContent({level:e,seed:this.rng.seed,difficulty:i,gameObjects:r,environment:c,objectives:o,rewards:l,metadata:{estimatedDuration:this.estimateDuration(r,o),difficultyRating:i,contentVariety:this.calculateVariety(r),balanceScore:0}});this.generationHistory.set(e,h);performance.now();return h}calculateTargetDifficulty(e,t){let s=1+.15*(e-1);if(s*=this.config.complexity,t){s*=this.difficultyTracker.calculateAdjustment(t)}return Math.max(.5,Math.min(10,s))}selectTheme(e){const t=((e-1)%this.themes.length+this.rng.nextInt(0,2))%this.themes.length;return this.themes[t]}selectContentStyle(e,t){return{theme:t,colorScheme:this.rng.choice(this.colors),pattern:this.rng.choice(this.patterns),density:.3+.02*e,variety:Math.min(.8,.2+.03*e)}}async generateGameObjects(e,t,s){const i=[],a=this.calculateObjectCount(e,t),n=this.getAvailableTemplates(e,t);for(let r=0;r<a;r++){const a=this.rng.choice(n),o=await this.generateFromTemplate(a,e,t,s,r);o&&i.push(o)}return this.ensureMinimumObjects(i,e,t),this.applyLayoutPattern(i,s.pattern),i}calculateObjectCount(e,t){const s=1+.2*(e-1),i=.8+.4*t;return Math.floor(10*s*i)}getAvailableTemplates(e,t){const s=[];for(const i of this.templates.values())this.isTemplateAvailable(i,e,t)&&s.push(i);return s.length>0?s:Array.from(this.templates.values())}isTemplateAvailable(e,t,s){const i=e.requirements?.minLevel||1,a=e.requirements?.maxLevel||1/0,n=e.requirements?.minDifficulty||0,r=e.requirements?.maxDifficulty||10;return t>=i&&t<=a&&s>=n&&s<=r}async generateFromTemplate(e,t,s,i,a){try{const i=this.selectVariant(e,t,s),n=e.baseComplexity*Math.pow(e.scalingFactor,t-1),r=this.calculateObjectProperties(e,i,n,s);return{id:`${e.type}_${t}_${a}`,type:e.type,category:e.category,position:{x:0,y:0},velocity:{x:0,y:0},rotation:0,scale:{x:r.scale,y:r.scale},properties:{...r,templateId:e.id,variantId:i.id,generatedFor:{level:t,difficulty:s}},components:this.generateComponents(e,i,r)}}catch(n){return null}}selectVariant(e,t,s){const i=e.variants.filter(e=>!e.exclusions.includes(`level_${t}`)&&!e.exclusions.includes(`difficulty_${Math.floor(s)}`));return 0===i.length?e.variants[0]:this.rng.weightedChoice(i,e=>e.weight)}calculateObjectProperties(e,t,s,i){const a={...{health:100,damage:10,speed:50,scale:1,value:10,mass:1,restitution:.5,friction:.3,...e.requirements?.defaultProperties}};if(t.modifiers)for(const[o,c]of Object.entries(t.modifiers))"number"==typeof c?a[o]=(a[o]||1)*c:"object"==typeof c&&"add"===c.type&&(a[o]=(a[o]||0)+c.value);const n={health:1+.3*(s-1),damage:1+.2*(s-1),speed:1+.15*(s-1),value:1+.5*(s-1)};for(const[o,c]of Object.entries(n))a[o]&&(a[o]*=c);const r={health:.7+.6*i,damage:.8+.4*i,speed:.9+.2*i};for(const[o,c]of Object.entries(r))a[o]&&(a[o]*=c);return a}generateComponents(e,t,s){const i=[];switch(e.category){case"collectible":i.push({type:"CollectibleComponent",enabled:!0,value:s.value,autoCollect:s.autoCollect||!1});break;case"enemy":i.push({type:"EnemyComponent",enabled:!0,health:s.health,damage:s.damage,attackRange:s.attackRange||50,movementPattern:s.movementPattern||"random"});break;case"obstacle":i.push({type:"ObstacleComponent",enabled:!0,destructible:s.destructible||!1,damage:s.damage||0});break;case"powerup":i.push({type:"PowerupComponent",enabled:!0,effect:s.effect,duration:s.duration||1e4,value:s.value})}return!1!==s.hasPhysics&&i.push({type:"PhysicsComponent",enabled:!0,mass:s.mass,restitution:s.restitution,friction:s.friction,isStatic:s.isStatic||!1}),i.push({type:"RenderComponent",enabled:!0,sprite:s.sprite||e.type,color:s.color,scale:s.scale,opacity:s.opacity||1}),i}ensureMinimumObjects(e,t,s){const i={collectible:Math.max(3,Math.floor(.5*t)),enemy:Math.max(1,Math.floor(s)),powerup:Math.max(1,Math.floor(.3*t))};for(const[a,n]of Object.entries(i)){const i=e.filter(e=>e.category===a).length;if(i<n){const r=this.templates.get(`basic_${a}`);if(r)for(let a=0;a<n-i;a++){const i=this.generateFromTemplate(r,t,s,{},e.length+a);i&&e.push(i)}}}}applyLayoutPattern(e,t){const s={width:800,height:600};switch(t){case"grid":this.applyGridLayout(e,s);break;case"spiral":this.applySpiralLayout(e,s);break;case"wave":this.applyWaveLayout(e,s);break;case"cluster":this.applyClusterLayout(e,s);break;case"symmetric":this.applySymmetricLayout(e,s);break;default:this.applyRandomLayout(e,s)}}applyGridLayout(e,t){const s=Math.ceil(Math.sqrt(e.length)),i=Math.ceil(e.length/s),a=t.width/s,n=t.height/i;e.forEach((e,t)=>{const i=t%s,r=Math.floor(t/s);e.position.x=i*a+a/2,e.position.y=r*n+n/2})}applySpiralLayout(e,t){const s=t.width/2,i=t.height/2,a=Math.min(t.width,t.height)/2*.8;e.forEach((t,n)=>{const r=.5*n,o=n/e.length*a;t.position.x=s+Math.cos(r)*o,t.position.y=i+Math.sin(r)*o})}applyWaveLayout(e,t){const s=.3*t.height,i=2*Math.PI/t.width,a=t.height/2;e.forEach((n,r)=>{const o=r/e.length*t.width,c=a+Math.sin(o*i)*s;n.position.x=o,n.position.y=c})}applyClusterLayout(e,t){const s=Math.min(5,Math.max(2,Math.floor(e.length/8))),i=[];for(let a=0;a<s;a++)i.push({x:this.rng.nextFloat(.2*t.width,.8*t.width),y:this.rng.nextFloat(.2*t.height,.8*t.height)});e.forEach((e,t)=>{const a=i[t%s],n=this.rng.nextFloat(0,50),r=this.rng.nextFloat(0,2*Math.PI);e.position.x=a.x+Math.cos(r)*n,e.position.y=a.y+Math.sin(r)*n})}applySymmetricLayout(e,t){const s=t.width/2,i=t.height/2;for(let a=0;a<e.length;a+=2){const n=a/2*(2*Math.PI/Math.floor(e.length/2)),r=this.rng.nextFloat(50,Math.min(t.width,t.height)/2*.7);e[a].position.x=s+Math.cos(n)*r,e[a].position.y=i+Math.sin(n)*r,a+1<e.length&&(e[a+1].position.x=s-Math.cos(n)*r,e[a+1].position.y=i-Math.sin(n)*r)}}applyRandomLayout(e,t){e.forEach(e=>{e.position.x=this.rng.nextFloat(50,t.width-50),e.position.y=this.rng.nextFloat(50,t.height-50)})}generateObjectives(e,t,s){const i=[],a=this.generatePrimaryObjective(e,t,s);if(i.push(a),e>2){const a=Math.min(3,Math.floor(e/3));for(let n=0;n<a;n++){const a=this.generateSecondaryObjective(e,t,s,n);a&&i.push(a)}}return i}generatePrimaryObjective(e,t,s){const i=s.filter(e=>"collectible"===e.category),a=s.filter(e=>"enemy"===e.category);if(i.length>0){const e=Math.max(Math.floor(.7*i.length),1);return{id:"primary_collect",type:"collect",description:`Collect ${e} items`,target:e,current:0,completed:!1,priority:1,rewards:Math.floor(50*t)}}if(a.length>0){const e=Math.max(Math.floor(.8*a.length),1);return{id:"primary_destroy",type:"destroy",description:`Defeat ${e} enemies`,target:e,current:0,completed:!1,priority:1,rewards:Math.floor(75*t)}}{const s=Math.floor(500*e*t);return{id:"primary_score",type:"score",description:`Reach ${s} points`,target:s,current:0,completed:!1,priority:1,rewards:Math.floor(40*t)}}}generateSecondaryObjective(e,t,s,i){switch(this.rng.choice(["time","collect","destroy","survive"])){case"time":const s=Math.max(30,180-5*e);return{id:`secondary_time_${i}`,type:"time",description:`Complete in under ${s} seconds`,target:1e3*s,current:0,completed:!1,priority:2,rewards:Math.floor(25*t)};case"survive":const a=Math.min(60,15+3*e);return{id:`secondary_survive_${i}`,type:"survive",description:`Survive for ${a} seconds`,target:1e3*a,current:0,completed:!1,priority:2,rewards:Math.floor(30*t)};default:return null}}generateEnvironment(e,t){return{theme:e,lighting:this.generateLighting(e,t),physics:this.generatePhysicsSettings(e,t),audio:this.generateAudioSettings(e,t),effects:this.generateEffects(e,t)}}generateLighting(e,t){const s={ambient:.3,directional:.7,color:"#ffffff"};switch(e){case"space":return{...s,ambient:.1,color:"#4a90e2"};case"underwater":return{...s,ambient:.4,color:"#00b4d8"};case"desert":return{...s,ambient:.6,color:"#ffb700"};case"neon":return{...s,ambient:.2,color:"#ff00ff"};default:return s}}generatePhysicsSettings(e,t){const s={x:0,y:980};switch(e){case"space":return{gravity:{x:0,y:100}};case"underwater":return{gravity:{x:0,y:300},drag:.05};default:return{gravity:s}}}generateAudioSettings(e,t){return{backgroundMusic:`${e}_ambient`,soundEffects:{collect:`${e}_collect`,destroy:`${e}_destroy`,powerup:`${e}_powerup`},volume:{master:.7,music:.5,effects:.8}}}generateEffects(e,t){return{particles:"space"===e?"stars":"underwater"===e?"bubbles":"none",backgroundAnimation:!0,postProcessing:t>5}}calculateRewards(e,t,s){const i=10+5*e,a=1+.3*(t-1);return s.reduce((e,t)=>e+t.rewards,0),{baseTokens:Math.floor(i*a),bonusConditions:[{type:"perfect_completion",condition:"Complete all objectives",multiplier:1.5,description:"50% bonus for perfect completion"},{type:"speed_bonus",condition:"Complete quickly",multiplier:1.2,description:"20% bonus for fast completion"},{type:"no_damage",condition:"Take no damage",multiplier:1.3,description:"30% bonus for flawless performance"}]}}balanceContent(e){const t=this.contentBalancer.analyzeBalance(e);return t<.6&&(e=this.contentBalancer.applyBalancing(e,this.config.balancingRules)),e.metadata.balanceScore=t,e}estimateDuration(e,t){return 60+t.reduce((e,t)=>{switch(t.type){case"collect":return e+2*t.target;case"destroy":return e+5*t.target;case"time":return e+t.target/1e3;default:return e+30}},0)}calculateVariety(e){const t=new Set(e.map(e=>e.type)),s=new Set(e.map(e=>e.category));return(t.size+s.size)/(e.length+1)}initializeTemplates(){const e=[{id:"basic_collectible",category:"collectible",type:"coin",baseComplexity:1,scalingFactor:1.1,requirements:{minLevel:1},variants:[{id:"standard",weight:1,modifiers:{},exclusions:[]},{id:"valuable",weight:.3,modifiers:{value:2},exclusions:[]}]},{id:"basic_enemy",category:"enemy",type:"guard",baseComplexity:1.5,scalingFactor:1.2,requirements:{minLevel:1},variants:[{id:"weak",weight:1,modifiers:{health:.8,damage:.8},exclusions:[]},{id:"strong",weight:.5,modifiers:{health:1.5,damage:1.2},exclusions:[]}]},{id:"basic_obstacle",category:"obstacle",type:"wall",baseComplexity:1,scalingFactor:1.05,requirements:{minLevel:1},variants:[{id:"solid",weight:1,modifiers:{destructible:!1},exclusions:[]},{id:"breakable",weight:.7,modifiers:{destructible:!0,health:50},exclusions:[]}]},{id:"basic_powerup",category:"powerup",type:"speed_boost",baseComplexity:1,scalingFactor:1.1,requirements:{minLevel:2},variants:[{id:"short",weight:1,modifiers:{duration:5e3,effect:"speed",value:1.5},exclusions:[]},{id:"long",weight:.4,modifiers:{duration:1e4,effect:"speed",value:1.3},exclusions:[]}]}];for(const t of e)this.templates.set(t.id,t)}getSeed(){return this.rng.seed}setSeed(e){this.rng=new ji(e)}getGenerationHistory(){return this.generationHistory}clearHistory(){this.generationHistory.clear()}addTemplate(e){this.templates.set(e.id,e)}removeTemplate(e){this.templates.delete(e)}getTemplates(){return Array.from(this.templates.values())}updateConfig(e){this.config={...this.config,...e}}}class ji{seed;state;constructor(e){this.seed=e,this.state=e}next(){return this.state=(9301*this.state+49297)%233280,this.state/233280}nextInt(e,t){return Math.floor(this.next()*(t-e+1))+e}nextFloat(e,t){return this.next()*(t-e)+e}choice(e){return e[this.nextInt(0,e.length-1)]}weightedChoice(e,t){const s=e.reduce((e,s)=>e+t(s),0);let i=this.nextFloat(0,s);for(const a of e)if(i-=t(a),i<=0)return a;return e[e.length-1]}}class Si{performanceHistory=[];targetSuccessRate=.7;calculateAdjustment(e){if(!e)return 1;this.performanceHistory.push(e),this.performanceHistory.length>10&&this.performanceHistory.shift();const t=this.performanceHistory.slice(-5),s=t.reduce((e,t)=>e+(t.completed?1:0),0)/t.length,i=t.reduce((e,t)=>e+t.completionTime,0)/t.length,a=t.reduce((e,t)=>e+t.score,0)/t.length;let n=1;return s>this.targetSuccessRate+.2?n*=1.2:s<this.targetSuccessRate-.2&&(n*=.8),i<3e4||a>1e3?n*=1.1:(i>12e4||a<200)&&(n*=.9),Math.max(.3,Math.min(3,n))}}class Ni{analyzeBalance(e){let t=1;const s=e.gameObjects.filter(e=>"collectible"===e.category).length;return s<3&&(t*=.8),e.gameObjects.filter(e=>"enemy"===e.category).length>1.5*s&&(t*=.7),e.gameObjects.filter(e=>"powerup"===e.category).length>=Math.max(1,Math.floor(e.level/3))&&(t*=1.1),e.difficulty<.8*e.level&&(t*=.9),e.difficulty>2*e.level&&(t*=.8),Math.max(0,Math.min(1,t))}applyBalancing(e,t){for(const s of t)e=this.applyRule(e,s);return e}applyRule(e,t){switch(t.type){case"enemy_scaling":e.gameObjects.filter(e=>"enemy"===e.category).forEach(e=>{e.properties.health*=Math.max(.5,Math.min(2,1+t.adjustment))});break;case"reward_adjustment":e.rewards.baseTokens*=Math.max(.5,Math.min(2,1+t.adjustment))}return e}}class ki{config;memory;currentStrategy;behaviorTree;strategyManager;patternRecognizer;learningSystem;decisionMaker;lastDecisionTime=0;currentGoal;emotionalState={confidence:.5,frustration:0,excitement:.5,focus:1};recentPerformance=[];adaptationTrigger=0;constructor(e,t){this.config={difficulty:Math.max(.1,Math.min(10,e)),personality:{aggressiveness:.5,patience:.5,riskTaking:.5,adaptability:.5,consistency:.5,creativity:.5,cooperation:.5,competitiveness:.7,...t},learningEnabled:!0,adaptiveStrategies:!0,humanLikeErrors:!0,responseTime:{min:200,max:1500},strategyUpdateInterval:1e4},this.memory={playerActions:[],successfulStrategies:[],failedStrategies:[],playerPatterns:[],gameStateHistory:[],winLossRecord:[]},this.behaviorTree=new Mi(this.config.personality),this.strategyManager=new Ci(this.config),this.patternRecognizer=new Ai,this.learningSystem=new Ti(this.config),this.decisionMaker=new Pi(this.config,this.memory),this.initializeStrategies()}update(e,t){const s=Date.now();this.updateEmotionalState(t),this.recordGameState(t),this.config.learningEnabled&&this.analyzePlayerBehavior(t),s-this.lastDecisionTime>this.config.strategyUpdateInterval&&(this.updateStrategy(t),this.lastDecisionTime=s),this.currentStrategy&&this.executeStrategy(e,t);const i=this.makeDecision(t);i&&this.executeDecision(i,t),this.config.learningEnabled&&this.learningSystem.processExperience(t,this.memory)}updateEmotionalState(e){const t=this.getCurrentAIScore(e),s=e.score||0;t>s?(this.emotionalState.confidence=Math.min(1,this.emotionalState.confidence+.01),this.emotionalState.excitement=Math.min(1,this.emotionalState.excitement+.02),this.emotionalState.frustration=Math.max(0,this.emotionalState.frustration-.01)):t<.7*s&&(this.emotionalState.confidence=Math.max(0,this.emotionalState.confidence-.02),this.emotionalState.frustration=Math.min(1,this.emotionalState.frustration+.01)),this.emotionalState.focus=Math.max(.3,1-.5*this.emotionalState.frustration),this.recentPerformance.push(t/Math.max(1,s)),this.recentPerformance.length>10&&this.recentPerformance.shift()}recordGameState(e){const t={timestamp:Date.now(),gameState:{score:e.score,level:e.currentLevel,difficulty:e.difficulty,timeElapsed:e.timeElapsed},aiState:{emotionalState:{...this.emotionalState},currentStrategy:this.currentStrategy?.name||"none",confidence:this.emotionalState.confidence},playerState:{score:e.score,performance:this.calculatePlayerPerformance(e)},decision:this.currentStrategy?.name||"observe",outcome:"pending"};this.memory.gameStateHistory.push(t),this.memory.gameStateHistory.length>100&&this.memory.gameStateHistory.shift()}analyzePlayerBehavior(e){const t=this.patternRecognizer.analyzePatterns(this.memory.playerActions);for(const s of t){const e=this.memory.playerPatterns.find(e=>e.patternType===s.type);e?(e.frequency=(e.frequency+s.frequency)/2,e.predictability=s.predictability):this.memory.playerPatterns.push({patternType:s.type,frequency:s.frequency,predictability:s.predictability,contexts:s.contexts,counters:s.suggestedCounters})}t.length>0&&(this.adaptationTrigger++,this.adaptationTrigger>5&&(this.adaptToPlayerBehavior(),this.adaptationTrigger=0))}updateStrategy(e){this.calculateCurrentPerformance(e);const t=this.strategyManager.getAvailableStrategies(e,this.emotionalState);let s=this.currentStrategy,i=-1;for(const a of t){const t=this.evaluateStrategy(a,e);(t>i||!s)&&(i=t,s=a)}s!==this.currentStrategy&&i>this.getCurrentStrategyScore()+.2&&this.switchStrategy(s,e)}evaluateStrategy(e,t){let s=.4*e.successRate;this.emotionalState.frustration>.5&&e.name.includes("aggressive")&&(s+=.2),this.emotionalState.confidence>.7&&e.name.includes("risky")&&(s+=.1);for(const i of this.memory.playerPatterns)e.actions.some(e=>i.counters.includes(e))&&(s+=.3*i.predictability);return e.name.includes("aggressive")&&(s+=.2*(this.config.personality.aggressiveness-.5)),e.name.includes("creative")&&(s+=.2*(this.config.personality.creativity-.5)),s*=.5+.1*this.config.difficulty,Math.max(0,Math.min(1,s))}switchStrategy(e,t){if(this.currentStrategy){const e=this.calculateStrategyOutcome(t);this.recordStrategyOutcome(this.currentStrategy,e)}this.currentStrategy=e,this.currentStrategy.usageCount++,this.currentStrategy.lastUsed=Date.now()}executeStrategy(e,t){if(!this.currentStrategy)return;const s={gameState:t,aiState:this.emotionalState,playerPatterns:this.memory.playerPatterns,difficulty:this.config.difficulty},i=this.behaviorTree.execute(s,this.currentStrategy);i.success&&this.applyStrategyActions(i.actions,t)}makeDecision(e){return this.shouldMakeDecision()?this.decisionMaker.makeDecision(e,this.emotionalState,this.memory):null}shouldMakeDecision(){return Date.now()-this.lastDecisionTime>=this.calculateResponseTime()}calculateResponseTime(){const e=this.config.responseTime,t=e.min+Math.random()*(e.max-e.min);let s=1;return s*=1-.3*this.emotionalState.focus,s*=1+.2*this.emotionalState.excitement,s*=1+.1*this.emotionalState.frustration,s*=1.5-.1*this.config.difficulty,t*s}executeDecision(e,t){if(this.config.humanLikeErrors){const t=this.calculateErrorProbability();Math.random()<t&&(e=this.applyHumanError(e))}this.performAction(e.action,t),this.recordDecision(e,t),this.lastDecisionTime=Date.now()}calculateErrorProbability(){let e=(10-this.config.difficulty)/100;return e+=.05*this.emotionalState.frustration,e+=.03*(1-this.emotionalState.focus),e-=.02*this.emotionalState.confidence,e+=.03*(1-this.config.personality.consistency),Math.max(0,Math.min(.2,e))}applyHumanError(e){const t=["timing","precision","strategy","attention"];switch(t[Math.floor(Math.random()*t.length)]){case"timing":e.action=`delayed_${e.action}`;break;case"precision":e.confidence*=.8;break;case"strategy":e.alternativeActions.length>0&&(e.action=e.alternativeActions[Math.floor(Math.random()*e.alternativeActions.length)]);break;case"attention":Math.random()<.5&&(e.action="observe")}return e}performAction(e,t){this.recordAction(e,t,!0)}recordAction(e,t,s){const i={action:e,context:{gameState:t.score,aiScore:this.getCurrentAIScore(t),timeElapsed:t.timeElapsed},timestamp:Date.now(),success:s,playerState:{score:t.score,level:t.currentLevel}};this.memory.playerActions.push(i),this.memory.playerActions.length>200&&this.memory.playerActions.shift()}recordDecision(e,t){}adaptToPlayerBehavior(){if(!this.config.adaptiveStrategies)return;const e=this.analyzePatternCounters();this.updateStrategyEffectiveness(),this.adjustPersonality(e)}analyzePatternCounters(){const e=new Map;for(const t of this.memory.playerPatterns)for(const s of t.counters)e.set(s,(e.get(s)||0)+t.frequency*t.predictability);return e}updateStrategyEffectiveness(){for(const e of this.memory.successfulStrategies)e.usageCount>0&&(e.effectiveness=.9*e.effectiveness+.1*e.successRate)}adjustPersonality(e){e.get("aggressive")&&(this.config.personality.aggressiveness=Math.min(1,this.config.personality.aggressiveness+.02)),e.get("patient")&&(this.config.personality.patience=Math.min(1,this.config.personality.patience+.02));for(const[t,s]of Object.entries(this.config.personality))this.config.personality[t]=Math.max(.1,Math.min(.9,s))}initializeStrategies(){this.memory.successfulStrategies=[{id:"aggressive_rush",name:"Aggressive Rush",description:"Focus on quick, aggressive actions to pressure the player",conditions:[{type:"confidence",operator:">",value:.6}],actions:["attack","advance","pressure"],successRate:.5,usageCount:0,lastUsed:0,effectiveness:.5},{id:"defensive_patient",name:"Patient Defense",description:"Wait for player mistakes and capitalize on them",conditions:[{type:"patience",operator:">",value:.6}],actions:["defend","observe","counter"],successRate:.6,usageCount:0,lastUsed:0,effectiveness:.6},{id:"adaptive_mixed",name:"Adaptive Strategy",description:"Mix of strategies based on current situation",conditions:[{type:"adaptability",operator:">",value:.5}],actions:["analyze","adapt","respond"],successRate:.7,usageCount:0,lastUsed:0,effectiveness:.7}]}getCurrentAIScore(e){return 0}calculatePlayerPerformance(e){const t=Math.min(1,e.timeElapsed/3e5);return.5*Math.min(1,(e.score||0)/1e3)+.3*Math.min(1,e.currentLevel/10)+.2*(1-t)}calculateCurrentPerformance(e){return 0===this.recentPerformance.length?.5:this.recentPerformance.reduce((e,t)=>e+t,0)/this.recentPerformance.length}getCurrentStrategyScore(){return this.currentStrategy?.effectiveness||.5}calculateStrategyOutcome(e){return this.calculateCurrentPerformance(e)-this.calculatePlayerPerformance(e)+.5}recordStrategyOutcome(e,t){e.successRate=(e.successRate*e.usageCount+t)/(e.usageCount+1),t>.6?this.memory.successfulStrategies.includes(e)||this.memory.successfulStrategies.push(e):t<.4&&(this.memory.failedStrategies.includes(e)||this.memory.failedStrategies.push(e))}applyStrategyActions(e,t){for(const s of e)this.performAction(s,t)}getDifficulty(){return this.config.difficulty}setDifficulty(e){this.config.difficulty=Math.max(.1,Math.min(10,e))}getPersonality(){return{...this.config.personality}}setPersonality(e){this.config.personality={...this.config.personality,...e}}getEmotionalState(){return{...this.emotionalState}}getCurrentStrategy(){return this.currentStrategy}getMemory(){return this.memory}getPerformanceStats(){return{recentPerformance:[...this.recentPerformance],strategiesUsed:this.memory.successfulStrategies.length,patternsDetected:this.memory.playerPatterns.length,gamesPlayed:this.memory.winLossRecord.length,currentConfidence:this.emotionalState.confidence}}resetMemory(){this.memory={playerActions:[],successfulStrategies:[...this.memory.successfulStrategies],failedStrategies:[],playerPatterns:[],gameStateHistory:[],winLossRecord:[]}}exportAI(){return{config:this.config,memory:this.memory,emotionalState:this.emotionalState,recentPerformance:this.recentPerformance}}importAI(e){e.config&&(this.config={...this.config,...e.config}),e.memory&&(this.memory={...this.memory,...e.memory}),e.emotionalState&&(this.emotionalState={...e.emotionalState}),e.recentPerformance&&(this.recentPerformance=[...e.recentPerformance])}}class Mi{constructor(e){this.personality=e}execute(e,t){const s=[];for(const i of t.actions)this.shouldExecuteAction(i,e)&&s.push(i);return{success:s.length>0,actions:s}}shouldExecuteAction(e,t){let s=.7;return e.includes("aggressive")&&this.personality.aggressiveness>.6&&(s+=.2),e.includes("patient")&&this.personality.patience>.6&&(s+=.2),Math.random()<s}}class Ci{constructor(e){this.config=e}getAvailableStrategies(e,t){return[]}}class Ai{analyzePatterns(e){return[]}}class Ti{constructor(e){this.config=e}processExperience(e,t){}}class Pi{constructor(e,t){this.config=e,this.memory=t}makeDecision(e,t,s){return{action:"observe",confidence:.5,reasoning:"Gathering information",alternativeActions:["attack","defend"],expectedOutcome:{success:.5},timestamp:Date.now()}}}class _i{config;playerMetrics=new Map;adjustmentHistory=new Map;performancePredictor=new Ei;engagementAnalyzer=new Bi;skillAssessment=new Di;difficultyCurves=new Map([["beginner",{base:.3,growth:.05,max:2}],["casual",{base:.5,growth:.08,max:3}],["regular",{base:.8,growth:.12,max:5}],["hardcore",{base:1.2,growth:.18,max:8}],["expert",{base:2,growth:.15,max:10}]]);constructor(e){this.config={targetSuccessRate:.7,targetEngagementTime:5,adaptationRate:.3,minDifficulty:.2,maxDifficulty:8,smoothingFactor:.7,emergencyAdjustment:!0,personalizedAdjustment:!0,...e}}update(e){const t=e.userId;let s=this.playerMetrics.get(t);s||(s=this.initializePlayerMetrics(t,e.sessionId),this.playerMetrics.set(t,s)),this.updateSessionMetrics(s,e);const i=this.calculateDifficultyAdjustment(s,e),a=this.applyAdjustment(e.difficulty,i,s);return this.recordAdjustment(t,e.difficulty,a,i),a}initializePlayerMetrics(e,t){return{userId:e,sessionId:t,averageScore:0,completionRate:0,averageTime:0,mistakeRate:0,quitRate:0,totalPlayTime:0,sessionCount:0,lastPlayed:Date.now(),streakDays:0,learningCurve:[],consistencyRating:0,improvementRate:0,plateauDetection:!1,preferredDifficulty:1,preferredGameModes:[],playTimePatterns:new Array(24).fill(0),frustrationTolerance:.5,challengeSeekingBehavior:.5,currentStreak:0,currentMistakes:0,currentScore:gameState.score||0,sessionStartTime:Date.now(),lastActionTime:Date.now(),estimatedFrustration:0,estimatedEngagement:.5,estimatedConfidence:.5}}updateSessionMetrics(e,t){const s=Date.now(),i=s-e.sessionStartTime;e.currentScore=t.score||0,e.lastActionTime=s,i>3e4&&(e.learningCurve.push(t.score||0),e.learningCurve.length>20&&e.learningCurve.shift()),this.updateEmotionalState(e,t),this.updateBehavioralPatterns(e,t)}updateEmotionalState(e,t){const s=Date.now()-e.lastActionTime,i=this.calculateCurrentPerformance(e,t);let a=e.estimatedFrustration;i<.3?a=Math.min(1,a+.1):i>.8&&(a=Math.max(0,a-.05)),s>1e4&&(a=Math.min(1,a+.05)),e.estimatedFrustration=a;let n=e.estimatedEngagement;s<2e3&&i>.4?n=Math.min(1,n+.1):s>15e3&&(n=Math.max(0,n-.2)),e.estimatedEngagement=n;const r=e.learningCurve.slice(-5);if(r.length>2){const t=r.reduce((e,t)=>e+t,0)/r.length,s=r[r.length-1]-r[0];t>e.averageScore&&s>0?e.estimatedConfidence=Math.min(1,e.estimatedConfidence+.05):t<.7*e.averageScore&&(e.estimatedConfidence=Math.max(0,e.estimatedConfidence-.1))}}updateBehavioralPatterns(e,t){const s=(new Date).getHours();e.playTimePatterns[s]++;const i=this.calculateCurrentPerformance(e,t);i>.6?e.preferredDifficulty=Math.min(this.config.maxDifficulty,e.preferredDifficulty+.02):i<.3&&(e.preferredDifficulty=Math.max(this.config.minDifficulty,e.preferredDifficulty-.05)),e.estimatedFrustration>.8&&t.isRunning&&(e.frustrationTolerance=Math.min(1,e.frustrationTolerance+.01))}calculateCurrentPerformance(e,t){if(!t.timeElapsed||t.timeElapsed<1e4)return.5;const s=e.averageScore>0?(t.score||0)/e.averageScore:1,i=e.averageTime>0?e.averageTime/t.timeElapsed:1,a=t.currentLevel/(t.currentLevel+1);return Math.min(1,Math.max(0,.4*s+.3*i+.3*a))}calculateDifficultyAdjustment(e,t){const s=this.calculateCurrentPerformance(e,t);let i=0,a="No adjustment needed",n=.5;const r=s-this.config.targetSuccessRate;if(Math.abs(r)>.1&&(i=-r*this.config.adaptationRate,a=r>0?"Performance too high":"Performance too low",n=Math.min(.9,.3+Math.abs(r))),e.estimatedEngagement<.3?(i-=.1,a="Low engagement detected",n=Math.max(n,.6)):e.estimatedEngagement>.8&&s>.7&&(i+=.05,a="High engagement, good performance",n=Math.max(n,.7)),this.config.emergencyAdjustment&&e.estimatedFrustration>.8&&(i-=.2,a="High frustration - emergency adjustment",n=.9),this.config.personalizedAdjustment){const s=this.classifyPlayer(e),r=this.getPersonalizedAdjustment(s,e,t);i+=r,Math.abs(r)>.05&&(a+=` (${s} profile)`,n=Math.max(n,.8))}const o=this.analyzeSkillTrend(e);return o>.1?(i+=.05,a+=" (skill improvement detected)"):o<-.1&&(i-=.03,a+=" (skill decline detected)"),{previousDifficulty:t.difficulty,newDifficulty:0,adjustment:i,reason:a,confidence:n,timestamp:Date.now(),metrics:{successRate:s,avgTime:t.timeElapsed,engagementScore:e.estimatedEngagement,frustrationLevel:e.estimatedFrustration}}}classifyPlayer(e){const t=e.averageScore,s=e.completionRate,i=e.sessionCount;return e.improvementRate,t>1e3&&s>.8&&i>50?"expert":t>600&&s>.6&&i>20&&e.challengeSeekingBehavior>.7?"hardcore":t>300&&i>10&&e.totalPlayTime>36e5?"regular":i>5&&e.frustrationTolerance<.5?"casual":"beginner"}getPersonalizedAdjustment(e,t,s){const i=this.difficultyCurves.get(e);if(!i)return 0;return.1*(Math.min(i.max,i.base+s.currentLevel*i.growth)-s.difficulty)}analyzeSkillTrend(e){if(e.learningCurve.length<5)return 0;const t=e.learningCurve.slice(-5),s=e.learningCurve.slice(-10,-5);if(0===s.length)return 0;const i=t.reduce((e,t)=>e+t,0)/t.length,a=s.reduce((e,t)=>e+t,0)/s.length;return(i-a)/(a||1)}applyAdjustment(e,t,s){let i=e+t.adjustment;return i=e+(t.adjustment*(1-this.config.smoothingFactor)+(i-e)*this.config.smoothingFactor),i=Math.max(this.config.minDifficulty,Math.min(this.config.maxDifficulty,i)),Math.abs(i-e)<.01&&(i=e),t.newDifficulty=i,i}recordAdjustment(e,t,s,i){this.adjustmentHistory.has(e)||this.adjustmentHistory.set(e,[]);const a=this.adjustmentHistory.get(e);a.push({...i,previousDifficulty:t,newDifficulty:s}),a.length>50&&a.shift()}getPlayerMetrics(e){return this.playerMetrics.get(e)}getAdjustmentHistory(e){return this.adjustmentHistory.get(e)||[]}setPlayerMetrics(e,t){const s=this.playerMetrics.get(e);s&&Object.assign(s,t)}updateConfig(e){this.config={...this.config,...e}}getRecommendedDifficulty(e){const t=this.playerMetrics.get(e);if(!t)return 1;const s=this.classifyPlayer(t),i=this.difficultyCurves.get(s);if(!i)return t.preferredDifficulty;const a=Math.min(50,t.sessionCount);return Math.min(i.max,i.base+a*i.growth)}predictPerformance(e,t){const s=this.playerMetrics.get(e);return s?this.performancePredictor.predict(s,t):.5}getEngagementForecast(e){const t=this.playerMetrics.get(e);return t?this.engagementAnalyzer.forecastEngagement(t):.5}analyzePlayerSkill(e){const t=this.playerMetrics.get(e);return t?this.skillAssessment.analyzeSkill(t):null}exportPlayerData(e){return{metrics:this.playerMetrics.get(e),adjustmentHistory:this.adjustmentHistory.get(e)||[],playerType:this.playerMetrics.has(e)?this.classifyPlayer(this.playerMetrics.get(e)):"unknown",recommendations:{difficulty:this.getRecommendedDifficulty(e),predictedPerformance:this.predictPerformance(e,this.getRecommendedDifficulty(e)),engagementForecast:this.getEngagementForecast(e)}}}importPlayerData(e,t){t.metrics&&this.playerMetrics.set(e,t.metrics),t.adjustmentHistory&&this.adjustmentHistory.set(e,t.adjustmentHistory)}reset(e){e?(this.playerMetrics.delete(e),this.adjustmentHistory.delete(e)):(this.playerMetrics.clear(),this.adjustmentHistory.clear())}}class Ei{predict(e,t){const s=e.completionRate||.5,i=Math.max(0,1-.2*(t-1)),a=.1*e.improvementRate+1,n=.3*e.estimatedConfidence+.7;return Math.min(1,Math.max(0,s*i*a*n))}}class Bi{forecastEngagement(e){const t=e.estimatedEngagement,s=1-.5*e.estimatedFrustration,i=.05*e.preferredGameModes.length,a=Math.min(.2,.02*e.streakDays);return Math.min(1,Math.max(0,t*s+i+a))}}class Di{analyzeSkill(e){const t=this.calculateSkillLevel(e),s=this.calculateConsistency(e),i=this.calculatePotential(e);return{skillLevel:t,consistency:s,potential:i,category:this.categorizeSkill(t,s),recommendations:this.generateSkillRecommendations(t,s,i)}}calculateSkillLevel(e){return.4*Math.min(1,(e.averageScore||0)/1e3)+.3*(e.completionRate||0)+.3*(1-(e.consistencyRating||.5))}calculateConsistency(e){if(e.learningCurve.length<3)return.5;const t=e.learningCurve.reduce((e,t)=>e+t,0)/e.learningCurve.length,s=e.learningCurve.reduce((e,s)=>e+Math.pow(s-t,2),0)/e.learningCurve.length,i=Math.sqrt(s);return Math.max(0,1-i/(t||1))}calculatePotential(e){return.3*(e.improvementRate||0)+.3*(e.estimatedEngagement||.5)+.2*(e.frustrationTolerance||.5)+.2*(e.challengeSeekingBehavior||.5)}categorizeSkill(e,t){return e>.8&&t>.7?"expert":e>.6&&t>.5?"advanced":e>.4?"intermediate":e>.2?"novice":"beginner"}generateSkillRecommendations(e,t,s){const i=[];return e<.3&&(i.push("Focus on basic mechanics and fundamentals"),i.push("Practice regularly in lower difficulty settings")),t<.4&&(i.push("Work on maintaining consistent performance"),i.push("Try shorter, more focused practice sessions")),s>.7&&(i.push("Consider increasing difficulty for faster improvement"),i.push("Try more challenging game modes")),e>.7&&(i.push("Focus on advanced techniques and optimization"),i.push("Consider competitive play or leaderboard challenges")),i}}const Ri=Object.create(null);Ri.open="0",Ri.close="1",Ri.ping="2",Ri.pong="3",Ri.message="4",Ri.upgrade="5",Ri.noop="6";const Oi=Object.create(null);Object.keys(Ri).forEach(e=>{Oi[Ri[e]]=e});const Li={type:"error",data:"parser error"},Ii="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),zi="function"==typeof ArrayBuffer,Ui=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Fi=({type:e,data:t},s,i)=>Ii&&t instanceof Blob?s?i(t):qi(t,i):zi&&(t instanceof ArrayBuffer||Ui(t))?s?i(t):qi(new Blob([t]),i):i(Ri[e]+(t||"")),qi=(e,t)=>{const s=new FileReader;return s.onload=function(){const e=s.result.split(",")[1];t("b"+(e||""))},s.readAsDataURL(e)};function Hi(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let $i;const Gi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Wi="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let Zn=0;Zn<64;Zn++)Wi[Gi.charCodeAt(Zn)]=Zn;const Vi="function"==typeof ArrayBuffer,Ki=(e,t)=>{if("string"!=typeof e)return{type:"message",data:Yi(e,t)};const s=e.charAt(0);if("b"===s)return{type:"message",data:Qi(e.substring(1),t)};return Oi[s]?e.length>1?{type:Oi[s],data:e.substring(1)}:{type:Oi[s]}:Li},Qi=(e,t)=>{if(Vi){const s=(e=>{let t,s,i,a,n,r=.75*e.length,o=e.length,c=0;"="===e[e.length-1]&&(r--,"="===e[e.length-2]&&r--);const l=new ArrayBuffer(r),h=new Uint8Array(l);for(t=0;t<o;t+=4)s=Wi[e.charCodeAt(t)],i=Wi[e.charCodeAt(t+1)],a=Wi[e.charCodeAt(t+2)],n=Wi[e.charCodeAt(t+3)],h[c++]=s<<2|i>>4,h[c++]=(15&i)<<4|a>>2,h[c++]=(3&a)<<6|63&n;return l})(e);return Yi(s,t)}return{base64:!0,data:e}},Yi=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,Ji=String.fromCharCode(30);function Xi(){return new TransformStream({transform(e,t){!function(e,t){Ii&&e.data instanceof Blob?e.data.arrayBuffer().then(Hi).then(t):zi&&(e.data instanceof ArrayBuffer||Ui(e.data))?t(Hi(e.data)):Fi(e,!1,e=>{$i||($i=new TextEncoder),t($i.encode(e))})}(e,s=>{const i=s.length;let a;if(i<126)a=new Uint8Array(1),new DataView(a.buffer).setUint8(0,i);else if(i<65536){a=new Uint8Array(3);const e=new DataView(a.buffer);e.setUint8(0,126),e.setUint16(1,i)}else{a=new Uint8Array(9);const e=new DataView(a.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(i))}e.data&&"string"!=typeof e.data&&(a[0]|=128),t.enqueue(a),t.enqueue(s)})}})}let Zi;function ea(e){return e.reduce((e,t)=>e+t.length,0)}function ta(e,t){if(e[0].length===t)return e.shift();const s=new Uint8Array(t);let i=0;for(let a=0;a<t;a++)s[a]=e[0][i++],i===e[0].length&&(e.shift(),i=0);return e.length&&i<e[0].length&&(e[0]=e[0].slice(i)),s}function sa(e){if(e)return function(e){for(var t in sa.prototype)e[t]=sa.prototype[t];return e}(e)}sa.prototype.on=sa.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},sa.prototype.once=function(e,t){function s(){this.off(e,s),t.apply(this,arguments)}return s.fn=t,this.on(e,s),this},sa.prototype.off=sa.prototype.removeListener=sa.prototype.removeAllListeners=sa.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var s,i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var a=0;a<i.length;a++)if((s=i[a])===t||s.fn===t){i.splice(a,1);break}return 0===i.length&&delete this._callbacks["$"+e],this},sa.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),s=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(s){i=0;for(var a=(s=s.slice(0)).length;i<a;++i)s[i].apply(this,t)}return this},sa.prototype.emitReserved=sa.prototype.emit,sa.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},sa.prototype.hasListeners=function(e){return!!this.listeners(e).length};const ia="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),aa="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function na(e,...t){return t.reduce((t,s)=>(e.hasOwnProperty(s)&&(t[s]=e[s]),t),{})}const ra=aa.setTimeout,oa=aa.clearTimeout;function ca(e,t){t.useNativeTimers?(e.setTimeoutFn=ra.bind(aa),e.clearTimeoutFn=oa.bind(aa)):(e.setTimeoutFn=aa.setTimeout.bind(aa),e.clearTimeoutFn=aa.clearTimeout.bind(aa))}function la(e){return"string"==typeof e?function(e){let t=0,s=0;for(let i=0,a=e.length;i<a;i++)t=e.charCodeAt(i),t<128?s+=1:t<2048?s+=2:t<55296||t>=57344?s+=3:(i++,s+=4);return s}(e):Math.ceil(1.33*(e.byteLength||e.size))}function ha(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class da extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}class ua extends sa{constructor(e){super(),this.writable=!1,ca(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,s){return super.emitReserved("error",new da(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Ki(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let s in e)e.hasOwnProperty(s)&&(t.length&&(t+="&"),t+=encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t}(e);return t.length?"?"+t:""}}class ma extends ua{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",function(){--e||t()})),this.writable||(e++,this.once("drain",function(){--e||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const s=e.split(Ji),i=[];for(let a=0;a<s.length;a++){const e=Ki(s[a],t);if(i.push(e),"error"===e.type)break}return i})(e,this.socket.binaryType).forEach(e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)}),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const s=e.length,i=new Array(s);let a=0;e.forEach((e,n)=>{Fi(e,!1,e=>{i[n]=e,++a===s&&t(i.join(Ji))})})})(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=ha()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}let pa=!1;try{pa="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Xn){}const fa=pa;function xa(){}class ya extends ma{constructor(e){if(super(e),"undefined"!=typeof location){const t="https:"===location.protocol;let s=location.port;s||(s=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||s!==e.port}}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}class ga extends sa{constructor(e,t,s){super(),this.createRequest=e,ca(this,s),this._opts=s,this._method=s.method||"GET",this._uri=t,this._data=void 0!==s.data?s.data:null,this._create()}_create(){var e;const t=na(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(t);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let e in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&s.setRequestHeader(e,this._opts.extraHeaders[e])}}catch(ct){}if("POST"===this._method)try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(ct){}try{s.setRequestHeader("Accept","*/*")}catch(ct){}null===(e=this._opts.cookieJar)||void 0===e||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var e;3===s.readyState&&(null===(e=this._opts.cookieJar)||void 0===e||e.parseCookies(s.getResponseHeader("set-cookie"))),4===s.readyState&&(200===s.status||1223===s.status?this._onLoad():this.setTimeoutFn(()=>{this._onError("number"==typeof s.status?s.status:0)},0))},s.send(this._data)}catch(ct){return void this.setTimeoutFn(()=>{this._onError(ct)},0)}"undefined"!=typeof document&&(this._index=ga.requestsCount++,ga.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(void 0!==this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=xa,e)try{this._xhr.abort()}catch(ct){}"undefined"!=typeof document&&delete ga.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}if(ga.requestsCount=0,ga.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",ba);else if("function"==typeof addEventListener){addEventListener("onpagehide"in aa?"pagehide":"unload",ba,!1)}function ba(){for(let e in ga.requests)ga.requests.hasOwnProperty(e)&&ga.requests[e].abort()}const va=function(){const e=wa({xdomain:!1});return e&&null!==e.responseType}();function wa(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||fa))return new XMLHttpRequest}catch(ct){}if(!t)try{return new(aa[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(ct){}}const ja="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class Sa extends ua{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,s=ja?{}:na(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,s)}catch(Xn){return this.emitReserved("error",Xn)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],i=t===e.length-1;Fi(s,this.supportsBinary,e=>{try{this.doWrite(s,e)}catch(ct){}i&&ia(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=ha()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const Na=aa.WebSocket||aa.MozWebSocket;const ka={websocket:class extends Sa{createSocket(e,t,s){return ja?new Na(e,t,s):t?new Na(e,t):new Na(e)}doWrite(e,t){this.ws.send(t)}},webtransport:class extends ua{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(Xn){return this.emitReserved("error",Xn)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=function(e,t){Zi||(Zi=new TextDecoder);const s=[];let i=0,a=-1,n=!1;return new TransformStream({transform(r,o){for(s.push(r);;){if(0===i){if(ea(s)<1)break;const e=ta(s,1);n=!(128&~e[0]),a=127&e[0],i=a<126?3:126===a?1:2}else if(1===i){if(ea(s)<2)break;const e=ta(s,2);a=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),i=3}else if(2===i){if(ea(s)<8)break;const e=ta(s,8),t=new DataView(e.buffer,e.byteOffset,e.length),n=t.getUint32(0);if(n>Math.pow(2,21)-1){o.enqueue(Li);break}a=n*Math.pow(2,32)+t.getUint32(4),i=3}else{if(ea(s)<a)break;const e=ta(s,a);o.enqueue(Ki(n?e:Zi.decode(e),t)),i=0}if(0===a||a>e){o.enqueue(Li);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(t).getReader(),i=Xi();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();const a=()=>{s.read().then(({done:e,value:t})=>{e||(this.onPacket(t),a())}).catch(e=>{})};a();const n={type:"open"};this.query.sid&&(n.data=`{"sid":"${this.query.sid}"}`),this._writer.write(n).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],i=t===e.length-1;this._writer.write(s).then(()=>{i&&ia(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;null===(e=this._transport)||void 0===e||e.close()}},polling:class extends ya{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=va&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new ga(wa,this.uri(),e)}}},Ma=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ca=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Aa(e){if(e.length>8e3)throw"URI too long";const t=e,s=e.indexOf("["),i=e.indexOf("]");-1!=s&&-1!=i&&(e=e.substring(0,s)+e.substring(s,i).replace(/:/g,";")+e.substring(i,e.length));let a=Ma.exec(e||""),n={},r=14;for(;r--;)n[Ca[r]]=a[r]||"";return-1!=s&&-1!=i&&(n.source=t,n.host=n.host.substring(1,n.host.length-1).replace(/;/g,":"),n.authority=n.authority.replace("[","").replace("]","").replace(/;/g,":"),n.ipv6uri=!0),n.pathNames=function(e,t){const s=/\/{2,9}/g,i=t.replace(s,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||i.splice(0,1);"/"==t.slice(-1)&&i.splice(i.length-1,1);return i}(0,n.path),n.queryKey=function(e,t){const s={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,i){t&&(s[t]=i)}),s}(0,n.query),n}const Ta="function"==typeof addEventListener&&"function"==typeof removeEventListener,Pa=[];Ta&&addEventListener("offline",()=>{Pa.forEach(e=>e())},!1);class _a extends sa{constructor(e,t){if(super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"==typeof e&&(t=e,e=null),e){const s=Aa(e);t.hostname=s.host,t.secure="https"===s.protocol||"wss"===s.protocol,t.port=s.port,s.query&&(t.query=s.query)}else t.host&&(t.hostname=Aa(t.host).host);ca(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(e=>{const t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},s=e.split("&");for(let i=0,a=s.length;i<a;i++){let e=s[i].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}(this.opts.query)),Ta&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Pa.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](s)}_open(){if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);const e=this.opts.rememberUpgrade&&_a.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){this.readyState="open",_a.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const s=this.writeBuffer[t].data;if(s&&(e+=la(s)),t>0&&e>this._maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,ia(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,s){return this._sendPacket("message",e,t,s),this}send(e,t,s){return this._sendPacket("message",e,t,s),this}_sendPacket(e,t,s,i){if("function"==typeof t&&(i=t,t=void 0),"function"==typeof s&&(i=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;(s=s||{}).compress=!1!==s.compress;const a={type:e,data:t,options:s};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}_onError(e){if(_a.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Ta&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=Pa.indexOf(this._offlineEventListener);-1!==e&&Pa.splice(e,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}_a.protocol=4;class Ea extends _a{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),s=!1;_a.priorWebsocketSuccess=!1;const i=()=>{s||(t.send([{type:"ping",data:"probe"}]),t.once("packet",e=>{if(!s)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;_a.priorWebsocketSuccess="websocket"===t.name,this.transport.pause(()=>{s||"closed"!==this.readyState&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}}))};function a(){s||(s=!0,l(),t.close(),t=null)}const n=e=>{const s=new Error("probe error: "+e);s.transport=t.name,a(),this.emitReserved("upgradeError",s)};function r(){n("transport closed")}function o(){n("socket closed")}function c(e){t&&e.name!==t.name&&a()}const l=()=>{t.removeListener("open",i),t.removeListener("error",n),t.removeListener("close",r),this.off("close",o),this.off("upgrading",c)};t.once("open",i),t.once("error",n),t.once("close",r),this.once("close",o),this.once("upgrading",c),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{s||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let s=0;s<e.length;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}}let Ba=class extends Ea{constructor(e,t={}){const s="object"==typeof e?e:t;(!s.transports||s.transports&&"string"==typeof s.transports[0])&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(e=>ka[e]).filter(e=>!!e)),super(e,s)}};const Da="function"==typeof ArrayBuffer,Ra=Object.prototype.toString,Oa="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Ra.call(Blob),La="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Ra.call(File);function Ia(e){return Da&&(e instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||Oa&&e instanceof Blob||La&&e instanceof File}function za(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,s=e.length;t<s;t++)if(za(e[t]))return!0;return!1}if(Ia(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return za(e.toJSON(),!0);for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&za(e[s]))return!0;return!1}function Ua(e){const t=[],s=e.data,i=e;return i.data=Fa(s,t),i.attachments=t.length,{packet:i,buffers:t}}function Fa(e,t){if(!e)return e;if(Ia(e)){const s={_placeholder:!0,num:t.length};return t.push(e),s}if(Array.isArray(e)){const s=new Array(e.length);for(let i=0;i<e.length;i++)s[i]=Fa(e[i],t);return s}if("object"==typeof e&&!(e instanceof Date)){const s={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=Fa(e[i],t));return s}return e}function qa(e,t){return e.data=Ha(e.data,t),delete e.attachments,e}function Ha(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let s=0;s<e.length;s++)e[s]=Ha(e[s],t);else if("object"==typeof e)for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(e[s]=Ha(e[s],t));return e}const $a=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var Ga;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(Ga||(Ga={}));function Wa(e){return"[object Object]"===Object.prototype.toString.call(e)}class Va extends sa{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const s=t.type===Ga.BINARY_EVENT;s||t.type===Ga.BINARY_ACK?(t.type=s?Ga.EVENT:Ga.ACK,this.reconstructor=new Ka(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!Ia(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(void 0===Ga[s.type])throw new Error("unknown packet type "+s.type);if(s.type===Ga.BINARY_EVENT||s.type===Ga.BINARY_ACK){const i=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const a=e.substring(i,t);if(a!=Number(a)||"-"!==e.charAt(t))throw new Error("Illegal attachments");s.attachments=Number(a)}if("/"===e.charAt(t+1)){const i=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}s.nsp=e.substring(i,t)}else s.nsp="/";const i=e.charAt(t+1);if(""!==i&&Number(i)==i){const i=t+1;for(;++t;){const s=e.charAt(t);if(null==s||Number(s)!=s){--t;break}if(t===e.length)break}s.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=this.tryParse(e.substr(t));if(!Va.isPayloadValid(s.type,i))throw new Error("invalid payload");s.data=i}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(ct){return!1}}static isPayloadValid(e,t){switch(e){case Ga.CONNECT:return Wa(t);case Ga.DISCONNECT:return void 0===t;case Ga.CONNECT_ERROR:return"string"==typeof t||Wa(t);case Ga.EVENT:case Ga.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===$a.indexOf(t[0]));case Ga.ACK:case Ga.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Ka{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=qa(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Qa=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Va,Encoder:class{constructor(e){this.replacer=e}encode(e){return e.type!==Ga.EVENT&&e.type!==Ga.ACK||!za(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===Ga.EVENT?Ga.BINARY_EVENT:Ga.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==Ga.BINARY_EVENT&&e.type!==Ga.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Ua(e),s=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(s),i}},get PacketType(){return Ga},protocol:5},Symbol.toStringTag,{value:"Module"}));function Ya(e,t,s){return e.on(t,s),function(){e.off(t,s)}}const Ja=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Xa extends sa{constructor(e,t,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Ya(e,"open",this.onopen.bind(this)),Ya(e,"packet",this.onpacket.bind(this)),Ya(e,"error",this.onerror.bind(this)),Ya(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var s,i,a;if(Ja.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const n={type:Ga.EVENT,data:t,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,s=t.pop();this._registerAckCallback(e,s),n.id=e}const r=null===(i=null===(s=this.io.engine)||void 0===s?void 0:s.transport)||void 0===i?void 0:i.writable,o=this.connected&&!(null===(a=this.io.engine)||void 0===a?void 0:a._hasPingExpired());return this.flags.volatile&&!r||(o?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var s;const i=null!==(s=this.flags.timeout)&&void 0!==s?s:this._opts.ackTimeout;if(void 0===i)return void(this.acks[e]=t);const a=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))},i),n=(...e)=>{this.io.clearTimeoutFn(a),t.apply(this,e)};n.withError=!0,this.acks[e]=n}emitWithAck(e,...t){return new Promise((s,i)=>{const a=(e,t)=>e?i(e):s(t);a.withError=!0,t.push(a),this.emit(e,...t)})}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((e,...i)=>{if(s!==this._queue[0])return;return null!==e?s.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...i)),s.pending=!1,this._drainQueue()}),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Ga.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Ga.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Ga.EVENT:case Ga.BINARY_EVENT:this.onevent(e);break;case Ga.ACK:case Ga.BINARY_ACK:this.onack(e);break;case Ga.DISCONNECT:this.ondisconnect();break;case Ga.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const s of t)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let s=!1;return function(...i){s||(s=!0,t.packet({type:Ga.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Ga.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const s of t)s.apply(this,e.data)}}}function Za(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Za.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),s=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+s:e-s}return 0|Math.min(e,this.max)},Za.prototype.reset=function(){this.attempts=0},Za.prototype.setMin=function(e){this.ms=e},Za.prototype.setMax=function(e){this.max=e},Za.prototype.setJitter=function(e){this.jitter=e};class en extends sa{constructor(e,t){var s;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,ca(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(s=t.randomizationFactor)&&void 0!==s?s:.5),this.backoff=new Za({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||Qa;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Ba(this.uri,this.opts);const t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const i=Ya(t,"open",function(){s.onopen(),e&&e()}),a=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},n=Ya(t,"error",a);if(!1!==this._timeout){const e=this._timeout,s=this.setTimeoutFn(()=>{i(),a(new Error("timeout")),t.close()},e);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}return this.subs.push(i),this.subs.push(n),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Ya(e,"ping",this.onping.bind(this)),Ya(e,"data",this.ondata.bind(this)),Ya(e,"error",this.onerror.bind(this)),Ya(e,"close",this.onclose.bind(this)),Ya(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(ct){this.onclose("parse error",ct)}}ondecoded(e){ia(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new Xa(this,e,t),this.nsps[e]=s),s}_destroy(e){const t=Object.keys(this.nsps);for(const s of t){if(this.nsps[s].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var s;this.cleanup(),null===(s=this.engine)||void 0===s||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open(t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()}))},t);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const tn={};function sn(e,t){"object"==typeof e&&(t=e,e=void 0);const s=function(e,t="",s){let i=e;s=s||"undefined"!=typeof location&&location,null==e&&(e=s.protocol+"//"+s.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?s.protocol+e:s.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==s?s.protocol+"//"+e:"https://"+e),i=Aa(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const a=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+a+":"+i.port+t,i.href=i.protocol+"://"+a+(s&&s.port===i.port?"":":"+i.port),i}(e,(t=t||{}).path||"/socket.io"),i=s.source,a=s.id,n=s.path,r=tn[a]&&n in tn[a].nsps;let o;return t.forceNew||t["force new connection"]||!1===t.multiplex||r?o=new en(i,t):(tn[a]||(tn[a]=new en(i,t)),o=tn[a]),s.query&&!t.query&&(t.query=s.queryKey),o.socket(s.path,t)}Object.assign(sn,{Manager:en,Socket:Xa,io:sn,connect:sn});var an={};class nn extends gi{config;socket;playerId="";roomId="";isHost=!1;isConnected=!1;localPlayerState;remotePlayerStates=new Map;gameSnapshots=[];lastSnapshot;sequenceNumber=0;lastAckedSequence=0;pendingInputs=[];serverSnapshots=[];networkStats={ping:0,jitter:0,packetLoss:0,bandwidth:{in:0,out:0},messagesPerSecond:{in:0,out:0},compressionRatio:1};clockSync=new rn;stateBuffer=new on;predictor=new cn;interpolator=new ln;cheatDetector=new hn;lastSyncTime=Date.now();syncInterval;pingInterval;statsUpdateInterval;constructor(e){super(),this.config=e,this.localPlayerState={playerId:"",position:{x:0,y:0},velocity:{x:0,y:0},rotation:0,animationState:"idle",inputState:{},timestamp:Date.now(),sequenceNumber:0}}async initialize(e){if(this.config.enabled){this.playerId=e,this.localPlayerState.playerId=e;try{await this.connect(),this.setupEventHandlers(),this.startSyncLoop(),this.startPingLoop(),this.startStatsTracking(),this.emit("initialized")}catch(t){throw this.emit("error",t),t}}}async connect(){return new Promise((e,t)=>{const s=an.REACT_APP_SERVER_URL||"http://localhost:3001";this.socket=sn(s,{transports:["websocket","polling"],timeout:5e3,auth:{userId:this.playerId},query:{clientType:"game"}}),this.socket.on("connect",()=>{this.isConnected=!0,e()}),this.socket.on("connect_error",e=>{t(e)}),this.socket.on("disconnect",e=>{this.isConnected=!1,this.emit("disconnected",e)})})}setupEventHandlers(){this.socket&&(this.socket.on("room_joined",e=>{this.roomId=e.roomId,this.emit("roomJoined",e)}),this.socket.on("room_left",()=>{this.roomId="",this.emit("roomLeft")}),this.socket.on("player_joined",e=>{this.emit("playerJoined",e)}),this.socket.on("player_left",e=>{this.remotePlayerStates.delete(e),this.emit("playerLeft",e)}),this.socket.on("host_changed",e=>{this.isHost=e===this.playerId,this.emit("hostChanged",e)}),this.socket.on("game_state_update",e=>{this.handleServerSnapshot(e)}),this.socket.on("player_state_update",e=>{this.handlePlayerStateUpdate(e)}),this.socket.on("input_acknowledged",e=>{this.handleInputAcknowledgment(e)}),this.socket.on("ping_response",e=>{this.handlePingResponse(e)}),this.socket.on("network_stats",e=>{this.updateNetworkStats(e)}),this.socket.on("error",e=>{this.emit("error",e)}),this.socket.on("cheat_detected",e=>{this.emit("cheatDetected",e)}))}async joinRoom(e,t){if(!this.socket||!this.isConnected)throw new Error("Not connected to server");return new Promise((s,i)=>{const a=setTimeout(()=>{i(new Error("Join room timeout"))},1e4);this.socket.once("room_joined",e=>{clearTimeout(a),this.roomId=e.roomId,this.isHost=e.players.find(e=>e.playerId===this.playerId)?.isHost||!1,s(e)}),this.socket.once("join_room_error",e=>{clearTimeout(a),i(new Error(e.message||"Failed to join room"))}),this.socket.emit("join_room",{gameId:e,roomId:t,playerInfo:{playerId:this.playerId,username:"Player",avatar:""}})})}leaveRoom(){this.socket&&this.roomId&&(this.socket.emit("leave_room",{roomId:this.roomId}),this.roomId="",this.isHost=!1,this.remotePlayerStates.clear())}syncState(e){if(!this.config.enabled||!this.socket||!this.roomId)return;const t=Date.now();this.localPlayerState.timestamp=t,this.localPlayerState.sequenceNumber=++this.sequenceNumber;const s={timestamp:t,sequenceNumber:this.sequenceNumber,playerStates:new Map([[this.playerId,this.localPlayerState]]),gameObjects:[],gameState:e};this.gameSnapshots.push(s),this.gameSnapshots.length>60&&this.gameSnapshots.shift(),this.sendToServer("game_state_sync",{snapshot:this.compressSnapshot(s),checksum:this.config.antiCheat?this.calculateChecksum(s):void 0})}sendInput(e){if(!this.socket||!this.roomId)return;const t={playerId:this.playerId,inputData:e,timestamp:Date.now(),sequenceNumber:++this.sequenceNumber};this.pendingInputs.push(t),this.pendingInputs.length>120&&this.pendingInputs.shift(),this.sendToServer("player_input",t),this.config.lagCompensation&&this.predictor.applyInput(t,this.localPlayerState)}sendToServer(e,t){if(!this.socket||!this.isConnected)return;const s={id:`${this.playerId}_${Date.now()}_${Math.random()}`,type:e,data:this.config.compressionEnabled?this.compressData(t):t,timestamp:Date.now(),sequenceNumber:this.sequenceNumber};this.socket.emit(e,s);const i=JSON.stringify(s).length;this.networkStats.bandwidth.out+=i}handleServerSnapshot(e){this.serverSnapshots.push(e),this.serverSnapshots.length>30&&this.serverSnapshots.shift();for(const[t,s]of e.playerStates)t!==this.playerId&&this.remotePlayerStates.set(t,s);this.config.lagCompensation&&e.playerStates.has(this.playerId)&&this.reconcileState(e),this.stateBuffer.addSnapshot(e),this.emit("serverSnapshot",e)}handlePlayerStateUpdate(e){for(const t of e)t.playerId!==this.playerId&&this.remotePlayerStates.set(t.playerId,t);this.emit("playerStatesUpdated",e)}handleInputAcknowledgment(e){this.lastAckedSequence=e,this.pendingInputs=this.pendingInputs.filter(t=>t.sequenceNumber>e)}reconcileState(e){const t=e.playerStates.get(this.playerId);if(!t)return;const s=this.gameSnapshots.find(t=>t.sequenceNumber===e.sequenceNumber);if(!s)return;const i=s.playerStates.get(this.playerId);if(!i)return;const a=Math.sqrt(Math.pow(t.position.x-i.position.x,2)+Math.pow(t.position.y-i.position.y,2));if(a>5){this.localPlayerState.position={...t.position};const s=this.pendingInputs.filter(t=>t.sequenceNumber>e.sequenceNumber);for(const e of s)this.predictor.applyInput(e,this.localPlayerState);this.emit("stateReconciled",{difference:a,correctedState:this.localPlayerState})}}handlePingResponse(e){const t=Date.now(),s=t-e.timestamp;this.networkStats.ping=.8*this.networkStats.ping+.2*s,this.clockSync.updateOffset(e.serverTime,t,s);const i=Math.abs(s-this.networkStats.ping);this.networkStats.jitter=.9*this.networkStats.jitter+.1*i}updateNetworkStats(e){Object.assign(this.networkStats,e),this.emit("networkStatsUpdated",this.networkStats)}startSyncLoop(){const e=1e3/this.config.syncFrequency;this.syncInterval=setInterval(()=>{this.isConnected&&this.roomId&&(this.updateInterpolatedStates(),this.emit("syncTick",{localPlayer:this.localPlayerState,remotePlayers:Array.from(this.remotePlayerStates.values()),networkStats:this.networkStats}))},e)}startPingLoop(){this.pingInterval=setInterval(()=>{this.socket&&this.isConnected&&this.socket.emit("ping",{timestamp:Date.now()})},1e3)}startStatsTracking(){this.statsUpdateInterval=setInterval(()=>{this.networkStats.messagesPerSecond={in:0,out:0},this.networkStats.bandwidth={in:0,out:0}},1e3)}updateInterpolatedStates(){const e=Date.now()-this.config.interpolationBuffer;for(const[t,s]of this.remotePlayerStates){const s=this.interpolator.interpolateState(t,e);s&&this.remotePlayerStates.set(t,s)}}compressSnapshot(e){if(!this.config.compressionEnabled)return e;const t={t:e.timestamp,s:e.sequenceNumber,p:Array.from(e.playerStates.values()).map(e=>({id:e.playerId,x:Math.round(e.position.x),y:Math.round(e.position.y),vx:Math.round(10*e.velocity.x)/10,vy:Math.round(10*e.velocity.y)/10,r:Math.round(100*e.rotation)/100,a:e.animationState})),gs:e.gameState},s=JSON.stringify(e).length,i=JSON.stringify(t).length;return this.networkStats.compressionRatio=s/i,t}compressData(e){return e}calculateChecksum(e){const t=JSON.stringify(e);let s=0;for(let i=0;i<t.length;i++){s=(s<<5)-s+t.charCodeAt(i),s&=s}return s.toString(16)}getNetworkStats(){return{...this.networkStats}}getPlayerStates(){const e=new Map(this.remotePlayerStates);return e.set(this.playerId,this.localPlayerState),e}updateLocalPlayerState(e){Object.assign(this.localPlayerState,e),this.localPlayerState.timestamp=Date.now()}isRoomHost(){return this.isHost}getRoomId(){return this.roomId}getPlayerId(){return this.playerId}isMultiplayerEnabled(){return this.config.enabled&&this.isConnected&&""!==this.roomId}setConfig(e){this.config={...this.config,...e}}kickPlayer(e){this.isHost&&this.socket&&this.socket.emit("kick_player",{roomId:this.roomId,playerId:e})}sendChatMessage(e){this.socket&&this.roomId&&this.socket.emit("chat_message",{roomId:this.roomId,playerId:this.playerId,message:e,timestamp:Date.now()})}destroy(){this.syncInterval&&clearInterval(this.syncInterval),this.pingInterval&&clearInterval(this.pingInterval),this.statsUpdateInterval&&clearInterval(this.statsUpdateInterval),this.leaveRoom(),this.socket&&(this.socket.disconnect(),this.socket=void 0),this.remotePlayerStates.clear(),this.gameSnapshots=[],this.serverSnapshots=[],this.pendingInputs=[],this.removeAllListeners()}}class rn{serverTimeOffset=0;samples=[];updateOffset(e,t,s){const i=e-t+s/2;this.samples.push({offset:i,rtt:s}),this.samples.length>10&&this.samples.shift();const a=this.samples.reduce((e,t)=>t.rtt<e.rtt?t:e);this.serverTimeOffset=a.offset}getServerTime(){return Date.now()+this.serverTimeOffset}}class on{snapshots=[];addSnapshot(e){this.snapshots.push(e),this.snapshots.sort((e,t)=>e.timestamp-t.timestamp);const t=Date.now()-1e3;this.snapshots=this.snapshots.filter(e=>e.timestamp>t)}getSnapshotAt(e){return this.snapshots.find(t=>Math.abs(t.timestamp-e)<50)}getSnapshotsAround(e){let t,s;for(const i of this.snapshots)if(i.timestamp<=e)t=i;else if(!s){s=i;break}return{before:t,after:s}}}class cn{applyInput(e,t){e.inputData.moveX&&(t.velocity.x=100*e.inputData.moveX),e.inputData.moveY&&(t.velocity.y=100*e.inputData.moveY);const s=.01667;t.position.x+=t.velocity.x*s,t.position.y+=t.velocity.y*s}}class ln{playerBuffers=new Map;interpolateState(e,t){const s=this.playerBuffers.get(e);if(!s||s.length<2)return;let i,a;for(let o=0;o<s.length-1;o++)if(s[o].timestamp<=t&&s[o+1].timestamp>t){i=s[o],a=s[o+1];break}if(!i||!a)return s[s.length-1];const n=a.timestamp-i.timestamp,r=(t-i.timestamp)/n;return{playerId:e,position:{x:i.position.x+(a.position.x-i.position.x)*r,y:i.position.y+(a.position.y-i.position.y)*r},velocity:{x:i.velocity.x+(a.velocity.x-i.velocity.x)*r,y:i.velocity.y+(a.velocity.y-i.velocity.y)*r},rotation:i.rotation+(a.rotation-i.rotation)*r,animationState:a.animationState,inputState:a.inputState,timestamp:t,sequenceNumber:a.sequenceNumber}}addPlayerState(e,t){this.playerBuffers.has(e)||this.playerBuffers.set(e,[]);const s=this.playerBuffers.get(e);s.push(t),s.sort((e,t)=>e.timestamp-t.timestamp);const i=Date.now()-500,a=s.filter(e=>e.timestamp>i);this.playerBuffers.set(e,a)}}class hn{speedLimits={maxSpeed:200,maxAcceleration:500};violations=new Map;validatePlayerState(e,t,s){const i=(s.timestamp-t.timestamp)/1e3;if(i<=0)return!1;if(Math.sqrt(s.velocity.x**2+s.velocity.y**2)>this.speedLimits.maxSpeed)return this.recordViolation(e,"speed_limit"),!1;const a=(s.velocity.x-t.velocity.x)/i,n=(s.velocity.y-t.velocity.y)/i;return!(Math.sqrt(a**2+n**2)>this.speedLimits.maxAcceleration)||(this.recordViolation(e,"acceleration_limit"),!1)}recordViolation(e,t){const s=this.violations.get(e)||0;this.violations.set(e,s+1)}}class dn extends gi{isMonitoring=!1;metrics;thresholds;metricsHistory=[];alertHistory=[];maxHistorySize=300;lastFrameTime=0;frameCount=0;lastFPSUpdate=0;fpsBuffer=[];frameTimeBuffer=[];memoryObserver;lastMemoryCheck=0;memoryCheckInterval=1e3;networkObserver;lastNetworkCheck=0;networkBuffer=[];adaptiveMonitoring=!0;monitoringLevel="medium";backgroundMonitoring=!0;deviceCapabilities={maxConcurrentTextures:16,maxTextureSize:2048,supportsWebGL2:!1,supportsWebGPU:!1,hardwareConcurrency:navigator.hardwareConcurrency||4,deviceMemory:navigator.deviceMemory||4};constructor(e){super(),this.thresholds={minFPS:30,maxFrameTime:33.33,maxMemoryUsage:524288e3,maxCPUUsage:80,maxNetworkLatency:200,warningThresholds:{fps:45,memory:314572800,cpu:60,latency:100},...e},this.metrics=this.createInitialMetrics(),this.detectDeviceCapabilities()}start(){this.isMonitoring||(this.isMonitoring=!0,this.lastFrameTime=performance.now(),this.lastFPSUpdate=this.lastFrameTime,this.setupPerformanceObservers(),this.startMonitoringLoop(),this.emit("started"))}stop(){this.isMonitoring&&(this.isMonitoring=!1,this.cleanup(),this.emit("stopped"))}update(){if(!this.isMonitoring)return;const e=performance.now();this.updateFrameMetrics(e),this.updateMemoryMetrics(),this.updateCPUMetrics(),this.updateNetworkMetrics(),this.refreshGameMetrics(),this.updateDeviceMetrics(),this.calculateScores(),this.checkThresholds(),this.storeMetrics(),this.emit("performanceUpdate",this.metrics)}createInitialMetrics(){return{fps:0,frameTime:0,frameDelta:0,frameJitter:0,memoryUsage:{used:0,total:0,percentage:0},heapUsage:{usedJSHeapSize:0,totalJSHeapSize:0,jsHeapSizeLimit:0},cpuUsage:0,mainThreadTime:0,idleTime:0,drawCalls:0,triangles:0,textureMemory:0,networkLatency:0,packetsLost:0,bandwidth:{up:0,down:0},gameObjects:0,activePhysicsBodies:0,soundsPlaying:0,deviceMemoryPressure:"nominal",overallScore:100,stabilityScore:100,efficiencyScore:100}}detectDeviceCapabilities(){const e=document.createElement("canvas").getContext("webgl2");this.deviceCapabilities.supportsWebGL2=!!e,e&&(this.deviceCapabilities.maxConcurrentTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.deviceCapabilities.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)),this.deviceCapabilities.supportsWebGPU="gpu"in navigator;const t=navigator;t.deviceMemory&&(this.deviceCapabilities.deviceMemory=t.deviceMemory)}setupPerformanceObservers(){if("PerformanceObserver"in window)try{this.memoryObserver=new PerformanceObserver(e=>{for(const t of e.getEntries())"memory"===t.entryType&&this.updateMemoryFromObserver(t)}),this.memoryObserver.observe({entryTypes:["memory"]}),this.networkObserver=new PerformanceObserver(e=>{for(const t of e.getEntries())"navigation"!==t.entryType&&"resource"!==t.entryType||this.updateNetworkFromObserver(t)}),this.networkObserver.observe({entryTypes:["navigation","resource"]})}catch(e){}}startMonitoringLoop(){const e=this.getMonitoringInterval(),t=()=>{if(!this.isMonitoring)return;this.update();const s=this.adaptiveMonitoring?this.calculateAdaptiveInterval():e;setTimeout(t,s)};t()}getMonitoringInterval(){switch(this.monitoringLevel){case"low":return 1e3;case"medium":default:return 500;case"high":return 100}}calculateAdaptiveInterval(){const e=this.getMonitoringInterval();return this.metrics.fps<this.thresholds.warningThresholds.fps?Math.min(2*e,2e3):this.metrics.overallScore<50?Math.max(e/2,50):e}updateFrameMetrics(e){this.frameCount++;const t=e-this.lastFrameTime;if(this.metrics.frameDelta=t,this.metrics.frameTime=t,this.frameTimeBuffer.push(t),this.frameTimeBuffer.length>60&&this.frameTimeBuffer.shift(),this.frameTimeBuffer.length>10){const e=this.frameTimeBuffer.reduce((e,t)=>e+t,0)/this.frameTimeBuffer.length,t=this.frameTimeBuffer.reduce((t,s)=>t+Math.pow(s-e,2),0)/this.frameTimeBuffer.length;this.metrics.frameJitter=Math.sqrt(t)}if(e-this.lastFPSUpdate>=1e3){const t=Math.round(1e3*this.frameCount/(e-this.lastFPSUpdate));this.metrics.fps=t,this.fpsBuffer.push(t),this.fpsBuffer.length>60&&this.fpsBuffer.shift(),this.frameCount=0,this.lastFPSUpdate=e}this.lastFrameTime=e}updateMemoryMetrics(){const e=Date.now();if(!(e-this.lastMemoryCheck<this.memoryCheckInterval)){if("memory"in performance){const e=performance.memory;this.metrics.heapUsage={usedJSHeapSize:e.usedJSHeapSize,totalJSHeapSize:e.totalJSHeapSize,jsHeapSizeLimit:e.jsHeapSizeLimit},this.metrics.memoryUsage={used:e.usedJSHeapSize,total:e.jsHeapSizeLimit,percentage:e.usedJSHeapSize/e.jsHeapSizeLimit*100}}if("memory"in navigator){const e=navigator.memory;e?.pressure&&(this.metrics.deviceMemoryPressure=e.pressure)}this.lastMemoryCheck=e}}updateCPUMetrics(){const e=this.metrics.frameTime;e>0&&(this.metrics.cpuUsage=Math.min(100,e/16.67*100)),this.metrics.mainThreadTime=Math.max(0,e-5),this.metrics.idleTime=Math.max(0,16.67-e)}updateNetworkMetrics(){const e=Date.now();if(!(e-this.lastNetworkCheck<5e3)){if("getEntriesByType"in performance){const e=performance.getEntriesByType("navigation");if(e.length>0){const t=e[0];this.metrics.networkLatency=t.responseStart-t.requestStart}const t=performance.getEntriesByType("resource").slice(-10);if(t.length>0){const e=t.reduce((e,t)=>e+(t.transferSize||0),0),s=t.reduce((e,t)=>e+(t.responseEnd-t.requestStart),0);s>0&&(this.metrics.bandwidth.down=8*e/(s/1e3))}}this.lastNetworkCheck=e}}refreshGameMetrics(){}updateDeviceMetrics(){"getBattery"in navigator&&navigator.getBattery().then(e=>{this.metrics.batteryLevel=100*e.level}).catch(()=>{}),"deviceTemperature"in navigator&&(this.metrics.deviceTemperature=navigator.deviceTemperature)}updateMemoryFromObserver(e){void 0!==e.usedJSHeapSize&&(this.metrics.heapUsage.usedJSHeapSize=e.usedJSHeapSize,this.metrics.heapUsage.totalJSHeapSize=e.totalJSHeapSize,this.metrics.heapUsage.jsHeapSizeLimit=e.jsHeapSizeLimit)}updateNetworkFromObserver(e){const t=e;if(t.responseStart&&t.requestStart){const e=t.responseStart-t.requestStart;this.networkBuffer.push(e),this.networkBuffer.length>10&&this.networkBuffer.shift(),this.metrics.networkLatency=this.networkBuffer.reduce((e,t)=>e+t,0)/this.networkBuffer.length}}calculateScores(){let e=100;e*=Math.min(100,this.metrics.fps/60*100)/100;e*=Math.max(0,100-this.metrics.memoryUsage.percentage)/100;e*=Math.max(0,100-this.metrics.cpuUsage)/100;e*=Math.max(0,100-this.metrics.networkLatency/5)/100,this.metrics.overallScore=Math.round(e);const t=Math.min(50,2*this.metrics.frameJitter);this.metrics.stabilityScore=Math.max(0,100-t);const s=this.metrics.fps/Math.max(1,this.metrics.memoryUsage.percentage+this.metrics.cpuUsage);this.metrics.efficiencyScore=Math.min(100,20*s)}checkThresholds(){const e=[];this.metrics.fps<this.thresholds.minFPS?e.push({type:"critical",category:"fps",message:`Low FPS detected: ${this.metrics.fps}`,value:this.metrics.fps,threshold:this.thresholds.minFPS,timestamp:Date.now(),suggestions:["Reduce visual quality settings","Disable non-essential visual effects","Close other browser tabs","Check for background processes"]}):this.metrics.fps<this.thresholds.warningThresholds.fps&&e.push({type:"warning",category:"fps",message:`FPS below optimal: ${this.metrics.fps}`,value:this.metrics.fps,threshold:this.thresholds.warningThresholds.fps,timestamp:Date.now(),suggestions:["Consider reducing particle effects","Lower rendering resolution"]}),this.metrics.memoryUsage.used>this.thresholds.maxMemoryUsage&&e.push({type:"critical",category:"memory",message:`High memory usage: ${Math.round(this.metrics.memoryUsage.used/1024/1024)}MB`,value:this.metrics.memoryUsage.used,threshold:this.thresholds.maxMemoryUsage,timestamp:Date.now(),suggestions:["Clear game cache","Reduce texture quality","Close other browser tabs","Restart the game"]}),this.metrics.cpuUsage>this.thresholds.maxCPUUsage&&e.push({type:"critical",category:"cpu",message:`High CPU usage: ${this.metrics.cpuUsage.toFixed(1)}%`,value:this.metrics.cpuUsage,threshold:this.thresholds.maxCPUUsage,timestamp:Date.now(),suggestions:["Reduce physics simulation quality","Lower AI difficulty","Disable advanced visual effects"]}),this.metrics.networkLatency>this.thresholds.maxNetworkLatency&&e.push({type:"warning",category:"network",message:`High network latency: ${this.metrics.networkLatency.toFixed(0)}ms`,value:this.metrics.networkLatency,threshold:this.thresholds.maxNetworkLatency,timestamp:Date.now(),suggestions:["Check internet connection","Switch to a closer server","Close streaming services"]});for(const t of e)this.emit("performanceAlert",t),this.alertHistory.push(t);this.alertHistory.length>100&&(this.alertHistory=this.alertHistory.slice(-50))}storeMetrics(){this.metricsHistory.push({...this.metrics}),this.metricsHistory.length>this.maxHistorySize&&this.metricsHistory.shift()}cleanup(){this.memoryObserver&&(this.memoryObserver.disconnect(),this.memoryObserver=void 0),this.networkObserver&&(this.networkObserver.disconnect(),this.networkObserver=void 0)}getCurrentMetrics(){return{...this.metrics}}getMetricsHistory(){return[...this.metricsHistory]}getAlertHistory(){return[...this.alertHistory]}generateReport(e){const t=Date.now(),s=e||6e4,i=t-s,a=this.metricsHistory.filter(e=>t-s<=t);if(0===a.length)throw new Error("No metrics data available for report");const n={timestamp:t,duration:s,averageMetrics:this.calculateAverageMetrics(a),minMetrics:this.calculateMinMetrics(a),maxMetrics:this.calculateMaxMetrics(a),alerts:this.alertHistory.filter(e=>e.timestamp>=i),bottlenecks:this.identifyBottlenecks(a),recommendations:this.generateRecommendations(a)};return n}calculateAverageMetrics(e){const t=this.createInitialMetrics();if(0===e.length)return t;for(const i of e)t.fps+=i.fps,t.frameTime+=i.frameTime,t.memoryUsage.used+=i.memoryUsage.used,t.cpuUsage+=i.cpuUsage,t.networkLatency+=i.networkLatency,t.overallScore+=i.overallScore;const s=e.length;return t.fps/=s,t.frameTime/=s,t.memoryUsage.used/=s,t.cpuUsage/=s,t.networkLatency/=s,t.overallScore/=s,t}calculateMinMetrics(e){return 0===e.length?this.createInitialMetrics():e.reduce((e,t)=>({...e,fps:Math.min(e.fps,t.fps),frameTime:Math.min(e.frameTime,t.frameTime),memoryUsage:{...e.memoryUsage,used:Math.min(e.memoryUsage.used,t.memoryUsage.used)},cpuUsage:Math.min(e.cpuUsage,t.cpuUsage),networkLatency:Math.min(e.networkLatency,t.networkLatency),overallScore:Math.min(e.overallScore,t.overallScore)}),e[0])}calculateMaxMetrics(e){return 0===e.length?this.createInitialMetrics():e.reduce((e,t)=>({...e,fps:Math.max(e.fps,t.fps),frameTime:Math.max(e.frameTime,t.frameTime),memoryUsage:{...e.memoryUsage,used:Math.max(e.memoryUsage.used,t.memoryUsage.used)},cpuUsage:Math.max(e.cpuUsage,t.cpuUsage),networkLatency:Math.max(e.networkLatency,t.networkLatency),overallScore:Math.max(e.overallScore,t.overallScore)}),e[0])}identifyBottlenecks(e){const t=[],s=this.calculateAverageMetrics(e);return s.fps<45&&t.push("Frame Rate"),s.memoryUsage.percentage>70&&t.push("Memory Usage"),s.cpuUsage>70&&t.push("CPU Usage"),s.networkLatency>100&&t.push("Network Latency"),s.frameJitter>5&&t.push("Frame Stability"),t}generateRecommendations(e){const t=[],s=this.calculateAverageMetrics(e);return s.fps<45&&(t.push("Consider reducing visual quality or effects"),t.push("Optimize rendering batches and draw calls")),s.memoryUsage.percentage>70&&(t.push("Implement object pooling for frequently created objects"),t.push("Optimize texture sizes and compression")),s.cpuUsage>70&&(t.push("Optimize game logic and reduce unnecessary calculations"),t.push("Consider using web workers for heavy computations")),s.networkLatency>100&&(t.push("Implement client-side prediction"),t.push("Optimize network message frequency and size")),t}updateGameMetrics(e){Object.assign(this.metrics,e)}setThresholds(e){this.thresholds={...this.thresholds,...e}}setMonitoringLevel(e){this.monitoringLevel=e}enableAdaptiveMonitoring(e){this.adaptiveMonitoring=e}getDeviceCapabilities(){return{...this.deviceCapabilities}}clearHistory(){this.metricsHistory=[],this.alertHistory=[]}exportData(){return{metrics:this.metrics,history:this.metricsHistory,alerts:this.alertHistory,thresholds:this.thresholds,deviceCapabilities:this.deviceCapabilities}}}class un{canvas;gl;config;shaderProgram;vertexShader;fragmentShader;vertexBuffer;indexBuffer;instanceBuffer;uniformLocations=new Map;attributeLocations=new Map;textures=new Map;sprites=new Map;textureAtlas;batches=[];currentBatch;maxBatchSize=1e4;camera={x:0,y:0,zoom:1,rotation:0,width:800,height:600};stats={fps:0,frameTime:0,drawCalls:0,triangles:0,vertices:0,textureSwaps:0,batchesMerged:0,memoryUsage:0};frameCount=0;lastFrameTime=0;lastStatsUpdate=0;projectionMatrix=new Float32Array(16);viewMatrix=new Float32Array(16);modelMatrix=new Float32Array(16);mvpMatrix=new Float32Array(16);constructor(e,t){this.canvas=e,this.config={antialias:!0,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,...t};const s=e.getContext("webgl2",this.config);if(!s)throw new Error("WebGL2 not supported");this.gl=s,this.setupViewport()}async initialize(){try{await this.initializeShaders(),this.initializeBuffers(),this.initializeUniforms(),this.setupBlending(),this.updateProjectionMatrix()}catch(e){throw e}}async initializeShaders(){this.vertexShader=this.compileShader("#version 300 es\n      precision highp float;\n\n      // Vertex attributes\n      layout(location = 0) in vec3 a_position;\n      layout(location = 1) in vec2 a_texCoord;\n      layout(location = 2) in vec4 a_color;\n      layout(location = 3) in mat4 a_transform;\n\n      // Uniforms\n      uniform mat4 u_mvpMatrix;\n      uniform vec2 u_textureSize;\n\n      // Outputs to fragment shader\n      out vec2 v_texCoord;\n      out vec4 v_color;\n\n      void main() {\n        gl_Position = u_mvpMatrix * a_transform * vec4(a_position, 1.0);\n        v_texCoord = a_texCoord;\n        v_color = a_color;\n      }\n    ",this.gl.VERTEX_SHADER),this.fragmentShader=this.compileShader("#version 300 es\n      precision highp float;\n\n      // Inputs from vertex shader\n      in vec2 v_texCoord;\n      in vec4 v_color;\n\n      // Uniforms\n      uniform sampler2D u_texture;\n      uniform float u_alpha;\n      uniform vec3 u_tint;\n\n      // Output\n      out vec4 fragColor;\n\n      void main() {\n        vec4 texColor = texture(u_texture, v_texCoord);\n        fragColor = texColor * v_color * vec4(u_tint, u_alpha);\n        \n        // Discard transparent pixels\n        if (fragColor.a < 0.01) {\n          discard;\n        }\n      }\n    ",this.gl.FRAGMENT_SHADER),this.shaderProgram=this.createProgram(this.vertexShader,this.fragmentShader)}compileShader(e,t){const s=this.gl.createShader(t);if(!s)throw new Error("Failed to create shader");if(this.gl.shaderSource(s,e),this.gl.compileShader(s),!this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS)){const e=this.gl.getShaderInfoLog(s);throw this.gl.deleteShader(s),new Error(`Shader compilation error: ${e}`)}return s}createProgram(e,t){const s=this.gl.createProgram();if(!s)throw new Error("Failed to create shader program");if(this.gl.attachShader(s,e),this.gl.attachShader(s,t),this.gl.linkProgram(s),!this.gl.getProgramParameter(s,this.gl.LINK_STATUS)){const e=this.gl.getProgramInfoLog(s);throw this.gl.deleteProgram(s),new Error(`Program linking error: ${e}`)}return s}initializeBuffers(){const e=this.gl.createBuffer();if(!e)throw new Error("Failed to create vertex buffer");this.vertexBuffer=e;const t=this.gl.createBuffer();if(!t)throw new Error("Failed to create index buffer");this.indexBuffer=t;const s=this.gl.createBuffer();if(!s)throw new Error("Failed to create instance buffer");this.instanceBuffer=s}initializeUniforms(){this.gl.useProgram(this.shaderProgram);const e=["u_mvpMatrix","u_texture","u_textureSize","u_alpha","u_tint"];for(const s of e){const e=this.gl.getUniformLocation(this.shaderProgram,s);e&&this.uniformLocations.set(s,e)}const t=["a_position","a_texCoord","a_color","a_transform"];for(const s of t){const e=this.gl.getAttribLocation(this.shaderProgram,s);e>=0&&this.attributeLocations.set(s,e)}}setupBlending(){this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL)}setupViewport(){this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.camera.width=this.canvas.width,this.camera.height=this.canvas.height}clear(){this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.stats.drawCalls=0,this.stats.triangles=0,this.stats.vertices=0,this.stats.textureSwaps=0,this.stats.batchesMerged=0}renderGameObject(e){const t=e.components.find(e=>"RenderComponent"===e.type);if(!t||!t.enabled)return;const s=this.sprites.get(t.sprite||e.type);s?(this.calculateTransformMatrix(e),this.addToBatch(s,e,t)):this.renderDebugRect(e)}calculateTransformMatrix(e){const{position:t,rotation:s,scale:i}=e;this.setIdentityMatrix(this.modelMatrix),this.translateMatrix(this.modelMatrix,t.x,t.y,0),this.rotateMatrix(this.modelMatrix,s),this.scaleMatrix(this.modelMatrix,i.x,i.y,1)}addToBatch(e,t,s){(!this.currentBatch||this.currentBatch.texture!==e.texture||this.currentBatch.vertexCount+4>this.maxBatchSize)&&(this.flushCurrentBatch(),this.startNewBatch(e.texture)),this.addQuadToBatch(e,t,s)}startNewBatch(e){this.currentBatch={texture:e,vertices:new Float32Array(8*this.maxBatchSize),indices:new Uint16Array(6*this.maxBatchSize/4),vertexCount:0,indexCount:0}}addQuadToBatch(e,t,s){if(!this.currentBatch)return;const i=this.currentBatch,a=i.vertexCount,n=i.indexCount,r=s.frame||0,o=r%e.frames*e.frameWidth,c=Math.floor(r/e.frames)*e.frameHeight,l=o/e.width,h=c/e.height,d=(o+e.frameWidth)/e.width,u=(c+e.frameHeight)/e.height,m=s.color||[1,1,1,s.opacity||1],p=m[0],f=m[1],x=m[2],y=m[3],g=e.frameWidth/2,b=e.frameHeight/2,{position:v,rotation:w,scale:j}=t,S=Math.cos(w),N=Math.sin(w),k=[[-g,-b],[g,-b],[g,b],[-g,b]],M=[[l,h],[d,h],[d,u],[l,u]];for(let A=0;A<4;A++){const e=k[A][0]*j.x,t=k[A][1]*j.y,s=e*N+t*S,n=e*S-t*N+v.x,r=s+v.y,o=8*(a+A);i.vertices[o]=n,i.vertices[o+1]=r,i.vertices[o+2]=M[A][0],i.vertices[o+3]=M[A][1],i.vertices[o+4]=p,i.vertices[o+5]=f,i.vertices[o+6]=x,i.vertices[o+7]=y}const C=[0,1,2,0,2,3];for(let A=0;A<6;A++)i.indices[n+A]=a+C[A];i.vertexCount+=4,i.indexCount+=6}flushCurrentBatch(){if(!this.currentBatch||0===this.currentBatch.vertexCount)return;const e=this.currentBatch;this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e.texture),this.gl.uniform1i(this.uniformLocations.get("u_texture"),0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,e.vertices.subarray(0,8*e.vertexCount),this.gl.DYNAMIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,e.indices.subarray(0,e.indexCount),this.gl.DYNAMIC_DRAW);this.gl.vertexAttribPointer(this.attributeLocations.get("a_position"),2,this.gl.FLOAT,!1,32,0),this.gl.vertexAttribPointer(this.attributeLocations.get("a_texCoord"),2,this.gl.FLOAT,!1,32,8),this.gl.vertexAttribPointer(this.attributeLocations.get("a_color"),4,this.gl.FLOAT,!1,32,16),this.gl.enableVertexAttribArray(this.attributeLocations.get("a_position")),this.gl.enableVertexAttribArray(this.attributeLocations.get("a_texCoord")),this.gl.enableVertexAttribArray(this.attributeLocations.get("a_color")),this.gl.drawElements(this.gl.TRIANGLES,e.indexCount,this.gl.UNSIGNED_SHORT,0),this.stats.drawCalls++,this.stats.triangles+=e.indexCount/3,this.stats.vertices+=e.vertexCount,this.currentBatch=void 0}renderDebugRect(e){const{position:t,scale:s}=e}renderUI(e){this.flushCurrentBatch(),this.renderText(`Score: ${e.score}`,10,10,{size:24,color:[1,1,1,1]}),this.renderText(`Level: ${e.level}`,10,40,{size:18,color:[.8,.8,.8,1]}),e.fps&&this.renderText(`FPS: ${e.fps}`,10,this.canvas.height-30,{size:14,color:[.6,.6,.6,1]})}renderText(e,t,s,i){}present(){this.flushCurrentBatch(),this.updateStats()}updateStats(){const e=performance.now();this.frameCount++,e-this.lastStatsUpdate>=1e3&&(this.stats.fps=Math.round(1e3*this.frameCount/(e-this.lastStatsUpdate)),this.stats.frameTime=(e-this.lastStatsUpdate)/this.frameCount,this.frameCount=0,this.lastStatsUpdate=e),this.lastFrameTime=e}setIdentityMatrix(e){e.fill(0),e[0]=e[5]=e[10]=e[15]=1}translateMatrix(e,t,s,i){e[12]+=t,e[13]+=s,e[14]+=i}rotateMatrix(e,t){const s=Math.cos(t),i=Math.sin(t),a=e[0],n=e[1],r=e[4],o=e[5];e[0]=s*a+i*r,e[1]=s*n+i*o,e[4]=s*r-i*a,e[5]=s*o-i*n}scaleMatrix(e,t,s,i){e[0]*=t,e[1]*=t,e[2]*=t,e[4]*=s,e[5]*=s,e[6]*=s,e[8]*=i,e[9]*=i,e[10]*=i}updateProjectionMatrix(){const e=-this.camera.width/2,t=this.camera.width/2,s=this.camera.height/2,i=-this.camera.height/2;this.setIdentityMatrix(this.projectionMatrix),this.projectionMatrix[0]=2/(t-e),this.projectionMatrix[5]=2/(i-s),this.projectionMatrix[10]=-.001,this.projectionMatrix[12]=-(t+e)/(t-e),this.projectionMatrix[13]=-(i+s)/(i-s),this.projectionMatrix[14]=-0,this.updateViewMatrix(),this.multiplyMatrices(this.projectionMatrix,this.viewMatrix,this.mvpMatrix),this.gl.useProgram(this.shaderProgram),this.gl.uniformMatrix4fv(this.uniformLocations.get("u_mvpMatrix"),!1,this.mvpMatrix)}updateViewMatrix(){this.setIdentityMatrix(this.viewMatrix),this.scaleMatrix(this.viewMatrix,this.camera.zoom,this.camera.zoom,1),this.rotateMatrix(this.viewMatrix,-this.camera.rotation),this.translateMatrix(this.viewMatrix,-this.camera.x,-this.camera.y,0)}multiplyMatrices(e,t,s){for(let i=0;i<4;i++)for(let a=0;a<4;a++){let n=0;for(let s=0;s<4;s++)n+=e[4*i+s]*t[4*s+a];s[4*i+a]=n}}async loadSprite(e,t,s=1){return new Promise((i,a)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{try{const t=this.createTexture(n),a={id:e,texture:t,width:n.width,height:n.height,frames:s,frameWidth:n.width/s,frameHeight:n.height};this.sprites.set(e,a),this.textures.set(e,t),i(a)}catch(t){a(t)}},n.onerror=()=>a(new Error(`Failed to load image: ${t}`)),n.src=t})}createTexture(e){const t=this.gl.createTexture();if(!t)throw new Error("Failed to create texture");return this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),t}setCamera(e){Object.assign(this.camera,e),this.updateProjectionMatrix()}getCamera(){return{...this.camera}}resize(e,t){this.canvas.width=e,this.canvas.height=t,this.camera.width=e,this.camera.height=t,this.setupViewport(),this.updateProjectionMatrix()}getStats(){return{...this.stats}}getSprite(e){return this.sprites.get(e)}removeSprite(e){const t=this.sprites.get(e);t&&(this.gl.deleteTexture(t.texture),this.sprites.delete(e),this.textures.delete(e))}destroy(){for(const[e,t]of this.textures)this.gl.deleteTexture(t);this.textures.clear(),this.sprites.clear(),this.vertexBuffer&&this.gl.deleteBuffer(this.vertexBuffer),this.indexBuffer&&this.gl.deleteBuffer(this.indexBuffer),this.instanceBuffer&&this.gl.deleteBuffer(this.instanceBuffer),this.shaderProgram&&this.gl.deleteProgram(this.shaderProgram),this.vertexShader&&this.gl.deleteShader(this.vertexShader),this.fragmentShader&&this.gl.deleteShader(this.fragmentShader),this.batches=[],this.currentBatch=void 0}}class mn{constructor(e){this.canvas=e,this.setupEventListeners()}keys=new Set;mouseButtons=new Set;mousePosition={x:0,y:0};touches=new Map;listeners=[];setupEventListeners(){window.addEventListener("keydown",e=>{this.keys.add(e.key.toLowerCase()),this.notifyListeners({type:"keydown",key:e.key.toLowerCase()})}),window.addEventListener("keyup",e=>{this.keys.delete(e.key.toLowerCase()),this.notifyListeners({type:"keyup",key:e.key.toLowerCase()})}),this.canvas.addEventListener("mousedown",e=>{this.mouseButtons.add(e.button),this.notifyListeners({type:"mousedown",button:e.button,x:e.offsetX,y:e.offsetY})}),this.canvas.addEventListener("mouseup",e=>{this.mouseButtons.delete(e.button),this.notifyListeners({type:"mouseup",button:e.button,x:e.offsetX,y:e.offsetY})}),this.canvas.addEventListener("mousemove",e=>{this.mousePosition={x:e.offsetX,y:e.offsetY},this.notifyListeners({type:"mousemove",x:e.offsetX,y:e.offsetY})}),this.canvas.addEventListener("touchstart",e=>{e.preventDefault();const t=Array.from(e.touches).map(e=>({x:e.clientX-this.canvas.offsetLeft,y:e.clientY-this.canvas.offsetTop,id:e.identifier}));t.forEach(e=>this.touches.set(e.id,e)),this.notifyListeners({type:"touchstart",touches:t})}),this.canvas.addEventListener("touchend",e=>{e.preventDefault();const t=Array.from(e.changedTouches).map(e=>({x:e.clientX-this.canvas.offsetLeft,y:e.clientY-this.canvas.offsetTop,id:e.identifier}));t.forEach(e=>this.touches.delete(e.id)),this.notifyListeners({type:"touchend",touches:t})}),this.canvas.addEventListener("touchmove",e=>{e.preventDefault();const t=Array.from(e.touches).map(e=>({x:e.clientX-this.canvas.offsetLeft,y:e.clientY-this.canvas.offsetTop,id:e.identifier}));t.forEach(e=>this.touches.set(e.id,e)),this.notifyListeners({type:"touchmove",touches:t})})}isKeyPressed(e){return this.keys.has(e.toLowerCase())}isMouseButtonPressed(e){return this.mouseButtons.has(e)}getMousePosition(){return{...this.mousePosition}}getTouches(){return Array.from(this.touches.entries()).map(([e,t])=>({...t,id:e}))}addListener(e){this.listeners.push(e)}removeListener(e){const t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}notifyListeners(e){this.listeners.forEach(t=>t(e))}destroy(){this.keys.clear(),this.mouseButtons.clear(),this.touches.clear(),this.listeners.length=0}}class pn{context;masterGain;sfxGain;musicGain;sounds=new Map;activeSources=new Map;config;constructor(e={}){this.config={masterVolume:1,sfxVolume:.8,musicVolume:.6,spatialAudio:!0,...e},this.context=new(window.AudioContext||window.webkitAudioContext),this.setupGainNodes()}setupGainNodes(){this.masterGain=this.context.createGain(),this.sfxGain=this.context.createGain(),this.musicGain=this.context.createGain(),this.masterGain.gain.value=this.config.masterVolume,this.sfxGain.gain.value=this.config.sfxVolume,this.musicGain.gain.value=this.config.musicVolume,this.sfxGain.connect(this.masterGain),this.musicGain.connect(this.masterGain),this.masterGain.connect(this.context.destination)}async loadSound(e,t,s="sfx",i=!1){try{const a=await fetch(t),n=await a.arrayBuffer(),r=await this.context.decodeAudioData(n);this.sounds.set(e,{id:e,buffer:r,loop:i,volume:1,category:s})}catch(a){}}playSound(e,t=1,s=1){const i=this.sounds.get(e);if(!i)return null;const a=this.context.createBufferSource(),n=this.context.createGain();a.buffer=i.buffer,a.loop=i.loop,a.playbackRate.value=s,n.gain.value=t*i.volume;const r="music"===i.category?this.musicGain:this.sfxGain;a.connect(n),n.connect(r);const o=`${e}_${Date.now()}_${Math.random()}`;return this.activeSources.set(o,a),a.onended=()=>{this.activeSources.delete(o)},a.start(),o}stopSound(e){const t=this.activeSources.get(e);t&&(t.stop(),this.activeSources.delete(e))}stopAllSounds(){this.activeSources.forEach((e,t)=>{e.stop()}),this.activeSources.clear()}setMasterVolume(e){this.config.masterVolume=Math.max(0,Math.min(1,e)),this.masterGain.gain.value=this.config.masterVolume}setSfxVolume(e){this.config.sfxVolume=Math.max(0,Math.min(1,e)),this.sfxGain.gain.value=this.config.sfxVolume}setMusicVolume(e){this.config.musicVolume=Math.max(0,Math.min(1,e)),this.musicGain.gain.value=this.config.musicVolume}createSpatialSound(e,t,s,i=0){if(!this.config.spatialAudio)return this.playSound(e);const a=this.sounds.get(e);if(!a)return null;const n=this.context.createBufferSource(),r=this.context.createPanner(),o=this.context.createGain();n.buffer=a.buffer,n.loop=a.loop,o.gain.value=a.volume,r.panningModel="HRTF",r.distanceModel="inverse",r.refDistance=1,r.maxDistance=1e4,r.rolloffFactor=1,r.coneInnerAngle=360,r.coneOuterAngle=0,r.coneOuterGain=0,r.positionX.value=t,r.positionY.value=s,r.positionZ.value=i;const c="music"===a.category?this.musicGain:this.sfxGain;n.connect(o),o.connect(r),r.connect(c);const l=`spatial_${e}_${Date.now()}`;return this.activeSources.set(l,n),n.onended=()=>{this.activeSources.delete(l)},n.start(),l}updateListenerPosition(e,t,s=0){this.context.listener.positionX&&(this.context.listener.positionX.value=e,this.context.listener.positionY.value=t,this.context.listener.positionZ.value=s)}suspend(){return this.context.suspend()}resume(){return this.context.resume()}getConfig(){return{...this.config}}destroy(){this.stopAllSounds(),this.context.close()}}class fn extends gi{config;state;gameObjects=new Map;components=new Map;physicsWorld;proceduralGenerator;aiOpponent;difficultyAdjuster;multiplayerSync;performanceMonitor;renderer;inputManager;audioEngine;isRunning=!1;lastFrameTime=0;targetFrameTime;animationFrameId;frameCount=0;lastFPSUpdate=0;currentFPS=0;constructor(e,t){super(),this.config=e,this.targetFrameTime=1e3/e.targetFPS,this.state={sessionId:this.generateSessionId(),gameId:e.gameId,userId:"",currentLevel:1,score:0,difficulty:e.ai.difficulty||1,timeElapsed:0,isRunning:!1,isPaused:!1,isCompleted:!1,gameData:{},performanceMetrics:{fps:0,memoryUsage:0,networkLatency:0}},this.physicsWorld=new bi(e.physics),this.proceduralGenerator=new wi(e.procedural),this.difficultyAdjuster=new _i,this.performanceMonitor=new dn,this.renderer=new un(t),this.inputManager=new mn(t),this.audioEngine=new pn,e.ai.enabled&&(this.aiOpponent=new ki(e.ai.difficulty)),e.multiplayer.enabled&&(this.multiplayerSync=new nn(e.multiplayer)),this.setupEventHandlers()}setupEventHandlers(){this.inputManager.on("input",e=>{this.handleInput(e)}),this.physicsWorld.on("collision",e=>{this.handleCollision(e)}),this.multiplayerSync&&(this.multiplayerSync.on("playerJoined",e=>{this.emit("playerJoined",e)}),this.multiplayerSync.on("gameStateUpdate",e=>{this.handleMultiplayerUpdate(e)})),this.performanceMonitor.on("performanceUpdate",e=>{this.state.performanceMetrics=e,this.emit("performanceUpdate",e)})}async initialize(e){this.state.userId=e;try{await this.renderer.initialize(),await this.audioEngine.initialize(),this.multiplayerSync&&await this.multiplayerSync.initialize(e);const t=await this.proceduralGenerator.generateLevel(1);this.loadGameContent(t),this.performanceMonitor.start(),this.emit("initialized")}catch(t){throw this.emit("error",t),t}}start(){this.isRunning||(this.isRunning=!0,this.state.isRunning=!0,this.lastFrameTime=performance.now(),this.gameLoop(),this.emit("gameStarted",this.state))}pause(){this.state.isPaused=!0,this.emit("gamePaused",this.state)}resume(){this.state.isPaused=!1,this.lastFrameTime=performance.now(),this.emit("gameResumed",this.state)}stop(){this.isRunning=!1,this.state.isRunning=!1,this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.emit("gameStopped",this.state)}gameLoop(){if(!this.isRunning)return;const e=performance.now(),t=e-this.lastFrameTime;t<this.targetFrameTime||(this.lastFrameTime=e,this.state.isPaused||this.update(t),this.render(),this.updateFPS(e)),this.animationFrameId=requestAnimationFrame(()=>this.gameLoop())}update(e){this.state.timeElapsed+=e,this.config.physics.enabled&&this.physicsWorld.update(e);for(const[t,s]of this.gameObjects)this.updateGameObject(s,e);if(this.aiOpponent&&this.aiOpponent.update(e,this.state),this.config.ai.adaptiveAdjustment){const e=this.difficultyAdjuster.update(this.state);e!==this.state.difficulty&&(this.state.difficulty=e,this.emit("difficultyAdjusted",e))}this.multiplayerSync&&this.frameCount%this.config.multiplayer.syncFrequency===0&&this.multiplayerSync.syncState(this.state),this.checkGameConditions(),this.emit("gameUpdate",this.state)}render(){this.renderer.clear();for(const[e,t]of this.gameObjects)this.renderer.renderGameObject(t);this.renderUI(),this.renderer.present()}renderUI(){const e={score:this.state.score,level:this.state.currentLevel,difficulty:this.state.difficulty,timeElapsed:this.state.timeElapsed,fps:this.currentFPS};this.renderer.renderUI(e)}updateGameObject(e,t){const s=this.components.get(e.id)||[];for(const i of s)i.enabled&&i.update(t,e);this.config.physics.enabled&&(e.position.x+=e.velocity.x*t,e.position.y+=e.velocity.y*t)}updateFPS(e){this.frameCount++,e-this.lastFPSUpdate>=1e3&&(this.currentFPS=this.frameCount,this.frameCount=0,this.lastFPSUpdate=e,this.state.performanceMetrics.fps=this.currentFPS)}checkGameConditions(){this.isLevelComplete()&&this.completeLevel(),this.isGameOver()&&this.gameOver()}isLevelComplete(){return!1}isGameOver(){return!1}async completeLevel(){this.state.currentLevel++;try{const e=await this.proceduralGenerator.generateLevel(this.state.currentLevel);this.loadGameContent(e),this.emit("levelCompleted",{level:this.state.currentLevel-1,score:this.state.score,tokens:this.calculateTokenReward()})}catch(e){this.emit("error",e)}}gameOver(){this.state.isCompleted=!0,this.stop();const e={sessionId:this.state.sessionId,score:this.state.score,level:this.state.currentLevel,timeElapsed:this.state.timeElapsed,tokensEarned:this.calculateTokenReward(),performanceMetrics:this.state.performanceMetrics};this.emit("gameOver",e)}calculateTokenReward(){const e=this.config.rewards.baseTokens,t=this.state.difficulty,s=Math.pow(this.config.rewards.scalingFactor,this.state.currentLevel-1),i=this.config.rewards.qualityBonus?this.calculateQualityBonus():1;return Math.floor(e*t*s*i)}calculateQualityBonus(){return 1+.2*Math.min(this.currentFPS/this.config.targetFPS,1)+.3*Math.max(0,1-this.state.timeElapsed/3e5)}handleInput(e){for(const[t,s]of this.gameObjects)s.properties.acceptsInput&&this.emit("gameObjectInput",{gameObject:s,inputEvent:e});this.emit("gameInput",e)}handleCollision(e){this.emit("collision",e)}handleMultiplayerUpdate(e){Object.assign(this.state.gameData,e.gameData||{}),this.emit("multiplayerUpdate",e)}loadGameContent(e){if(this.gameObjects.clear(),this.components.clear(),e.gameObjects)for(const t of e.gameObjects)this.addGameObject(t);e.environment&&this.applyEnvironmentSettings(e.environment)}addGameObject(e){this.gameObjects.set(e.id,e),e.components&&this.components.set(e.id,e.components),this.config.physics.enabled&&e.properties.hasPhysics&&this.physicsWorld.addBody(e)}removeGameObject(e){const t=this.gameObjects.get(e);t&&(this.gameObjects.delete(e),this.components.delete(e),this.config.physics.enabled&&t.properties.hasPhysics&&this.physicsWorld.removeBody(t))}getGameObject(e){return this.gameObjects.get(e)}getGameState(){return{...this.state}}updateScore(e){this.state.score+=e,this.emit("scoreUpdate",this.state.score)}setDifficulty(e){this.state.difficulty=Math.max(.1,Math.min(10,e)),this.emit("difficultyChanged",this.state.difficulty)}applyEnvironmentSettings(e){e.physics&&this.physicsWorld.updateSettings(e.physics),e.audio&&this.audioEngine.loadEnvironmentAudio(e.audio)}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async saveGameState(){const e={sessionId:this.state.sessionId,gameId:this.state.gameId,userId:this.state.userId,state:this.state,gameObjects:Array.from(this.gameObjects.entries()),timestamp:Date.now()};this.emit("saveGame",e)}async loadGameState(e){this.state={...e.state},this.gameObjects.clear(),this.components.clear();for(const[t,s]of e.gameObjects)this.addGameObject(s);this.emit("gameLoaded",this.state)}destroy(){this.stop(),this.physicsWorld.destroy(),this.renderer.destroy(),this.inputManager.destroy(),this.audioEngine.destroy(),this.performanceMonitor.stop(),this.multiplayerSync&&this.multiplayerSync.destroy(),this.gameObjects.clear(),this.components.clear(),this.removeAllListeners()}}class xn extends fn{puzzleState;gridSize={width:8,height:8};pieceSize=64;colors=["red","blue","green","yellow","purple","orange"];animationSpeed=300;matchThreshold=3;aiOpponentEnabled=!1;aiGrid;constructor(e,t=1){super({gameId:"infinite_puzzle",name:"Infinite Puzzle Master",category:"puzzle",targetFPS:60,physics:{enabled:!1,gravity:{x:0,y:0},worldBounds:{width:800,height:600}},ai:{enabled:!0,difficulty:t,adaptiveAdjustment:!0},multiplayer:{enabled:!0,maxPlayers:2,syncFrequency:10},procedural:{enabled:!0,complexity:t},rewards:{baseTokens:10,scalingFactor:1.2,qualityBonus:!0}},e),this.puzzleState=this.initializePuzzleState(),this.setupGameEvents()}initializePuzzleState(){const e=this.createEmptyGrid();return this.fillGrid(e),{grid:e,score:0,moves:0,targetScore:1e3,timeRemaining:18e4,chain:0,specialPiecesCreated:0,level:1}}createEmptyGrid(){const e=[];for(let t=0;t<this.gridSize.height;t++){e[t]=[];for(let s=0;s<this.gridSize.width;s++)e[t][s]=null}return{width:this.gridSize.width,height:this.gridSize.height,pieces:e}}fillGrid(e){for(let t=0;t<e.height;t++)for(let s=0;s<e.width;s++)e.pieces[t][s]||(e.pieces[t][s]=this.createRandomPiece(s,t));this.removeInitialMatches(e)}createRandomPiece(e,t){const s=[...this.colors];if(e>1){const i=this.puzzleState.grid.pieces[t][e-1],a=this.puzzleState.grid.pieces[t][e-2];if(i&&a&&i.color===a.color){const e=s.indexOf(i.color);e>-1&&s.splice(e,1)}}if(t>1){const i=this.puzzleState.grid.pieces[t-1][e],a=this.puzzleState.grid.pieces[t-2][e];if(i&&a&&i.color===a.color){const e=s.indexOf(i.color);e>-1&&s.splice(e,1)}}const i=s[Math.floor(Math.random()*s.length)];return{id:`piece_${e}_${t}_${Date.now()}`,type:"normal",color:i,gridX:e,gridY:t,isMatched:!1,isFalling:!1}}removeInitialMatches(e){let t=!0,s=0;for(;t&&s<10;){t=!1,s++;for(let s=0;s<e.height;s++)for(let i=0;i<e.width;i++){if(e.pieces[s][i]){if(i<=e.width-3){const a=e.pieces[s][i],n=e.pieces[s][i+1],r=e.pieces[s][i+2];a&&n&&r&&a.color===n.color&&n.color===r.color&&(n.color=this.getDifferentColor(a.color),t=!0)}if(s<=e.height-3){const a=e.pieces[s][i],n=e.pieces[s+1][i],r=e.pieces[s+2][i];a&&n&&r&&a.color===n.color&&n.color===r.color&&(n.color=this.getDifferentColor(a.color),t=!0)}}}}}getDifferentColor(e){const t=this.colors.filter(t=>t!==e);return t[Math.floor(Math.random()*t.length)]}setupGameEvents(){this.on("gameInput",e=>{this.handlePuzzleInput(e)}),this.on("levelCompleted",()=>{this.generateNextLevel()}),this.on("difficultyAdjusted",e=>{this.adjustPuzzleDifficulty(e)})}handlePuzzleInput(e){if("click"===e.type||"touch"===e.type){const t=this.screenToGrid(e.x,e.y);t&&this.handlePieceSelection(t.x,t.y)}}screenToGrid(e,t){const s=Math.floor((e-100)/this.pieceSize),i=Math.floor((t-100)/this.pieceSize);return s>=0&&s<this.gridSize.width&&i>=0&&i<this.gridSize.height?{x:s,y:i}:null}handlePieceSelection(e,t){const s=this.puzzleState.grid.pieces[t][e];if(s&&!s.isFalling)if(this.puzzleState.selectedPiece){const e=this.puzzleState.selectedPiece;this.areAdjacent(e,s)?this.attemptSwap(e,s):(this.unhighlightPiece(e),this.puzzleState.selectedPiece=s,this.highlightPiece(s))}else this.puzzleState.selectedPiece=s,this.highlightPiece(s)}areAdjacent(e,t){const s=Math.abs(e.gridX-t.gridX),i=Math.abs(e.gridY-t.gridY);return 1===s&&0===i||0===s&&1===i}async attemptSwap(e,t){this.swapPieces(e,t);const s=this.findAllMatches();s.length>0?(this.puzzleState.moves++,this.unhighlightPiece(e),this.puzzleState.selectedPiece=void 0,await this.animateSwap(e,t),await this.processMatches(s)):(this.swapPieces(e,t),await this.animateInvalidSwap(e,t),this.unhighlightPiece(e),this.puzzleState.selectedPiece=void 0)}swapPieces(e,t){const s=this.puzzleState.grid;s.pieces[e.gridY][e.gridX]=t,s.pieces[t.gridY][t.gridX]=e;const i=e.gridX,a=e.gridY;e.gridX=t.gridX,e.gridY=t.gridY,t.gridX=i,t.gridY=a}findAllMatches(){const e=[],t=this.puzzleState.grid,s=new Set;for(let i=0;i<t.height;i++)for(let a=0;a<t.width-2;a++){const t=this.findHorizontalMatch(a,i);if(t&&t.pieces.length>=this.matchThreshold){const i=t.pieces.map(e=>e.id).sort().join(",");s.has(i)||(e.push(t),s.add(i))}}for(let i=0;i<t.height-2;i++)for(let a=0;a<t.width;a++){const t=this.findVerticalMatch(a,i);if(t&&t.pieces.length>=this.matchThreshold){const i=t.pieces.map(e=>e.id).sort().join(",");s.has(i)||(e.push(t),s.add(i))}}return e}findHorizontalMatch(e,t){const s=this.puzzleState.grid,i=s.pieces[t][e];if(!i)return null;const a=[i];for(let n=e+1;n<s.width;n++){const e=s.pieces[t][n];if(!e||e.color!==i.color||e.type!==i.type)break;a.push(e)}return a.length>=this.matchThreshold?{pieces:a,type:"horizontal",score:this.calculateMatchScore(a),chain:this.puzzleState.chain}:null}findVerticalMatch(e,t){const s=this.puzzleState.grid,i=s.pieces[t][e];if(!i)return null;const a=[i];for(let n=t+1;n<s.height;n++){const t=s.pieces[n][e];if(!t||t.color!==i.color||t.type!==i.type)break;a.push(t)}return a.length>=this.matchThreshold?{pieces:a,type:"vertical",score:this.calculateMatchScore(a),chain:this.puzzleState.chain}:null}calculateMatchScore(e){let t=10*e.length;t*=1+.2*this.puzzleState.chain;const s=e.filter(e=>"normal"!==e.type).length;return t+=50*s,e.length>=5?t*=2:e.length>=4&&(t*=1.5),Math.floor(t)}async processMatches(e){if(0===e.length)return;const t=new Set;let s=0;for(const a of e){for(const e of a.pieces)e.isMatched=!0,t.add(e);s+=a.score}this.puzzleState.score+=s,this.updateScore(s),this.createSpecialPieces(e),await this.animateMatchRemoval(Array.from(t)),this.removeMatchedPieces(Array.from(t)),await this.applyGravity(),await this.fillEmptySpaces(),this.puzzleState.chain++;const i=this.findAllMatches();i.length>0?await this.processMatches(i):(this.puzzleState.chain=0,this.checkWinCondition())}createSpecialPieces(e){for(const t of e)if(t.pieces.length>=5){const e=t.pieces[Math.floor(t.pieces.length/2)];e.isMatched||(e.type="rainbow",e.isMatched=!1,this.puzzleState.specialPiecesCreated++)}else if(4===t.pieces.length){const e=t.pieces[Math.floor(t.pieces.length/2)];e.isMatched||(e.type=(t.type,"line"),e.isMatched=!1,this.puzzleState.specialPiecesCreated++)}}removeMatchedPieces(e){const t=this.puzzleState.grid;for(const s of e)s.isMatched&&(t.pieces[s.gridY][s.gridX]=null)}async applyGravity(){const e=this.puzzleState.grid;let t=!1;do{t=!1;for(let s=0;s<e.width;s++)for(let i=e.height-2;i>=0;i--){const a=e.pieces[i][s];a&&!e.pieces[i+1][s]&&(e.pieces[i+1][s]=a,e.pieces[i][s]=null,a.gridY=i+1,a.isFalling=!0,t=!0)}t&&await this.animateGravity()}while(t);for(let s=0;s<e.height;s++)for(let t=0;t<e.width;t++){const i=e.pieces[s][t];i&&(i.isFalling=!1)}}async fillEmptySpaces(){const e=this.puzzleState.grid;for(let t=0;t<e.width;t++)for(let s=0;s<e.height;s++)e.pieces[s][t]||(e.pieces[s][t]=this.createRandomPiece(t,s));await this.animateNewPieces()}checkWinCondition(){this.puzzleState.score>=this.puzzleState.targetScore?this.completeLevel():this.puzzleState.timeRemaining<=0&&this.gameOver()}generateNextLevel(){this.puzzleState.level++,this.puzzleState.targetScore=Math.floor(1.5*this.puzzleState.targetScore),this.puzzleState.timeRemaining=18e4,this.puzzleState.moves=0,this.puzzleState.chain=0,this.puzzleState.level%5==0&&this.colors.push(`color_${this.colors.length}`),this.puzzleState.grid=this.createEmptyGrid(),this.fillGrid(this.puzzleState.grid),this.emit("levelGenerated",{level:this.puzzleState.level,targetScore:this.puzzleState.targetScore,colors:this.colors.length})}adjustPuzzleDifficulty(e){this.matchThreshold=Math.max(3,Math.floor(3+.5*(e-1))),e>5&&(this.colors=this.colors.concat(["teal","magenta","lime"])),this.aiOpponentEnabled&&this.aiOpponent&&this.aiOpponent.setDifficulty(e)}async animateSwap(e,t){return new Promise(e=>{setTimeout(e,this.animationSpeed)})}async animateInvalidSwap(e,t){return new Promise(e=>{setTimeout(e,this.animationSpeed/2)})}async animateMatchRemoval(e){return new Promise(e=>{setTimeout(e,this.animationSpeed)})}async animateGravity(){return new Promise(e=>{setTimeout(e,this.animationSpeed/2)})}async animateNewPieces(){return new Promise(e=>{setTimeout(e,this.animationSpeed)})}highlightPiece(e){}unhighlightPiece(e){}getPuzzleState(){return{...this.puzzleState}}getGrid(){return{...this.puzzleState.grid,pieces:this.puzzleState.grid.pieces.map(e=>[...e])}}enableAIOpponent(e){this.aiOpponentEnabled=e,e&&!this.aiGrid&&(this.aiGrid=this.createEmptyGrid(),this.fillGrid(this.aiGrid))}getAvailableMoves(){const e=[],t=this.puzzleState.grid;for(let s=0;s<t.height;s++)for(let i=0;i<t.width;i++){const a=t.pieces[s][i];if(a){if(i<t.width-1){const n=t.pieces[s][i+1];n&&this.wouldCreateMatch(a,n)&&e.push({from:{x:i,y:s},to:{x:i+1,y:s}})}if(s<t.height-1){const n=t.pieces[s+1][i];n&&this.wouldCreateMatch(a,n)&&e.push({from:{x:i,y:s},to:{x:i,y:s+1}})}}}return e}wouldCreateMatch(e,t){this.swapPieces(e,t);const s=this.findAllMatches();return this.swapPieces(e,t),s.length>0}getMatchScore(){return this.puzzleState.score}getRemainingTime(){return Math.max(0,this.puzzleState.timeRemaining)}getMovesCount(){return this.puzzleState.moves}getCurrentLevel(){return this.puzzleState.level}getSpecialPiecesCreated(){return this.puzzleState.specialPiecesCreated}update(e){super.update?.(e),this.puzzleState.timeRemaining>0&&(this.puzzleState.timeRemaining-=e,this.puzzleState.timeRemaining<=0&&this.gameOver()),this.aiOpponentEnabled&&this.aiGrid&&this.updateAIOpponent(e)}updateAIOpponent(e){}}class yn extends fn{actionState;worldBounds={width:1200,height:800};spawnZones=[];weaponTemplates=new Map;enemyTemplates=new Map;abilityTemplates=new Map;baseEnemyHealth=50;baseDamage=25;experienceMultiplier=1;difficultyScaling=1.15;inputState={moveX:0,moveY:0,aim:{x:0,y:0},firing:!1,abilities:[!1,!1,!1,!1]};constructor(e,t=1){const s={gameId:"infinite_action",name:"Infinite Action Arena",category:"action",targetFPS:60,physics:{enabled:!0,gravity:{x:0,y:0},worldBounds:{width:1200,height:800}},ai:{enabled:!0,difficulty:t,adaptiveAdjustment:!0},multiplayer:{enabled:!0,maxPlayers:4,syncFrequency:30},procedural:{enabled:!0,complexity:t},rewards:{baseTokens:15,scalingFactor:1.3,qualityBonus:!0}};super(s,e),this.worldBounds=s.physics.worldBounds,this.actionState=this.initializeActionState(),this.initializeTemplates(),this.setupSpawnZones(),this.setupGameEvents()}initializeActionState(){return{player:this.createPlayer(),enemies:[],projectiles:[],powerUps:[],wave:1,waveProgress:0,enemiesKilled:0,totalEnemiesThisWave:5,waveStartTime:Date.now(),gameTime:0,isPaused:!1,difficulty:1,score:0,highScore:0}}createPlayer(){const e=this.createWeapon("pistol");return{id:"player",position:{x:this.worldBounds.width/2,y:this.worldBounds.height/2},velocity:{x:0,y:0},health:100,maxHealth:100,energy:100,maxEnergy:100,score:0,level:1,experience:0,weapons:[e],activeWeapon:e,abilities:[],buffs:[]}}initializeTemplates(){this.weaponTemplates.set("pistol",{id:"pistol",name:"Pistol",type:"pistol",damage:25,fireRate:3,range:300,ammo:12,maxAmmo:12,reloadTime:2e3,accuracy:.9,level:1,upgrades:[]}),this.weaponTemplates.set("rifle",{id:"rifle",name:"Assault Rifle",type:"rifle",damage:35,fireRate:8,range:400,ammo:30,maxAmmo:30,reloadTime:2500,accuracy:.85,level:1,upgrades:[]}),this.weaponTemplates.set("shotgun",{id:"shotgun",name:"Shotgun",type:"shotgun",damage:80,fireRate:1.5,range:150,ammo:8,maxAmmo:8,reloadTime:3e3,accuracy:.7,level:1,upgrades:[]}),this.enemyTemplates.set("grunt",{type:"grunt",health:50,damage:15,speed:60,reward:10,aiState:{state:"patrol",lastStateChange:0,pathfinding:[],aggroRange:200,attackRange:50,currentTarget:void 0}}),this.enemyTemplates.set("heavy",{type:"heavy",health:150,damage:35,speed:30,reward:25,aiState:{state:"patrol",lastStateChange:0,pathfinding:[],aggroRange:250,attackRange:80,currentTarget:void 0}}),this.enemyTemplates.set("fast",{type:"fast",health:30,damage:20,speed:120,reward:15,aiState:{state:"patrol",lastStateChange:0,pathfinding:[],aggroRange:300,attackRange:40,currentTarget:void 0}}),this.abilityTemplates.set("heal",{id:"heal",name:"Heal",description:"Restore health",cooldown:1e4,lastUsed:0,energyCost:30,level:1,effect:{type:"heal",value:50,duration:0,area:0}}),this.abilityTemplates.set("dash",{id:"dash",name:"Dash",description:"Quick movement burst",cooldown:5e3,lastUsed:0,energyCost:20,level:1,effect:{type:"speed",value:3,duration:1e3,area:0}})}setupSpawnZones(){const e=100;this.spawnZones=[{x:e,y:e},{x:this.worldBounds.width-e,y:e},{x:e,y:this.worldBounds.height-e},{x:this.worldBounds.width-e,y:this.worldBounds.height-e},{x:this.worldBounds.width/2,y:e},{x:this.worldBounds.width/2,y:this.worldBounds.height-e},{x:e,y:this.worldBounds.height/2},{x:this.worldBounds.width-e,y:this.worldBounds.height/2}]}setupGameEvents(){this.on("gameInput",e=>{this.handleActionInput(e)}),this.on("collision",e=>{this.handleCollision(e)}),this.on("levelCompleted",()=>{this.startNextWave()}),this.on("difficultyAdjusted",e=>{this.adjustActionDifficulty(e)})}handleActionInput(e){switch(e.type){case"keydown":this.handleKeyDown(e.key);break;case"keyup":this.handleKeyUp(e.key);break;case"mousemove":this.updateAim(e.x,e.y);break;case"mousedown":0===e.button&&(this.inputState.firing=!0);break;case"mouseup":0===e.button&&(this.inputState.firing=!1)}}handleKeyDown(e){switch(e.toLowerCase()){case"w":case"arrowup":this.inputState.moveY=-1;break;case"s":case"arrowdown":this.inputState.moveY=1;break;case"a":case"arrowleft":this.inputState.moveX=-1;break;case"d":case"arrowright":this.inputState.moveX=1;break;case"r":this.reloadWeapon();break;case"q":this.useAbility(0);break;case"e":this.useAbility(1);break;case"f":this.useAbility(2);break;case"c":this.useAbility(3);break;case"1":this.switchWeapon(0);break;case"2":this.switchWeapon(1);break;case"3":this.switchWeapon(2)}}handleKeyUp(e){switch(e.toLowerCase()){case"w":case"arrowup":case"s":case"arrowdown":this.inputState.moveY=0;break;case"a":case"arrowleft":case"d":case"arrowright":this.inputState.moveX=0}}updateAim(e,t){this.inputState.aim={x:e,y:t}}update(e){super.update?.(e),this.actionState.isPaused||(this.actionState.gameTime+=e,this.updatePlayer(e),this.updateEnemies(e),this.updateProjectiles(e),this.updatePowerUps(e),this.updateBuffs(e),this.checkWaveProgress(),this.spawnEnemies(e),this.spawnPowerUps(e),this.checkCollisions(),this.cleanupObjects())}updatePlayer(e){const t=this.actionState.player;t.velocity.x=200*this.inputState.moveX,t.velocity.y=200*this.inputState.moveY;let s=1;for(const i of t.buffs)"speed"===i.type&&(s*=i.value);t.velocity.x*=s,t.velocity.y*=s,t.position.x+=t.velocity.x*(e/1e3),t.position.y+=t.velocity.y*(e/1e3),t.position.x=Math.max(25,Math.min(this.worldBounds.width-25,t.position.x)),t.position.y=Math.max(25,Math.min(this.worldBounds.height-25,t.position.y)),this.inputState.firing&&this.canFire()&&this.fireWeapon(),t.energy<t.maxEnergy&&(t.energy=Math.min(t.maxEnergy,t.energy+e/1e3*30)),this.checkLevelUp()}updateEnemies(e){for(const t of this.actionState.enemies)this.updateEnemyAI(t,e),this.updateEnemyMovement(t,e),this.updateEnemyAttack(t,e)}updateEnemyAI(e,t){const s=this.actionState.player,i=this.getDistance(e.position,s.position),a=Date.now();switch(e.aiState.state){case"patrol":i<=e.aiState.aggroRange&&(e.aiState.state="chase",e.aiState.currentTarget="player",e.aiState.lastStateChange=a);break;case"chase":i>1.5*e.aiState.aggroRange?(e.aiState.state="patrol",e.aiState.currentTarget=void 0,e.aiState.lastStateChange=a):i<=e.aiState.attackRange&&(e.aiState.state="attack",e.aiState.lastStateChange=a);break;case"attack":i>1.2*e.aiState.attackRange&&(e.aiState.state="chase",e.aiState.lastStateChange=a)}}updateEnemyMovement(e,t){const s=this.actionState.player;switch(e.aiState.state){case"chase":const t=this.normalize({x:s.position.x-e.position.x,y:s.position.y-e.position.y});e.velocity.x=t.x*e.speed,e.velocity.y=t.y*e.speed;break;case"patrol":Math.random()<.02&&(e.velocity.x=(Math.random()-.5)*e.speed*.5,e.velocity.y=(Math.random()-.5)*e.speed*.5);break;case"attack":e.velocity.x*=.9,e.velocity.y*=.9}e.position.x+=e.velocity.x*(t/1e3),e.position.y+=e.velocity.y*(t/1e3),e.position.x=Math.max(15,Math.min(this.worldBounds.width-15,e.position.x)),e.position.y=Math.max(15,Math.min(this.worldBounds.height-15,e.position.y))}updateEnemyAttack(e,t){if("attack"!==e.aiState.state)return;const s=Date.now();s-e.lastAttack>=e.attackCooldown&&(this.enemyAttack(e),e.lastAttack=s)}enemyAttack(e){const t=this.actionState.player;this.getDistance(e.position,t.position)<=e.aiState.attackRange&&(this.damagePlayer(e.damage),this.createAttackEffect(e.position,t.position))}updateProjectiles(e){for(const t of this.actionState.projectiles){t.position.x+=t.velocity.x*(e/1e3),t.position.y+=t.velocity.y*(e/1e3);const s=Math.sqrt(Math.pow(t.velocity.x*(e/1e3),2)+Math.pow(t.velocity.y*(e/1e3),2));t.distanceTraveled+=s}}updatePowerUps(e){for(const t of this.actionState.powerUps){t.lifetime-=e;this.getDistance(t.position,this.actionState.player.position)<=30&&this.collectPowerUp(t)}}updateBuffs(e){const t=this.actionState.player;for(let s=t.buffs.length-1;s>=0;s--){const i=t.buffs[s];i.remaining-=e,i.remaining<=0&&t.buffs.splice(s,1)}}canFire(){const e=this.actionState.player.activeWeapon,t=Date.now(),s=1e3/e.fireRate;return e.ammo>0&&t-e.lastFired>=s}fireWeapon(){const e=this.actionState.player,t=e.activeWeapon,s=Date.now();if(t.ammo<=0)return;t.ammo--,t.lastFired=s;const i=this.normalize({x:this.inputState.aim.x-e.position.x,y:this.inputState.aim.y-e.position.y}),a=.2*(1-t.accuracy),n=(Math.random()-.5)*a,r=this.rotateVector(i,n);if("shotgun"===t.type)for(let o=0;o<5;o++){const s=.1*(o-2),i=this.rotateVector(r,s);this.createProjectile(e.position,i,t)}else this.createProjectile(e.position,r,t);this.createMuzzleFlash(e.position,r)}createProjectile(e,t,s){const i={id:`projectile_${Date.now()}_${Math.random()}`,position:{x:e.x,y:e.y},velocity:{x:800*t.x,y:800*t.y},damage:s.damage,range:s.range,distanceTraveled:0,ownerId:"player",type:"laser"===s.type?"laser":"bullet"};this.actionState.projectiles.push(i)}reloadWeapon(){const e=this.actionState.player.activeWeapon;e.ammo<e.maxAmmo&&setTimeout(()=>{e.ammo=e.maxAmmo},e.reloadTime)}useAbility(e){const t=this.actionState.player;if(e>=t.abilities.length)return;const s=t.abilities[e],i=Date.now();i-s.lastUsed<s.cooldown||t.energy<s.energyCost||(t.energy-=s.energyCost,s.lastUsed=i,this.activateAbility(s))}activateAbility(e){const t=this.actionState.player;switch(e.effect.type){case"heal":t.health=Math.min(t.maxHealth,t.health+e.effect.value);break;case"speed":t.buffs.push({id:`buff_${Date.now()}`,name:"Speed Boost",type:"speed",value:e.effect.value,duration:e.effect.duration,remaining:e.effect.duration});break;case"damage":this.createAreaDamage(t.position,e.effect.area,e.effect.value)}}switchWeapon(e){const t=this.actionState.player;e<t.weapons.length&&(t.activeWeapon=t.weapons[e])}spawnEnemies(e){const t=Date.now()-this.actionState.waveStartTime,s=this.calculateSpawnRate();Math.random()<s*(e/1e3)&&this.spawnRandomEnemy(),this.actionState.wave%10==0&&t>3e4&&0===this.actionState.enemies.length&&this.spawnBoss()}calculateSpawnRate(){return.5*(1+.1*(this.actionState.wave-1))*Math.pow(this.difficultyScaling,this.actionState.difficulty-1)}spawnRandomEnemy(){const e=["grunt","heavy","fast"],t=e[Math.floor(Math.random()*e.length)],s=this.spawnZones[Math.floor(Math.random()*this.spawnZones.length)];this.spawnEnemy(t,s)}spawnEnemy(e,t){const s=this.enemyTemplates.get(e);if(!s)return;const i=Math.pow(this.difficultyScaling,this.actionState.wave-1),a={id:`enemy_${Date.now()}_${Math.random()}`,type:s.type,position:{x:t.x,y:t.y},velocity:{x:0,y:0},health:Math.floor((s.health||50)*i),maxHealth:Math.floor((s.health||50)*i),damage:Math.floor((s.damage||15)*i),speed:s.speed||60,reward:Math.floor((s.reward||10)*i),aiState:{...s.aiState},attackCooldown:2e3,lastAttack:0};this.actionState.enemies.push(a)}spawnBoss(){const e={x:this.worldBounds.width/2,y:this.worldBounds.height/4},t=Math.pow(this.difficultyScaling,this.actionState.wave-1),s={id:`boss_${Date.now()}`,type:"boss",position:e,velocity:{x:0,y:0},health:Math.floor(500*t),maxHealth:Math.floor(500*t),damage:Math.floor(50*t),speed:40,reward:Math.floor(200*t),aiState:{state:"chase",lastStateChange:0,pathfinding:[],aggroRange:400,attackRange:100,currentTarget:"player"},attackCooldown:3e3,lastAttack:0};this.actionState.enemies.push(s)}spawnPowerUps(e){Math.random()<e/1e3*.001&&this.spawnRandomPowerUp()}spawnRandomPowerUp(){const e=["health","energy","ammo","experience","buff"],t=e[Math.floor(Math.random()*e.length)],s={x:Math.random()*(this.worldBounds.width-100)+50,y:Math.random()*(this.worldBounds.height-100)+50};let i;switch(t){case"health":i=50;break;case"energy":i=30;break;case"ammo":i={weapon:"all",amount:10};break;case"experience":i=100;break;case"buff":i={type:"damage",value:1.5,duration:1e4}}const a={id:`powerup_${Date.now()}`,type:t,position:s,value:i,duration:0,lifetime:3e4};this.actionState.powerUps.push(a)}collectPowerUp(e){const t=this.actionState.player;switch(e.type){case"health":t.health=Math.min(t.maxHealth,t.health+e.value);break;case"energy":t.energy=Math.min(t.maxEnergy,t.energy+e.value);break;case"ammo":for(const s of t.weapons)s.ammo=Math.min(s.maxAmmo,s.ammo+e.value.amount);break;case"experience":t.experience+=e.value;break;case"buff":t.buffs.push({id:`buff_${Date.now()}`,name:"Power Up",type:e.value.type,value:e.value.value,duration:e.value.duration,remaining:e.value.duration})}const s=this.actionState.powerUps.indexOf(e);s>-1&&this.actionState.powerUps.splice(s,1)}checkCollisions(){for(const e of this.actionState.projectiles)if("player"===e.ownerId)for(const t of this.actionState.enemies)if(this.getDistance(e.position,t.position)<=20){this.damageEnemy(t,e.damage),this.removeProjectile(e);break}for(const e of this.actionState.enemies)this.getDistance(e.position,this.actionState.player.position)<=25&&this.damagePlayer(.1*e.damage)}damageEnemy(e,t){e.health-=t,e.health<=0&&this.killEnemy(e)}killEnemy(e){const t=this.actionState.player;t.experience+=e.reward,t.score+=e.reward,this.actionState.score+=e.reward,this.updateScore(e.reward),this.actionState.enemiesKilled++;const s=this.actionState.enemies.indexOf(e);s>-1&&this.actionState.enemies.splice(s,1),Math.random()<.3&&this.spawnPowerUpAt(e.position)}spawnPowerUpAt(e){const t=["health","energy","ammo"],s=t[Math.floor(Math.random()*t.length)];let i;switch(s){case"health":i=25;break;case"energy":i=15;break;case"ammo":i={weapon:"all",amount:5}}const a={id:`powerup_${Date.now()}`,type:s,position:{...e},value:i,duration:0,lifetime:15e3};this.actionState.powerUps.push(a)}damagePlayer(e){const t=this.actionState.player;let s=e;for(const i of t.buffs)"defense"===i.type&&(s*=1-i.value);t.health-=s,t.health<=0&&this.gameOver()}checkWaveProgress(){const e=this.actionState.enemies.length;this.actionState.enemiesKilled>=this.actionState.totalEnemiesThisWave&&0===e&&this.completeWave()}completeWave(){this.actionState.wave++,this.actionState.enemiesKilled=0,this.actionState.totalEnemiesThisWave=Math.floor(5+1.5*this.actionState.wave),this.actionState.waveStartTime=Date.now();const e=50*this.actionState.wave;this.actionState.player.experience+=e,this.actionState.score+=e,this.updateScore(e),this.emit("waveCompleted",{wave:this.actionState.wave,bonus:e,nextWaveEnemies:this.actionState.totalEnemiesThisWave})}startNextWave(){this.proceduralGenerator?.generateLevel(this.actionState.wave).then(e=>{this.applyProceduralContent(e)})}applyProceduralContent(e){}checkLevelUp(){const e=this.actionState.player,t=100*e.level;e.experience>=t&&(e.level++,e.experience-=t,e.maxHealth+=20,e.health=e.maxHealth,e.maxEnergy+=10,e.energy=e.maxEnergy,this.unlockLevelRewards(e.level),this.emit("levelUp",{level:e.level,healthIncrease:20,energyIncrease:10}))}unlockLevelRewards(e){const t=this.actionState.player;if(3===e&&!t.abilities.find(e=>"heal"===e.id)){const e={...this.abilityTemplates.get("heal")};t.abilities.push(e)}if(5===e&&!t.abilities.find(e=>"dash"===e.id)){const e={...this.abilityTemplates.get("dash")};t.abilities.push(e)}if(7===e&&!t.weapons.find(e=>"rifle"===e.type)){const e=this.createWeapon("rifle");t.weapons.push(e)}}createWeapon(e){const t=this.weaponTemplates.get(e);if(!t)throw new Error(`Unknown weapon type: ${e}`);return{...t,id:`${e}_${Date.now()}`,upgrades:[]}}cleanupObjects(){this.actionState.projectiles=this.actionState.projectiles.filter(e=>e.distanceTraveled<e.range&&e.position.x>=-50&&e.position.x<=this.worldBounds.width+50&&e.position.y>=-50&&e.position.y<=this.worldBounds.height+50),this.actionState.powerUps=this.actionState.powerUps.filter(e=>e.lifetime>0)}removeProjectile(e){const t=this.actionState.projectiles.indexOf(e);t>-1&&this.actionState.projectiles.splice(t,1)}adjustActionDifficulty(e){this.actionState.difficulty=e,this.difficultyScaling=1.1+.05*e,this.experienceMultiplier=1+.2*e}getDistance(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}normalize(e){const t=Math.sqrt(e.x*e.x+e.y*e.y);return 0===t?{x:0,y:0}:{x:e.x/t,y:e.y/t}}rotateVector(e,t){const s=Math.cos(t),i=Math.sin(t);return{x:e.x*s-e.y*i,y:e.x*i+e.y*s}}createMuzzleFlash(e,t){}createAttackEffect(e,t){}createAreaDamage(e,t,s){for(const i of this.actionState.enemies){this.getDistance(e,i.position)<=t&&this.damageEnemy(i,s)}}getActionState(){return{...this.actionState}}getPlayer(){return{...this.actionState.player}}getEnemies(){return[...this.actionState.enemies]}getCurrentWave(){return this.actionState.wave}getScore(){return this.actionState.score}pauseGame(){this.actionState.isPaused=!0}resumeGame(){this.actionState.isPaused=!1}upgradeWeapon(e,t){return!!this.actionState.player.weapons.find(t=>t.id===e)}}class gn extends gi{config;userSessions=new Map;dailyStats=new Map;achievements=new Map;qualityAnalyzer=new bn;antiCheatSystem=new vn;socialMetrics=new wn;constructor(e){super(),this.config={baseTokenMultiplier:1,qualityBonusEnabled:!0,socialBonusEnabled:!0,antiCheatEnabled:!0,dailyLimits:{maxTokensPerDay:1e3,maxTokensPerSession:200,maxSessionsPerDay:20},scalingFactors:{difficulty:1.5,performance:2,consistency:1.3,social:1.2},...e},this.initializeAchievements()}async calculateRewards(e){if(this.config.antiCheatEnabled&&!this.validateSession(e))throw new Error("Session failed validation checks");if(!this.checkDailyLimits(e.userId))return this.createLimitedReward(e);const t=this.calculateBaseTokens(e),s=this.calculateDifficultyMultiplier(e),i=this.calculatePerformanceMultiplier(e),a=this.config.qualityBonusEnabled?this.calculateQualityBonus(e):0,n=this.config.socialBonusEnabled?this.calculateSocialBonus(e):0,r=this.calculateAchievementBonus(e),o=this.calculateDailyBonus(e.userId),c=this.calculateStreakBonus(e.userId),l=Math.floor((t*s*i+a+n+r+o+c)*this.config.baseTokenMultiplier),h=this.createRewardBreakdown(e,{baseTokens:t,difficultyMultiplier:s,performanceMultiplier:i,qualityBonus:a,socialBonus:n,achievementBonus:r,dailyBonus:o,streakBonus:c}),d={baseTokens:t,difficultyMultiplier:s,performanceMultiplier:i,qualityBonus:a,socialBonus:n,achievementBonus:r,dailyBonus:o,streakBonus:c,totalTokens:Math.max(1,l),breakdown:h};return this.recordSession(e),this.updateDailyStats(e.userId,d),await this.checkAchievements(e.userId,e),this.emit("rewardsCalculated",{userId:e.userId,sessionId:e.sessionId,calculation:d}),d}calculateBaseTokens(e){const t=Math.min(60,e.duration/1e3/60),s=50*e.completion,i=10*Math.log10(Math.max(1,e.score));return Math.floor(t+s+i)}calculateDifficultyMultiplier(e){return 1+(Math.max(.1,e.difficulty)-1)*this.config.scalingFactors.difficulty}calculatePerformanceMultiplier(e){return 1+(Math.min(2,e.score/1e3)+.5*e.accuracy+.3*Math.min(1,e.level/10))*this.config.scalingFactors.performance}calculateQualityBonus(e){const t=this.qualityAnalyzer.analyzeSession(e);let s=0;return t.consistency>.8&&(s+=20*t.consistency),t.improvement>.6&&(s+=15*t.improvement),t.engagement>.7&&(s+=10*t.engagement),t.authenticity<.7&&(s*=t.authenticity),Math.floor(s)}calculateSocialBonus(e){if(!e.multiplayerSession)return 0;let t=0;t+=5*e.playersInSession,t+=2*e.socialInteractions,t+=10*e.helpedOtherPlayers;return this.socialMetrics.getUserMetrics(e.userId).reputation>.8&&(t*=1.5),Math.floor(t)}calculateAchievementBonus(e){let t=0;for(const s of e.achievementsUnlocked){const e=this.achievements.get(s);e&&(t+=e.tokenReward)}return t}calculateDailyBonus(e){const t=(new Date).toISOString().split("T")[0],s=this.getDailyStats(e,t);return 0===s.sessionsPlayed?50:s.sessionsPlayed>=10&&s.tokensEarned<.9*this.config.dailyLimits.maxTokensPerDay?25:0}calculateStreakBonus(e){const t=this.getRecentDailyStats(e,7);let s=0;for(let i=t.length-1;i>=0&&t[i].sessionsPlayed>0;i--)s++;return s>=7?100:s>=3?30:s>=2?10:0}validateSession(e){return this.antiCheatSystem.validateSession(e)}checkDailyLimits(e){const t=(new Date).toISOString().split("T")[0],s=this.getDailyStats(e,t);return!(s.sessionsPlayed>=this.config.dailyLimits.maxSessionsPerDay)&&!(s.tokensEarned>=this.config.dailyLimits.maxTokensPerDay)}createLimitedReward(e){return{baseTokens:1,difficultyMultiplier:1,performanceMultiplier:1,qualityBonus:0,socialBonus:0,achievementBonus:0,dailyBonus:0,streakBonus:0,totalTokens:1,breakdown:{components:[{name:"Daily Limit Reached",value:1,multiplier:1,description:"Minimum reward when daily limits are exceeded"}],penalties:[{name:"Daily Limit",value:0,reason:"Maximum daily tokens or sessions reached"}]}}}createRewardBreakdown(e,t){const s={components:[],penalties:[]};return s.components.push({name:"Base Tokens",value:t.baseTokens,multiplier:1,description:"Base reward for game completion and performance"}),t.difficultyMultiplier>1&&s.components.push({name:"Difficulty Bonus",value:t.baseTokens*(t.difficultyMultiplier-1),multiplier:t.difficultyMultiplier,description:`${(100*(t.difficultyMultiplier-1)).toFixed(0)}% bonus for difficulty ${e.difficulty.toFixed(1)}`}),t.performanceMultiplier>1&&s.components.push({name:"Performance Bonus",value:t.baseTokens*(t.performanceMultiplier-1),multiplier:t.performanceMultiplier,description:`${(100*(t.performanceMultiplier-1)).toFixed(0)}% bonus for excellent performance`}),t.qualityBonus>0&&s.components.push({name:"Quality Bonus",value:t.qualityBonus,multiplier:1,description:"Bonus for consistent, authentic gameplay"}),t.socialBonus>0&&s.components.push({name:"Social Bonus",value:t.socialBonus,multiplier:1,description:"Bonus for multiplayer participation and helping others"}),t.achievementBonus>0&&s.components.push({name:"Achievement Bonus",value:t.achievementBonus,multiplier:1,description:`Bonus for unlocking ${e.achievementsUnlocked.length} achievements`}),t.dailyBonus>0&&s.components.push({name:"Daily Bonus",value:t.dailyBonus,multiplier:1,description:"Daily login or activity bonus"}),t.streakBonus>0&&s.components.push({name:"Streak Bonus",value:t.streakBonus,multiplier:1,description:"Consecutive days played bonus"}),e.suspiciousActivity&&s.penalties.push({name:"Suspicious Activity",value:-50,reason:"Unusual patterns detected in gameplay"}),s}recordSession(e){this.userSessions.has(e.userId)||this.userSessions.set(e.userId,[]);const t=this.userSessions.get(e.userId);t.push(e),t.length>100&&t.shift()}updateDailyStats(e,t){const s=(new Date).toISOString().split("T")[0],i=`${e}_${s}`;this.dailyStats.has(i)||this.dailyStats.set(i,{date:s,tokensEarned:0,sessionsPlayed:0,totalPlayTime:0,averageScore:0,achievementsUnlocked:0,streak:0});const a=this.dailyStats.get(i);a.tokensEarned+=t.totalTokens,a.sessionsPlayed++;const n=(this.userSessions.get(e)||[]).filter(e=>new Date(e.startTime).toISOString().split("T")[0]===s);n.length>0&&(a.totalPlayTime=n.reduce((e,t)=>e+t.duration,0),a.averageScore=n.reduce((e,t)=>e+t.score,0)/n.length,a.achievementsUnlocked=n.reduce((e,t)=>e+t.achievementsUnlocked.length,0))}getDailyStats(e,t){const s=`${e}_${t}`;return this.dailyStats.has(s)||this.dailyStats.set(s,{date:t,tokensEarned:0,sessionsPlayed:0,totalPlayTime:0,averageScore:0,achievementsUnlocked:0,streak:0}),this.dailyStats.get(s)}getRecentDailyStats(e,t){const s=[],i=new Date;for(let a=0;a<t;a++){const t=new Date(i);t.setDate(t.getDate()-a);const n=t.toISOString().split("T")[0];s.unshift(this.getDailyStats(e,n))}return s}async checkAchievements(e,t){const s=this.userSessions.get(e)||[],i=[];for(const a of this.achievements.values())a.unlocked||this.evaluateAchievement(a,s,t)&&(a.unlocked=!0,a.unlockedAt=Date.now(),i.push(a),t.achievementsUnlocked.includes(a.id)||t.achievementsUnlocked.push(a.id));i.length>0&&this.emit("achievementsUnlocked",{userId:e,achievements:i})}evaluateAchievement(e,t,s){for(const i of e.requirements)if(!this.evaluateRequirement(i,t,s))return!1;return!0}evaluateRequirement(e,t,s){let i=0;switch(e.type){case"score":i=Math.max(...t.map(e=>e.score));break;case"level":i=Math.max(...t.map(e=>e.level));break;case"games_played":i=t.length;break;case"time":i=t.reduce((e,t)=>e+t.duration,0);break;case"streak":const e=this.getRecentDailyStats(s.userId,30);let a=0;for(let t=e.length-1;t>=0&&e[t].sessionsPlayed>0;t--)a++;i=a;break;case"social":i=t.filter(e=>e.multiplayerSession).length}switch(e.current=i,e.operator){case">=":return i>=e.target;case">":return i>e.target;case"<=":return i<=e.target;case"<":return i<e.target;case"==":return i===e.target;default:return!1}}initializeAchievements(){const e=[{id:"first_game",name:"First Steps",description:"Complete your first game",category:"progress",rarity:"common",tokenReward:25,requirements:[{type:"games_played",target:1,operator:">="}],unlocked:!1},{id:"score_1000",name:"Rising Star",description:"Achieve a score of 1000 points",category:"performance",rarity:"uncommon",tokenReward:50,requirements:[{type:"score",target:1e3,operator:">="}],unlocked:!1},{id:"level_10",name:"Double Digits",description:"Reach level 10 in any game",category:"progress",rarity:"uncommon",tokenReward:75,requirements:[{type:"level",target:10,operator:">="}],unlocked:!1},{id:"games_100",name:"Dedicated Player",description:"Play 100 games",category:"dedication",rarity:"rare",tokenReward:200,requirements:[{type:"games_played",target:100,operator:">="}],unlocked:!1},{id:"streak_7",name:"Week Warrior",description:"Play games for 7 consecutive days",category:"consistency",rarity:"rare",tokenReward:150,requirements:[{type:"streak",target:7,operator:">="}],unlocked:!1},{id:"social_10",name:"Team Player",description:"Play 10 multiplayer games",category:"social",rarity:"uncommon",tokenReward:100,requirements:[{type:"social",target:10,operator:">="}],unlocked:!1}];for(const t of e)this.achievements.set(t.id,t)}getUserStats(e,t=30){const s=this.getRecentDailyStats(e,t),i=this.userSessions.get(e)||[];return{totalTokensEarned:s.reduce((e,t)=>e+t.tokensEarned,0),totalSessionsPlayed:s.reduce((e,t)=>e+t.sessionsPlayed,0),totalPlayTime:s.reduce((e,t)=>e+t.totalPlayTime,0),averageScore:i.length>0?i.reduce((e,t)=>e+t.score,0)/i.length:0,achievementsUnlocked:Array.from(this.achievements.values()).filter(e=>e.unlocked).length,currentStreak:this.calculateCurrentStreak(e),dailyStats:s}}getUserAchievements(e){return Array.from(this.achievements.values())}getLeaderboard(e="tokens",t=10){return[]}calculateCurrentStreak(e){const t=this.getRecentDailyStats(e,30);let s=0;for(let i=t.length-1;i>=0&&t[i].sessionsPlayed>0;i--)s++;return s}setConfig(e){this.config={...this.config,...e}}exportUserData(e){return{sessions:this.userSessions.get(e)||[],dailyStats:Array.from(this.dailyStats.entries()).filter(([t])=>t.startsWith(`${e}_`)).map(([e,t])=>t),achievements:this.getUserAchievements(e),stats:this.getUserStats(e)}}}class bn{analyzeSession(e){return{consistency:this.calculateConsistency(e),improvement:this.calculateImprovement(e),engagement:this.calculateEngagement(e),authenticity:this.calculateAuthenticity(e),socialContribution:this.calculateSocialContribution(e)}}calculateConsistency(e){return Math.min(1,e.consistency*(1-e.suspiciousActivity?0:.5))}calculateImprovement(e){return.8*Math.random()+.2}calculateEngagement(e){const t=e.timeSpentPlaying,s=e.duration,i=s>0?t/s:0;return Math.min(1,i)}calculateAuthenticity(e){let t=1;return e.suspiciousActivity&&(t*=.5),e.averageReactionTime<100&&(t*=.7),e.actionsPerMinute>300&&(t*=.8),Math.max(0,t)}calculateSocialContribution(e){if(!e.multiplayerSession)return.5;let t=.5;return t+=.1*e.helpedOtherPlayers,t+=.05*e.socialInteractions,t+=e.validatedByPeers?.2:0,Math.min(1,t)}}class vn{validateSession(e){return!this.isScoreImpossible(e)&&(!this.isTimingImpossible(e)&&(!this.hasBotPatterns(e)&&!!this.isConsistentWithDifficulty(e)))}isScoreImpossible(e){const t=e.duration/1e3*100*e.difficulty;return e.score>2*t}isTimingImpossible(e){const t=e.score/1e3*60;return e.duration<1e3*t}hasBotPatterns(e){return 1===e.accuracy&&e.averageReactionTime<200||e.actionsPerMinute>500}isConsistentWithDifficulty(e){const t=300*e.difficulty,s=3*t;return e.score<=t+s}}class wn{userMetrics=new Map;getUserMetrics(e){return this.userMetrics.has(e)||this.userMetrics.set(e,{reputation:.5,helpfulness:.5,toxicity:0}),this.userMetrics.get(e)}updateMetrics(e,t){const s=this.getUserMetrics(e);Object.assign(s,t)}}const jn=[{id:"puzzle_master",name:"Puzzle Master",description:"Match-3 puzzle game with endless levels and AI opponents",category:"puzzle",icon:"🧩",gradient:["#667eea","#764ba2"],difficulty:2,estimatedTime:"5-15 min",maxPlayers:2,tokensPerMinute:12,featured:!0},{id:"action_arena",name:"Action Arena",description:"Fast-paced action game with infinite waves and upgrades",category:"action",icon:"⚡",gradient:["#ff6b6b","#ee5a24"],difficulty:3,estimatedTime:"10-20 min",maxPlayers:4,tokensPerMinute:18,featured:!0},{id:"strategy_wars",name:"Strategy Wars",description:"Turn-based strategy with procedural campaigns",category:"strategy",icon:"♟️",gradient:["#2ecc71","#27ae60"],difficulty:4,estimatedTime:"15-30 min",maxPlayers:2,tokensPerMinute:15,featured:!1},{id:"idle_empire",name:"Idle Empire",description:"Build and manage your growing empire",category:"idle",icon:"🏰",gradient:["#f39c12","#e67e22"],difficulty:1,estimatedTime:"Continuous",maxPlayers:1,tokensPerMinute:8,featured:!1}];function Sn(){const{user:t}=mi(),[i,a]=s.useState(null),[n,c]=s.useState(null),[l,h]=s.useState(!1),[d,u]=s.useState({level:1,experience:0,tokensEarned:0,gamesPlayed:0,currentStreak:0,achievements:0}),[m,p]=s.useState(!1),[f,x]=s.useState("portrait"),[y,g]=s.useState(!1),[b,v]=s.useState(0),w=o(0),j=s.useRef(null),[S,N]=s.useState({fps:60,latency:0,memoryUsage:0}),[k,M]=s.useState(142),[C,A]=s.useState(3);s.useEffect(()=>{const e=()=>{p(window.innerWidth<=768),x(window.innerHeight>window.innerWidth?"portrait":"landscape")};return g("ontouchstart"in window),e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",()=>{setTimeout(e,100)}),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}},[]),s.useEffect(()=>{t&&T()},[t]);const T=async()=>{u({level:12,experience:2847,tokensEarned:1250,gamesPlayed:38,currentStreak:5,achievements:12})},P=async e=>{if(t){a(e),h(!0);try{const s=document.getElementById("game-canvas");if(!s)throw new Error("Game canvas not found");let i;switch(e.id){case"puzzle_master":i=new xn(s,e.difficulty);break;case"action_arena":i=new yn(s,e.difficulty);break;default:throw new Error(`Game ${e.id} not implemented yet`)}await i.initialize(t.id),i.start(),c(i),i.on("gameOver",e=>{_(e)}),i.on("performanceUpdate",e=>{N(e)})}catch(s){h(!1),a(null)}}},_=async e=>{if(!n||!i)return;const s=new gn,r={sessionId:e.sessionId,gameId:i.id,userId:t?.id||"",startTime:e.startTime||Date.now()-3e5,endTime:Date.now(),duration:e.timeElapsed||3e5,score:e.score||0,level:e.level||1,difficulty:e.difficulty||1,completion:e.completion||.5,accuracy:e.accuracy||.8,consistency:e.consistency||.7,timeSpentPlaying:e.timeElapsed||3e5,timeSpentIdle:0,actionsPerMinute:e.actionsPerMinute||60,averageReactionTime:e.averageReactionTime||300,multiplayerSession:!1,playersInSession:1,socialInteractions:0,helpedOtherPlayers:0,suspiciousActivity:!1,validatedByPeers:!1,achievementsUnlocked:e.achievementsUnlocked||[],tokensEarned:0,bonusTokens:0,experienceGained:0,qualityScore:.8};try{const t=await s.calculateRewards(r);E(e,t)}catch(o){E(e,null)}n.destroy(),c(null),h(!1),a(null),await T()},E=(e,t)=>{},B=s.useMemo(()=>jn.filter(e=>e.featured),[]);return B[b%B.length],l&&i?e.jsx(Nn,{game:i,onExit:()=>{n&&(n.stop(),n.destroy(),c(null)),h(!1),a(null)}}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white overflow-hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2260%22%20height%3D%2260%22%20viewBox%3D%220%200%2060%2060%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%239C92AC%22%20fill-opacity%3D%220.03%22%3E%3Ccircle%20cx%3D%227%22%20cy%3D%227%22%20r%3D%227%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-50"}),e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx(r.div,{animate:{x:[0,100,0],y:[0,-80,0]},transition:{duration:15,repeat:1/0,ease:"linear"},className:"absolute top-1/4 left-1/4 w-64 h-64 bg-purple-500/8 rounded-full blur-3xl"}),e.jsx(r.div,{animate:{x:[0,-120,0],y:[0,100,0]},transition:{duration:20,repeat:1/0,ease:"linear"},className:"absolute bottom-1/4 right-1/4 w-80 h-80 bg-blue-500/6 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"relative z-10 min-h-screen px-4 py-6 pb-24",children:[e.jsxs(r.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold bg-gradient-to-r from-white to-purple-200 bg-clip-text text-transparent",children:"Game Hub"}),e.jsxs("p",{className:"text-white/60 text-sm mt-1",children:[k," players online • ",C," friends"]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"glass-card px-3 py-1 rounded-full",children:e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("div",{className:"w-2 h-2 rounded-full "+(S.fps>45?"bg-green-400":S.fps>25?"bg-yellow-400":"bg-red-400")}),e.jsxs("span",{children:[S.fps," FPS"]})]})})})]}),e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"glass-card p-4 mb-8 rounded-2xl",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-300",children:d.level}),e.jsx("div",{className:"text-xs text-white/60",children:"Level"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-300",children:d.tokensEarned}),e.jsx("div",{className:"text-xs text-white/60",children:"AI Tokens"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-300",children:d.gamesPlayed}),e.jsx("div",{className:"text-xs text-white/60",children:"Games"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-300",children:d.currentStreak}),e.jsx("div",{className:"text-xs text-white/60",children:"Streak"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-pink-300",children:d.achievements}),e.jsx("div",{className:"text-xs text-white/60",children:"Achievements"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-300",children:Math.floor(d.experience/100)}),e.jsx("div",{className:"text-xs text-white/60",children:"Rank"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-white/60 mb-2",children:[e.jsxs("span",{children:["Level ",d.level]}),e.jsxs("span",{children:[d.experience%1e3,"/1000 XP"]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-2",children:e.jsx(r.div,{className:"bg-gradient-to-r from-purple-500 to-blue-500 h-2 rounded-full",initial:{width:0},animate:{width:d.experience%1e3/10+"%"},transition:{duration:1,delay:.5}})})]})]}),e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Featured Games"}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl",children:[e.jsx(r.div,{ref:j,className:"flex",style:{x:w},drag:!!m&&"x",dragConstraints:{left:-300*(B.length-1),right:0},children:B.map((t,s)=>e.jsx(r.div,{className:"min-w-full relative",whileHover:{scale:m?1:1.02},whileTap:{scale:.98},onClick:()=>P(t),children:e.jsx("div",{className:"glass-card p-6 h-48 rounded-2xl cursor-pointer overflow-hidden",style:{background:`linear-gradient(135deg, ${t.gradient[0]}40, ${t.gradient[1]}40)`},children:e.jsxs("div",{className:"flex items-start justify-between h-full",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-4xl mb-2",children:t.icon}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:t.name}),e.jsx("p",{className:"text-white/70 text-sm mb-4 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-white/60",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-1 h-1 bg-current rounded-full"}),e.jsx("span",{children:t.estimatedTime})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-1 h-1 bg-current rounded-full"}),e.jsxs("span",{children:[t.tokensPerMinute,"/min"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-1 h-1 bg-current rounded-full"}),e.jsx("span",{children:"★".repeat(t.difficulty)})]})]})]}),e.jsx(r.div,{className:"glass-button px-4 py-2 rounded-full text-sm font-medium",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Play Now"})]})})},t.id))}),!m&&B.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{v(e=>(e-1+jn.length)%jn.length)},className:"absolute left-4 top-1/2 -translate-y-1/2 glass-button w-10 h-10 rounded-full flex items-center justify-center",children:"←"}),e.jsx("button",{onClick:()=>{v(e=>(e+1)%jn.length)},className:"absolute right-4 top-1/2 -translate-y-1/2 glass-button w-10 h-10 rounded-full flex items-center justify-center",children:"→"})]}),e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2",children:B.map((t,s)=>e.jsx("button",{onClick:()=>v(s),className:"w-2 h-2 rounded-full transition-all "+(s===b?"bg-white":"bg-white/30")},s))})]})]}),e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"All Games"}),e.jsx("div",{className:"grid gap-4 "+(m?"grid-cols-1":"grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"),children:jn.map(t=>e.jsx(r.div,{className:"glass-card p-4 rounded-xl cursor-pointer group",whileHover:{scale:m?1:1.02,y:-5},whileTap:{scale:.98},onClick:()=>P(t),style:{background:`linear-gradient(135deg, ${t.gradient[0]}20, ${t.gradient[1]}20)`},children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"text-3xl",children:t.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold truncate",children:t.name}),e.jsx("p",{className:"text-white/60 text-sm line-clamp-2 mb-2",children:t.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-white/50",children:[e.jsx("span",{children:t.category}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"★".repeat(t.difficulty)})]}),e.jsxs("div",{className:"text-xs text-green-400 font-medium",children:["+",t.tokensPerMinute,"/min"]})]})]})]})},t.id))})]})]})]})}function Nn({game:t,onExit:i}){const[a,n]=s.useState(!1),o=s.useRef(null);s.useEffect(()=>{const e=o.current;if(e){e.id="game-canvas";const t=()=>{const t=e.parentElement;t&&(e.width=t.clientWidth,e.height=t.clientHeight)};return t(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}}},[]);return e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col",children:[e.jsxs("div",{className:"glass-card-dark p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-2xl",children:t.icon}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-white",children:t.name}),e.jsxs("p",{className:"text-white/60 text-sm",children:["Difficulty: ","★".repeat(t.difficulty)]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(r.button,{onClick:()=>{document.fullscreenElement?(document.exitFullscreen(),n(!1)):(document.documentElement.requestFullscreen(),n(!0))},className:"glass-button px-3 py-2 rounded-lg text-sm",whileHover:{scale:1.05},whileTap:{scale:.95},children:a?"⤓":"⤢"}),e.jsx(r.button,{onClick:i,className:"glass-button px-3 py-2 rounded-lg text-sm bg-red-500/20 hover:bg-red-500/30",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Exit"})]})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("canvas",{ref:o,className:"w-full h-full bg-gray-900",style:{imageRendering:"pixelated"}}),e.jsx("div",{className:"absolute inset-0 pointer-events-none"})]})]})}const kn=s.createContext(void 0),Mn=({children:t})=>{const[i,a]=s.useState(null),[n,r]=s.useState(!0);s.useEffect(()=>{o()},[]),s.useEffect(()=>{if(i?.sessionExpires){const e=new Date(i.sessionExpires).getTime()-Date.now(),t=Math.max(e-3e5,6e4),s=setTimeout(()=>{d()},t);return()=>clearTimeout(s)}},[i?.sessionExpires]);const o=async()=>{try{if(!localStorage.getItem("adminToken"))return void r(!1);await c()?await l():(localStorage.removeItem("adminToken"),a(null))}catch(e){localStorage.removeItem("adminToken"),a(null)}finally{r(!1)}},c=async()=>{try{const e=localStorage.getItem("adminToken");if(!e)return!1;return(await fetch("/api/admin/auth/validate",{headers:{Authorization:`Bearer ${e}`}})).ok}catch(e){return!1}},l=async()=>{try{const e=localStorage.getItem("adminToken");if(!e)return;const t=await fetch("/api/admin/auth/profile",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Failed to load user profile");{const e=await t.json();a({userId:e.userId,username:e.username,avatar:e.avatar,permissions:e.permissions||[],isAdmin:e.isAdmin||!1,isSuperAdmin:e.isSuperAdmin||!1,lastLogin:e.lastLogin,sessionExpires:e.sessionExpires})}}catch(e){throw e}},h=async()=>{try{const e=localStorage.getItem("adminToken");e&&i&&(await m("logout",{timestamp:(new Date).toISOString(),sessionDuration:i.lastLogin?Date.now()-new Date(i.lastLogin).getTime():0}),await fetch("/api/admin/auth/logout",{method:"POST",headers:{Authorization:`Bearer ${e}`}}))}catch(e){}finally{localStorage.removeItem("adminToken"),a(null)}},d=async()=>{try{const e=localStorage.getItem("adminToken");if(!e)return;const t=await fetch("/api/admin/auth/refresh",{method:"POST",headers:{Authorization:`Bearer ${e}`}});if(t.ok){const e=await t.json();localStorage.setItem("adminToken",e.token),a(t=>t?{...t,sessionExpires:e.sessionExpires}:null)}else await h()}catch(e){await h()}},u=e=>!(!i||!i.isAdmin)&&(!!i.isSuperAdmin||(i.permissions.includes(e)||i.permissions.includes("admin.all"))),m=async(e,t)=>{try{const s=localStorage.getItem("adminToken");if(!s)return;await fetch("/api/admin/audit/log",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({action:e,data:t,timestamp:(new Date).toISOString()})})}catch(s){}},p=async()=>{try{const e=await fetch("/api/admin/client-ip");return(await e.json()).ip||"unknown"}catch(e){return"unknown"}},f={user:i,isAuthenticated:!!i,isLoading:n,login:async e=>{try{r(!0);const t=await fetch("/api/admin/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();return t.ok?(localStorage.setItem("adminToken",s.token),a({userId:s.user.userId,username:s.user.username,avatar:s.user.avatar,permissions:s.user.permissions||[],isAdmin:s.user.isAdmin||!1,isSuperAdmin:s.user.isSuperAdmin||!1,lastLogin:s.user.lastLogin,sessionExpires:s.user.sessionExpires}),await m("login",{timestamp:(new Date).toISOString(),ip:await p(),userAgent:navigator.userAgent}),{success:!0}):423===t.status?{success:!1,error:"Account is locked. Please try again later."}:401===t.status?{success:!1,error:s.error||"Invalid credentials"}:429===t.status?{success:!1,error:"Too many login attempts. Please try again later."}:{success:!1,error:s.error||"Login failed"}}catch(t){return{success:!1,error:"Network error. Please try again."}}finally{r(!1)}},logout:h,refreshSession:d,hasPermission:u,hasAnyPermission:e=>!(!i||!i.isAdmin)&&(!!i.isSuperAdmin||e.some(e=>u(e))),checkSession:c};return e.jsx(kn.Provider,{value:f,children:t})},Cn=()=>{const e=s.useContext(kn);if(!e)throw new Error("useAdmin must be used within an AdminProvider");return e},An=({onLoginSuccess:t})=>{const{login:i,isLoading:a}=Cn(),[n,o]=s.useState("credentials"),[l,h]=s.useState({username:"",password:"",mfaCode:""}),[d,u]=s.useState(!1),[m,p]=s.useState(""),[f,x]=s.useState(""),[y,g]=s.useState(!1),[b,v]=s.useState(0),[w,j]=s.useState(!1),[S,N]=s.useState(0),[k,M]=s.useState(!1);s.useEffect(()=>{"webauthn"in window&&"credentials"in navigator&&M(!0)},[]),s.useEffect(()=>{if(S>0){const e=setInterval(()=>{N(e=>e<=1?(j(!1),v(0),0):e-1)},1e3);return()=>clearInterval(e)}},[S]);const C="success"===n?{level:"Maximum",color:"text-green-400",description:"Authenticated with full privileges"}:"mfa"===n?{level:"High",color:"text-yellow-400",description:"Multi-factor authentication required"}:{level:"Standard",color:"text-blue-400",description:"Initial authentication required"};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2260%22%20height%3D%2260%22%20viewBox%3D%220%200%2060%2060%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%239C92AC%22%20fill-opacity%3D%220.05%22%3E%3Ccircle%20cx%3D%227%22%20cy%3D%227%22%20r%3D%227%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-30"}),e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx(r.div,{animate:{x:[0,100,0],y:[0,-100,0]},transition:{duration:20,repeat:1/0,ease:"linear"},className:"absolute top-1/4 left-1/4 w-32 h-32 bg-red-500/10 rounded-full blur-3xl"}),e.jsx(r.div,{animate:{x:[0,-150,0],y:[0,150,0]},transition:{duration:25,repeat:1/0,ease:"linear"},className:"absolute bottom-1/4 right-1/4 w-40 h-40 bg-purple-500/10 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-md",children:[e.jsxs(r.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-red-500 to-purple-500 rounded-2xl mb-4",children:e.jsx(Qs,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Admin Access"}),e.jsx("p",{className:"text-white/60",children:"Secure administrative portal"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4",children:[e.jsx(Ds,{className:"w-4 h-4 text-white/60"}),e.jsxs("span",{className:`text-sm font-medium ${C.color}`,children:[C.level," Security"]})]}),e.jsx("p",{className:"text-white/40 text-xs mt-1",children:C.description})]}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-8 border border-white/20 shadow-2xl",children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),w)p(`Account locked. Try again in ${S} seconds.`);else if(p(""),x(""),"credentials"===n){if(!l.username.trim()||!l.password.trim())return void p("Please enter both username and password");try{const e=await i({username:l.username,password:l.password});if(e.success)o("success"),x("Login successful! Redirecting to admin dashboard..."),setTimeout(()=>{t()},2e3);else{const t=b+1;v(t),t>=5?(j(!0),N(300),p("Too many failed attempts. Account locked for 5 minutes.")):e.error?.includes("MFA")?(o("mfa"),p("")):p(e.error||"Invalid credentials")}}catch(s){p("Network error. Please try again.")}}else if("mfa"===n){if(!l.mfaCode.trim())return void p("Please enter your MFA code");try{const e=await i({username:l.username,password:l.password,mfaCode:l.mfaCode});e.success?(o("success"),x("MFA verified! Redirecting to admin dashboard..."),setTimeout(()=>{t()},2e3)):p(e.error||"Invalid MFA code")}catch(s){p("Network error. Please try again.")}}},className:"space-y-6",children:[e.jsxs(c,{mode:"wait",children:["credentials"===n&&e.jsxs(r.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Administrator Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(ri,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-white/40"}),e.jsx("input",{type:"text",value:l.username,onChange:e=>h(t=>({...t,username:e.target.value})),className:"w-full pl-12 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:border-purple-400 focus:ring-2 focus:ring-purple-400/20",placeholder:"Enter admin username",disabled:a||w,autoComplete:"username",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ds,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-white/40"}),e.jsx("input",{type:d?"text":"password",value:l.password,onChange:e=>h(t=>({...t,password:e.target.value})),className:"w-full pl-12 pr-12 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:border-purple-400 focus:ring-2 focus:ring-purple-400/20",placeholder:"Enter admin password",disabled:a||w,autoComplete:"current-password",required:!0}),e.jsx("button",{type:"button",onClick:()=>u(!d),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-white/40 hover:text-white/60",disabled:a||w,children:d?e.jsx(Ss,{className:"w-5 h-5"}):e.jsx(Ns,{className:"w-5 h-5"})})]}),l.password.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"flex gap-1",children:[1,2,3,4].map(t=>e.jsx("div",{className:"h-1 flex-1 rounded-full "+(l.password.length>=3*t?t<=2?"bg-red-400":3===t?"bg-yellow-400":"bg-green-400":"bg-white/20")},t))}),e.jsx("p",{className:"text-white/60 text-xs mt-1",children:l.password.length<8?"Weak":l.password.length<12?"Good":"Strong"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center gap-2 text-white/80 text-sm",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:e=>g(e.target.checked),className:"rounded border-white/20 bg-white/10 text-purple-500 focus:ring-purple-400",disabled:a||w}),"Remember this device"]}),b>0&&e.jsxs("span",{className:"text-orange-400 text-xs",children:[5-b," attempts remaining"]})]})]},"credentials"),"mfa"===n&&e.jsxs(r.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(ei,{className:"w-12 h-12 text-purple-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Two-Factor Authentication"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Enter the 6-digit code from your authenticator app"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Authentication Code"}),e.jsxs("div",{className:"relative",children:[e.jsx(Es,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-white/40"}),e.jsx("input",{type:"text",value:l.mfaCode,onChange:e=>h(t=>({...t,mfaCode:e.target.value.replace(/\D/g,"").slice(0,6)})),className:"w-full pl-12 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white text-center text-2xl font-mono tracking-widest focus:outline-none focus:border-purple-400 focus:ring-2 focus:ring-purple-400/20",placeholder:"000000",disabled:a,maxLength:6,autoComplete:"one-time-code",required:!0})]}),e.jsx("p",{className:"text-white/40 text-xs mt-2 text-center",children:"Code expires in 30 seconds"})]}),e.jsxs("button",{type:"button",onClick:()=>o("credentials"),className:"flex items-center gap-2 text-white/60 hover:text-white text-sm",disabled:a,children:[e.jsx(rs,{className:"w-4 h-4"}),"Back to login"]})]},"mfa"),"success"===n&&e.jsxs(r.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center py-8",children:[e.jsx(fs,{className:"w-16 h-16 text-green-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Authentication Successful"}),e.jsx("p",{className:"text-green-400 mb-4",children:"Welcome back, Administrator"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-white/60 text-sm",children:[e.jsx(Bs,{className:"w-4 h-4 animate-spin"}),"Redirecting to admin dashboard..."]})]},"success")]}),e.jsx(c,{children:m&&e.jsxs(r.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex items-center gap-2 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-400 text-sm",children:[e.jsx(ns,{className:"w-4 h-4 flex-shrink-0"}),m]})}),e.jsx(c,{children:f&&e.jsxs(r.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex items-center gap-2 p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-400 text-sm",children:[e.jsx(fs,{className:"w-4 h-4 flex-shrink-0"}),f]})}),e.jsx(c,{children:w&&e.jsxs(r.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex items-center gap-2 p-3 bg-orange-500/20 border border-orange-500/30 rounded-lg text-orange-400 text-sm",children:[e.jsx(xs,{className:"w-4 h-4 flex-shrink-0"}),"Account locked for ",(A=S,`${Math.floor(A/60)}:${(A%60).toString().padStart(2,"0")}`)]})}),"success"!==n&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{type:"submit",disabled:a||w,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 rounded-lg text-white font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:a?e.jsx(Bs,{className:"w-5 h-5 animate-spin"}):"credentials"===n?e.jsxs(e.Fragment,{children:["Sign In",e.jsx(os,{className:"w-5 h-5"})]}):e.jsxs(e.Fragment,{children:["Verify Code",e.jsx(os,{className:"w-5 h-5"})]})}),k&&"credentials"===n&&e.jsxs("button",{type:"button",onClick:async()=>{try{p(""),p("Biometric authentication not yet configured")}catch(e){p("Biometric authentication failed")}},disabled:a||w,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg text-white font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ks,{className:"w-5 h-5"}),"Use Biometric Authentication"]})]})]})}),e.jsxs(r.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"text-center mt-8 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 text-white/40 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Qs,{className:"w-4 h-4"}),e.jsx("span",{children:"256-bit SSL"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ps,{className:"w-4 h-4"}),e.jsx("span",{children:"Secure Connection"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xs,{className:"w-4 h-4"}),e.jsx("span",{children:"Session Timeout: 1h"})]})]}),e.jsx("p",{className:"text-white/30 text-xs",children:"Unauthorized access is strictly prohibited and monitored."})]})]})]});var A},Tn=({user:t,permissions:i,realTimeData:a,onNotification:n})=>{const[o,l]=s.useState([]),[h,d]=s.useState(null),[u,m]=s.useState(!0),[p,f]=s.useState(""),[x,y]=s.useState("all"),[g,b]=s.useState("last_seen"),[v,w]=s.useState("desc"),[j,S]=s.useState([]),[N,k]=s.useState(!1),[M,C]=s.useState(1),[A]=s.useState(25),[T,P]=s.useState(null),[_,E]=s.useState(null);s.useEffect(()=>{B(),D()},[]),s.useEffect(()=>{a.user_activity&&R(a.user_activity),a.user_registered&&O(a.user_registered)},[a]);const B=async()=>{try{const e=await fetch("/api/admin/users",{headers:{Authorization:`Bearer ${localStorage.getItem("adminToken")}`}});if(e.ok){const t=await e.json();l(t.users)}}catch(e){n({title:"Error",message:"Failed to load user data",priority:"high",timestamp:(new Date).toISOString()})}finally{m(!1)}},D=async()=>{try{const e=await fetch("/api/admin/users/stats",{headers:{Authorization:`Bearer ${localStorage.getItem("adminToken")}`}});if(e.ok){const t=await e.json();d(t)}}catch(e){}},R=e=>{l(t=>t.map(t=>t.user_id===e.user_id?{...t,last_seen:e.timestamp}:t))},O=e=>{l(t=>[e,...t]),d(e=>e?{...e,totalUsers:e.totalUsers+1}:null),n({title:"New User Registered",message:`${e.username} joined the platform`,priority:"low",timestamp:(new Date).toISOString()})},L=s.useMemo(()=>{let e=o.filter(e=>{const t=e.username.toLowerCase().includes(p.toLowerCase())||e.user_id.includes(p),s=(()=>{switch(x){case"active":return e.is_active&&!e.is_banned;case"premium":return e.is_premium;case"banned":return e.is_banned;case"new":return new Date(e.created_at)>new Date(Date.now()-6048e5);case"inactive":return new Date(e.last_seen)<new Date(Date.now()-2592e6);default:return!0}})();return t&&s});return e.sort((e,t)=>{let s,i;switch(g){case"username":s=e.username.toLowerCase(),i=t.username.toLowerCase();break;case"created_at":s=new Date(e.created_at),i=new Date(t.created_at);break;case"last_seen":s=new Date(e.last_seen),i=new Date(t.last_seen);break;case"token_balance":s=e.token_balance,i=t.token_balance;break;case"achievements":s=e.achievements_count,i=t.achievements_count;break;default:return 0}return"asc"===v?s>i?1:-1:s<i?1:-1}),e},[o,p,x,g,v]),I=Math.ceil(L.length/A),z=L.slice((M-1)*A,M*A),U=async(e,t,s)=>{try{(await fetch(`/api/admin/users/${e}/action`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("adminToken")}`},body:JSON.stringify({action:t,data:s})})).ok&&(await B(),n({title:"Action Complete",message:`User action "${t}" completed successfully`,priority:"medium",timestamp:(new Date).toISOString()}))}catch(i){n({title:"Action Failed",message:`Failed to perform action "${t}"`,priority:"high",timestamp:(new Date).toISOString()})}},F=async(e,t)=>{if(0!==j.length)try{(await fetch("/api/admin/users/bulk-action",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("adminToken")}`},body:JSON.stringify({action:e,userIds:j,data:t})})).ok&&(await B(),S([]),k(!1),n({title:"Bulk Action Complete",message:`Bulk action "${e}" applied to ${j.length} users`,priority:"medium",timestamp:(new Date).toISOString()}))}catch(s){n({title:"Bulk Action Failed",message:`Failed to perform bulk action "${e}"`,priority:"high",timestamp:(new Date).toISOString()})}},q=async e=>{try{const t=await fetch(`/api/admin/users/export?format=${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("adminToken")}`}});if(t.ok){const s=await t.blob(),i=window.URL.createObjectURL(s),a=document.createElement("a");a.href=i,a.download=`users_export_${(new Date).toISOString().split("T")[0]}.${e}`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(i),document.body.removeChild(a)}}catch(t){}},H=e=>{const t=new Date,s=new Date(e),i=t.getTime()-s.getTime(),a=Math.floor(i/6e4),n=Math.floor(a/60),r=Math.floor(n/24);return a<1?"Just now":a<60?`${a}m ago`:n<24?`${n}h ago`:r<30?`${r}d ago`:s.toLocaleDateString()},$=e=>e.avatar_hash?`https://cdn.discordapp.com/avatars/${e.user_id}/${e.avatar_hash}.png?size=64`:"/default-avatar.png";return u?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Gs,{className:"w-8 h-8 text-purple-400 animate-spin"}),e.jsx("span",{className:"ml-3 text-white font-medium",children:"Loading users..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:h?.totalUsers?.toLocaleString()||"0"}),e.jsxs("p",{className:"text-green-400 text-xs mt-1",children:["+",h?.newUsersToday||0," today"]})]}),e.jsx(oi,{className:"w-8 h-8 text-purple-400"})]})}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"Active Users"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:h?.activeUsers?.toLocaleString()||"0"}),e.jsxs("p",{className:"text-blue-400 text-xs mt-1",children:[h?.activeUsers&&h?.totalUsers?Math.round(h.activeUsers/h.totalUsers*100):0,"% active"]})]}),e.jsx(as,{className:"w-8 h-8 text-green-400"})]})}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"Premium Users"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:h?.premiumUsers?.toLocaleString()||"0"}),e.jsxs("p",{className:"text-yellow-400 text-xs mt-1",children:[h?.premiumUsers&&h?.totalUsers?Math.round(h.premiumUsers/h.totalUsers*100):0,"% premium"]})]}),e.jsx(bs,{className:"w-8 h-8 text-yellow-400"})]})}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"Avg Token Balance"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:h?.avgTokenBalance?.toLocaleString()||"0"}),e.jsxs("p",{className:"text-red-400 text-xs mt-1",children:[h?.bannedUsers||0," banned"]})]}),e.jsx(di,{className:"w-8 h-8 text-blue-400"})]})})]}),e.jsxs("div",{className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Ws,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-white/40"}),e.jsx("input",{type:"text",placeholder:"Search users...",value:p,onChange:e=>f(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:border-purple-400"})]}),e.jsxs("select",{value:x,onChange:e=>y(e.target.value),className:"px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-purple-400",children:[e.jsx("option",{value:"all",className:"bg-gray-800",children:"All Users"}),e.jsx("option",{value:"active",className:"bg-gray-800",children:"Active"}),e.jsx("option",{value:"premium",className:"bg-gray-800",children:"Premium"}),e.jsx("option",{value:"banned",className:"bg-gray-800",children:"Banned"}),e.jsx("option",{value:"new",className:"bg-gray-800",children:"New (7 days)"}),e.jsx("option",{value:"inactive",className:"bg-gray-800",children:"Inactive (30+ days)"})]}),e.jsxs("select",{value:`${g}-${v}`,onChange:e=>{const[t,s]=e.target.value.split("-");b(t),w(s)},className:"px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-purple-400",children:[e.jsx("option",{value:"last_seen-desc",className:"bg-gray-800",children:"Last Seen (Recent)"}),e.jsx("option",{value:"last_seen-asc",className:"bg-gray-800",children:"Last Seen (Oldest)"}),e.jsx("option",{value:"created_at-desc",className:"bg-gray-800",children:"Newest First"}),e.jsx("option",{value:"created_at-asc",className:"bg-gray-800",children:"Oldest First"}),e.jsx("option",{value:"username-asc",className:"bg-gray-800",children:"Username A-Z"}),e.jsx("option",{value:"username-desc",className:"bg-gray-800",children:"Username Z-A"}),e.jsx("option",{value:"token_balance-desc",className:"bg-gray-800",children:"Highest Balance"}),e.jsx("option",{value:"token_balance-asc",className:"bg-gray-800",children:"Lowest Balance"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[j.length>0&&e.jsxs("button",{onClick:()=>k(!N),className:"px-4 py-2 bg-orange-500/20 border border-orange-500/30 rounded-lg text-orange-400 hover:bg-orange-500/30 transition-colors",children:["Bulk Actions (",j.length,")"]}),e.jsxs("div",{className:"relative group",children:[e.jsx("button",{className:"px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white hover:bg-white/20 transition-colors",children:e.jsx(js,{className:"w-4 h-4"})}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-32 bg-gray-800 border border-white/20 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-10",children:[e.jsx("button",{onClick:()=>q("csv"),className:"w-full px-4 py-2 text-left text-white hover:bg-white/10",children:"Export CSV"}),e.jsx("button",{onClick:()=>q("json"),className:"w-full px-4 py-2 text-left text-white hover:bg-white/10",children:"Export JSON"})]})]}),e.jsx("button",{onClick:B,className:"px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white hover:bg-white/20 transition-colors",children:e.jsx(Gs,{className:"w-4 h-4"})})]})]}),e.jsx(c,{children:N&&j.length>0&&e.jsx(r.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 p-4 bg-orange-500/10 border border-orange-500/20 rounded-lg",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>F("gift_tokens",{amount:100}),className:"px-3 py-1 bg-green-500/20 border border-green-500/30 rounded text-green-400 text-sm hover:bg-green-500/30",children:"Gift 100 Tokens"}),e.jsx("button",{onClick:()=>F("send_message"),className:"px-3 py-1 bg-blue-500/20 border border-blue-500/30 rounded text-blue-400 text-sm hover:bg-blue-500/30",children:"Send Message"}),e.jsx("button",{onClick:()=>F("add_role",{role:"beta_tester"}),className:"px-3 py-1 bg-purple-500/20 border border-purple-500/30 rounded text-purple-400 text-sm hover:bg-purple-500/30",children:"Add Beta Role"}),e.jsx("button",{onClick:()=>S([]),className:"px-3 py-1 bg-red-500/20 border border-red-500/30 rounded text-red-400 text-sm hover:bg-red-500/30",children:"Clear Selection"})]})})})]}),e.jsxs("div",{className:"backdrop-blur-xl bg-white/10 rounded-2xl border border-white/20 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-white/5 border-b border-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left",children:e.jsx("input",{type:"checkbox",checked:j.length===z.length&&z.length>0,onChange:e=>{e.target.checked?S(z.map(e=>e.user_id)):S([])},className:"rounded border-white/20 bg-white/10"})}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"User"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Tokens"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Activity"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Joined"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-white/10",children:z.map(t=>e.jsxs("tr",{className:"hover:bg-white/5",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:j.includes(t.user_id),onChange:e=>{e.target.checked?S(e=>[...e,t.user_id]):S(e=>e.filter(e=>e!==t.user_id))},className:"rounded border-white/20 bg-white/10"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:$(t),alt:t.username,className:"w-10 h-10 rounded-full border-2 border-white/20"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-white font-medium",children:t.username}),t.is_premium&&e.jsx(bs,{className:"w-4 h-4 text-yellow-400"}),t.roles?.includes("admin")&&e.jsx(Qs,{className:"w-4 h-4 text-red-400"})]}),e.jsxs("p",{className:"text-white/60 text-sm",children:["ID: ",t.user_id]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium "+(t.is_banned?"bg-red-500/20 text-red-400":t.is_active?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"),children:t.is_banned?"Banned":t.is_active?"Active":"Inactive"}),t.warnings>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-yellow-500/20 text-yellow-400",children:[t.warnings," warnings"]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"text-white",children:[e.jsx("p",{className:"font-medium",children:t.token_balance.toLocaleString()}),e.jsxs("p",{className:"text-white/60 text-sm",children:["Earned: ",t.lifetime_earned.toLocaleString()]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"text-white/80",children:[e.jsxs("p",{className:"text-sm",children:["Last seen: ",H(t.last_seen)]}),e.jsxs("p",{className:"text-white/60 text-xs",children:[t.achievements_count," achievements • ",t.games_played," games"]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("p",{className:"text-white/80 text-sm",children:new Date(t.created_at).toLocaleDateString()})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>P(t),className:"p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors",title:"View Details",children:e.jsx(Ns,{className:"w-4 h-4 text-white"})}),e.jsx("button",{onClick:()=>E(t),className:"p-2 rounded-lg bg-green-500/20 hover:bg-green-500/30 transition-colors",title:"Gift Tokens",children:e.jsx(Ts,{className:"w-4 h-4 text-green-400"})}),e.jsxs("div",{className:"relative group",children:[e.jsx("button",{className:"p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors",children:e.jsx(Ls,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-48 bg-gray-800 border border-white/20 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-10",children:[e.jsxs("button",{onClick:()=>U(t.user_id,"edit"),className:"w-full px-4 py-2 text-left text-white hover:bg-white/10 flex items-center gap-2",children:[e.jsx(Fs,{className:"w-4 h-4"}),"Edit User"]}),e.jsxs("button",{onClick:()=>U(t.user_id,"message"),className:"w-full px-4 py-2 text-left text-white hover:bg-white/10 flex items-center gap-2",children:[e.jsx(Rs,{className:"w-4 h-4"}),"Send Message"]}),e.jsxs("button",{onClick:()=>U(t.user_id,t.is_banned?"unban":"ban"),className:"w-full px-4 py-2 text-left hover:bg-white/10 flex items-center gap-2 "+(t.is_banned?"text-green-400":"text-red-400"),children:[t.is_banned?e.jsx(ni,{className:"w-4 h-4"}):e.jsx(ls,{className:"w-4 h-4"}),t.is_banned?"Unban User":"Ban User"]})]})]})]})})]},t.user_id))})]})}),I>1&&e.jsxs("div",{className:"px-6 py-4 border-t border-white/10 flex items-center justify-between",children:[e.jsxs("p",{className:"text-white/60 text-sm",children:["Showing ",(M-1)*A+1," to ",Math.min(M*A,L.length)," of ",L.length," users"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>C(e=>Math.max(1,e-1)),disabled:1===M,className:"px-3 py-1 rounded bg-white/10 text-white disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white/20",children:"Previous"}),Array.from({length:Math.min(5,I)},(t,s)=>e.jsx("button",{onClick:()=>C(s+1),className:"px-3 py-1 rounded "+(M===s+1?"bg-purple-500 text-white":"bg-white/10 text-white hover:bg-white/20"),children:s+1},s+1)),e.jsx("button",{onClick:()=>C(e=>Math.min(I,e+1)),disabled:M===I,className:"px-3 py-1 rounded bg-white/10 text-white disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white/20",children:"Next"})]})]})]}),e.jsx(c,{children:T&&e.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>P(null),children:e.jsx(r.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"backdrop-blur-xl bg-white/10 rounded-2xl border border-white/20 max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"User Details"}),e.jsx("button",{onClick:()=>P(null),className:"p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors",children:e.jsx(hi,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:$(T),alt:T.username,className:"w-16 h-16 rounded-full border-2 border-white/20"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:T.username}),T.is_premium&&e.jsx(bs,{className:"w-5 h-5 text-yellow-400"}),T.roles?.includes("admin")&&e.jsx(Qs,{className:"w-5 h-5 text-red-400"})]}),e.jsxs("p",{className:"text-white/60",children:["ID: ",T.user_id]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(T.is_banned?"bg-red-500/20 text-red-400":T.is_active?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"),children:T.is_banned?"Banned":T.is_active?"Active":"Inactive"}),T.is_premium&&e.jsxs("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-yellow-500/20 text-yellow-400",children:["Premium until ",new Date(T.premium_expires_at).toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white/5 rounded-lg p-4",children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Token Balance"}),e.jsx("p",{className:"text-xl font-bold text-white",children:T.token_balance.toLocaleString()})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4",children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Lifetime Earned"}),e.jsx("p",{className:"text-xl font-bold text-white",children:T.lifetime_earned.toLocaleString()})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4",children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Achievements"}),e.jsx("p",{className:"text-xl font-bold text-white",children:T.achievements_count})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4",children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Games Played"}),e.jsx("p",{className:"text-xl font-bold text-white",children:T.games_played})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-3",children:"Account Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/60",children:"Joined:"}),e.jsx("span",{className:"text-white",children:new Date(T.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/60",children:"Last Seen:"}),e.jsx("span",{className:"text-white",children:H(T.last_seen)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/60",children:"Daily Streak:"}),e.jsxs("span",{className:"text-white",children:[T.daily_streak," days"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/60",children:"Warnings:"}),e.jsx("span",{className:T.warnings>0?"text-yellow-400":"text-white",children:T.warnings})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-3",children:"Activity Stats"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/60",children:"Total Playtime:"}),e.jsxs("span",{className:"text-white",children:[Math.round(T.total_playtime/60)," hours"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/60",children:"Tokens Spent:"}),e.jsx("span",{className:"text-white",children:T.lifetime_spent.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/60",children:"Roles:"}),e.jsx("span",{className:"text-white",children:T.roles?.join(", ")||"None"})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-4 border-t border-white/10",children:[e.jsx("button",{onClick:()=>U(T.user_id,"gift_premium"),className:"px-4 py-2 bg-yellow-500/20 border border-yellow-500/30 rounded-lg text-yellow-400 hover:bg-yellow-500/30",children:"Gift Premium"}),e.jsx("button",{onClick:()=>E(T),className:"px-4 py-2 bg-green-500/20 border border-green-500/30 rounded-lg text-green-400 hover:bg-green-500/30",children:"Gift Tokens"}),e.jsx("button",{onClick:()=>U(T.user_id,"reset_progress"),className:"px-4 py-2 bg-orange-500/20 border border-orange-500/30 rounded-lg text-orange-400 hover:bg-orange-500/30",children:"Reset Progress"}),e.jsx("button",{onClick:()=>U(T.user_id,T.is_banned?"unban":"ban"),className:"px-4 py-2 border rounded-lg hover:opacity-80 "+(T.is_banned?"bg-green-500/20 border-green-500/30 text-green-400":"bg-red-500/20 border-red-500/30 text-red-400"),children:T.is_banned?"Unban User":"Ban User"})]})]})]})})})}),e.jsx(c,{children:_&&e.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>E(null),children:e.jsx(r.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"backdrop-blur-xl bg-white/10 rounded-2xl border border-white/20 max-w-md w-full",onClick:e=>e.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Gift Tokens"}),e.jsx("button",{onClick:()=>E(null),className:"p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors",children:e.jsx(hi,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-lg",children:[e.jsx("img",{src:$(_),alt:_.username,className:"w-10 h-10 rounded-full"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:_.username}),e.jsxs("p",{className:"text-white/60 text-sm",children:["Current balance: ",_.token_balance.toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Amount to Gift"}),e.jsx("input",{type:"number",min:"1",max:"10000",defaultValue:"100",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-purple-400",id:"giftAmount"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Reason (Optional)"}),e.jsx("textarea",{placeholder:"Admin gift, event reward, etc.",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:border-purple-400 resize-none",rows:3,id:"giftReason"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>E(null),className:"flex-1 px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white hover:bg-white/20",children:"Cancel"}),e.jsxs("button",{onClick:()=>{const e=parseInt(document.getElementById("giftAmount").value),t=document.getElementById("giftReason").value;U(_.user_id,"gift_tokens",{amount:e,reason:t}),E(null)},className:"flex-1 px-4 py-2 bg-green-500 hover:bg-green-600 rounded-lg text-white font-medium",children:[e.jsx(Ts,{className:"w-4 h-4 inline mr-2"}),"Gift Tokens"]})]})]})]})})})})]})},Pn=({user:t,permissions:i,realTimeData:a,onNotification:n})=>{const[o,l]=s.useState("overview"),[h,d]=s.useState(null),[u,m]=s.useState(null),[p,f]=s.useState([]),[x,y]=s.useState([]),[g,b]=s.useState(!0),[v,w]=s.useState(""),[j,S]=s.useState("all"),[N,k]=s.useState(1),[M]=s.useState(20),[C,A]=s.useState("7d"),[T,P]=s.useState(!1),[_,E]=s.useState(!1),[B,D]=s.useState(null),R=[{id:"overview",label:"Overview",icon:hs},{id:"tokens",label:"Token Economy",icon:di},{id:"marketplace",label:"Marketplace",icon:Js},{id:"transactions",label:"Transactions",icon:as},{id:"rewards",label:"Reward System",icon:cs},{id:"settings",label:"Settings",icon:Ks}];s.useEffect(()=>{O()},[C]),s.useEffect(()=>{a.token_transaction&&L(a.token_transaction),a.marketplace_activity&&I(a.marketplace_activity)},[a]);const O=async()=>{b(!0);try{const[e,t,s,i]=await Promise.all([fetch(`/api/admin/economy/tokens/stats?timeRange=${C}`,{headers:{Authorization:`Bearer ${localStorage.getItem("adminToken")}`}}),fetch(`/api/admin/economy/marketplace/stats?timeRange=${C}`,{headers:{Authorization:`Bearer ${localStorage.getItem("adminToken")}`}}),fetch(`/api/admin/economy/transactions?limit=100&timeRange=${C}`,{headers:{Authorization:`Bearer ${localStorage.getItem("adminToken")}`}}),fetch("/api/admin/economy/marketplace/listings?limit=100",{headers:{Authorization:`Bearer ${localStorage.getItem("adminToken")}`}})]);if(e.ok){const t=await e.json();d(t)}if(t.ok){const e=await t.json();m(e)}if(s.ok){const e=await s.json();f(e.transactions)}if(i.ok){const e=await i.json();y(e.listings)}}catch(e){n({title:"Error",message:"Failed to load economy data",priority:"high",timestamp:(new Date).toISOString()})}finally{b(!1)}},L=e=>{f(t=>[e,...t.slice(0,99)]),h&&d(t=>({...t,totalInCirculation:t.totalInCirculation+e.amount}))},I=e=>{"listing_created"===e.type?y(t=>[e.listing,...t]):"listing_sold"===e.type&&y(t=>t.map(t=>t.listing_id===e.listing_id?{...t,status:"sold"}:t))},z=e=>e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toLocaleString(),U=e=>{switch(e){case"earn":return"text-green-400";case"spend":return"text-red-400";case"transfer":return"text-blue-400";case"admin":return"text-purple-400";default:return"text-white"}};return g?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Gs,{className:"w-8 h-8 text-purple-400 animate-spin"}),e.jsx("span",{className:"ml-3 text-white font-medium",children:"Loading economy data..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("select",{value:C,onChange:e=>A(e.target.value),className:"px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-purple-400",children:[e.jsx("option",{value:"1d",className:"bg-gray-800",children:"Last 24 Hours"}),e.jsx("option",{value:"7d",className:"bg-gray-800",children:"Last 7 Days"}),e.jsx("option",{value:"30d",className:"bg-gray-800",children:"Last 30 Days"}),e.jsx("option",{value:"90d",className:"bg-gray-800",children:"Last 3 Months"})]})}),e.jsx("div",{className:"backdrop-blur-xl bg-white/10 rounded-2xl p-4 border border-white/20",children:e.jsx("div",{className:"flex space-x-4 overflow-x-auto",children:R.map(t=>{const s=t.icon,i=o===t.id;return e.jsxs("button",{onClick:()=>l(t.id),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all whitespace-nowrap "+(i?"bg-white/20 text-white shadow-lg":"text-white/60 hover:text-white hover:bg-white/10"),children:[e.jsx(s,{className:"w-4 h-4"}),t.label]},t.id)})})}),e.jsx(c,{mode:"wait",children:e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:["overview"===o&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"Total Supply"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:z(h?.totalSupply||0)}),e.jsxs("p",{className:"text-blue-400 text-xs mt-1",children:[z(h?.totalInCirculation||0)," in circulation"]})]}),e.jsx(ys,{className:"w-8 h-8 text-yellow-400"})]})}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"Daily Activity"}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:["+",z(h?.dailyMinted||0)]}),e.jsxs("p",{className:"text-red-400 text-xs mt-1",children:["-",z(h?.dailyBurned||0)," burned"]})]}),e.jsx(as,{className:"w-8 h-8 text-green-400"})]})}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"Marketplace"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:u?.activeListings||0}),e.jsxs("p",{className:"text-purple-400 text-xs mt-1",children:[u?.dailySales||0," sales today"]})]}),e.jsx(Ys,{className:"w-8 h-8 text-purple-400"})]})}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"Avg Price"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:u?.avgPrice||0}),e.jsxs("p",{className:"text-orange-400 text-xs mt-1",children:[(100*(h?.inflationRate||0)).toFixed(1),"% inflation"]})]}),e.jsx(ai,{className:"w-8 h-8 text-orange-400"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(r.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Token Distribution"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white/80",children:"Average Balance"}),e.jsx("span",{className:"text-white font-medium",children:z(h?.avgBalance||0)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white/80",children:"Median Balance"}),e.jsx("span",{className:"text-white font-medium",children:z(h?.medianBalance||0)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white/80",children:"Inflation Rate"}),e.jsxs("span",{className:"font-medium "+((h?.inflationRate||0)>.05?"text-red-400":"text-green-400"),children:[(100*(h?.inflationRate||0)).toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white/80",children:"Deflation Rate"}),e.jsxs("span",{className:"text-blue-400 font-medium",children:[(100*(h?.deflationRate||0)).toFixed(2),"%"]})]})]})]}),e.jsxs(r.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.5},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Top Marketplace Activity"}),e.jsx("div",{className:"space-y-3",children:u?.topSellers?.slice(0,5).map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:s+1}),e.jsx("span",{className:"text-white font-medium",children:t.username})]}),e.jsxs("span",{className:"text-green-400 font-medium",children:[z(t.total_sales)," tokens"]})]},t.user_id))||e.jsx("p",{className:"text-white/60 text-center py-4",children:"No marketplace activity yet"})})]})]}),e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("button",{onClick:()=>P(!0),className:"flex items-center gap-2 p-3 rounded-lg bg-green-500/20 hover:bg-green-500/30 transition-colors",children:[e.jsx($s,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-green-400 text-sm font-medium",children:"Mint Tokens"})]}),e.jsxs("button",{onClick:()=>E(!0),className:"flex items-center gap-2 p-3 rounded-lg bg-red-500/20 hover:bg-red-500/30 transition-colors",children:[e.jsx(Os,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:"text-red-400 text-sm font-medium",children:"Burn Tokens"})]}),e.jsxs("button",{onClick:()=>l("marketplace"),className:"flex items-center gap-2 p-3 rounded-lg bg-purple-500/20 hover:bg-purple-500/30 transition-colors",children:[e.jsx(Js,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{className:"text-purple-400 text-sm font-medium",children:"Manage Market"})]}),e.jsxs("button",{onClick:()=>l("rewards"),className:"flex items-center gap-2 p-3 rounded-lg bg-yellow-500/20 hover:bg-yellow-500/30 transition-colors",children:[e.jsx(cs,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{className:"text-yellow-400 text-sm font-medium",children:"Adjust Rewards"})]})]})]})]}),"transactions"===o&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Ws,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-white/40"}),e.jsx("input",{type:"text",placeholder:"Search transactions...",value:v,onChange:e=>w(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:border-purple-400"})]}),e.jsxs("select",{value:j,onChange:e=>S(e.target.value),className:"px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-purple-400",children:[e.jsx("option",{value:"all",className:"bg-gray-800",children:"All Types"}),e.jsx("option",{value:"earn",className:"bg-gray-800",children:"Earned"}),e.jsx("option",{value:"spend",className:"bg-gray-800",children:"Spent"}),e.jsx("option",{value:"transfer",className:"bg-gray-800",children:"Transfers"}),e.jsx("option",{value:"admin",className:"bg-gray-800",children:"Admin"})]}),e.jsxs("select",{value:C,onChange:e=>A(e.target.value),className:"px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-purple-400",children:[e.jsx("option",{value:"1d",className:"bg-gray-800",children:"Last 24 Hours"}),e.jsx("option",{value:"7d",className:"bg-gray-800",children:"Last 7 Days"}),e.jsx("option",{value:"30d",className:"bg-gray-800",children:"Last 30 Days"}),e.jsx("option",{value:"90d",className:"bg-gray-800",children:"Last 3 Months"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{const e=p.map(e=>`${e.created_at},${e.username},${e.amount},${e.transaction_type},${e.source},${e.status}`).join("\n"),t=new Blob([`Date,User,Amount,Type,Source,Status\n${e}`],{type:"text/csv"}),s=URL.createObjectURL(t),i=document.createElement("a");i.href=s,i.download=`transactions_${(new Date).toISOString().split("T")[0]}.csv`,i.click()},className:"px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white hover:bg-white/20 transition-colors",children:e.jsx(js,{className:"w-4 h-4"})}),e.jsx("button",{onClick:O,className:"px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white hover:bg-white/20 transition-colors",children:e.jsx(Gs,{className:"w-4 h-4"})})]})]})}),e.jsx("div",{className:"backdrop-blur-xl bg-white/10 rounded-2xl border border-white/20 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-white/5 border-b border-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"User"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Amount"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Type"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Source"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Quality"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-white/10",children:p.filter(e=>("all"===j||e.transaction_type===j)&&(""===v||e.username.toLowerCase().includes(v.toLowerCase())||e.user_id.includes(v))).slice((N-1)*M,N*M).map(t=>e.jsxs("tr",{className:"hover:bg-white/5",children:[e.jsx("td",{className:"px-6 py-4 text-white/80 text-sm",children:new Date(t.created_at).toLocaleString()}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:t.username}),e.jsx("p",{className:"text-white/60 text-xs",children:t.user_id})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`font-bold ${U(t.transaction_type)}`,children:[t.amount>0?"+":"",t.amount.toLocaleString()]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("earn"===t.transaction_type?"bg-green-500/20 text-green-400":"spend"===t.transaction_type?"bg-red-500/20 text-red-400":"transfer"===t.transaction_type?"bg-blue-500/20 text-blue-400":"bg-purple-500/20 text-purple-400"),children:t.transaction_type.toUpperCase()})}),e.jsx("td",{className:"px-6 py-4 text-white/80 text-sm",children:t.source}),e.jsx("td",{className:"px-6 py-4",children:t.quality_score&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full "+(t.quality_score>=.8?"bg-green-400":t.quality_score>=.6?"bg-yellow-400":"bg-red-400")}),e.jsxs("span",{className:"text-white/80 text-sm",children:[(100*t.quality_score).toFixed(0),"%"]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("completed"===t.status?"bg-green-500/20 text-green-400":"pending"===t.status?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"),children:t.status.toUpperCase()})})]},t.transaction_id))})]})})})]}),"marketplace"===o&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"Active Listings"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:u?.activeListings||0}),e.jsxs("p",{className:"text-blue-400 text-xs mt-1",children:[u?.totalListings||0," total"]})]}),e.jsx(Is,{className:"w-8 h-8 text-blue-400"})]})}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"Daily Sales"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:u?.dailySales||0}),e.jsxs("p",{className:"text-green-400 text-xs mt-1",children:[u?.totalSales||0," total sales"]})]}),e.jsx(As,{className:"w-8 h-8 text-green-400"})]})}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"Average Price"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:u?.avgPrice||0}),e.jsx("p",{className:"text-purple-400 text-xs mt-1",children:"tokens per item"})]}),e.jsx(ws,{className:"w-8 h-8 text-purple-400"})]})})]}),e.jsxs("div",{className:"backdrop-blur-xl bg-white/10 rounded-2xl border border-white/20 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Recent Listings"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{value:j,onChange:e=>S(e.target.value),className:"px-3 py-1 bg-white/10 border border-white/20 rounded text-white text-sm",children:[e.jsx("option",{value:"all",className:"bg-gray-800",children:"All Status"}),e.jsx("option",{value:"active",className:"bg-gray-800",children:"Active"}),e.jsx("option",{value:"sold",className:"bg-gray-800",children:"Sold"}),e.jsx("option",{value:"expired",className:"bg-gray-800",children:"Expired"})]})})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-white/5 border-b border-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Item"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Seller"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Price"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Type"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Listed"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-white/10",children:x.filter(e=>"all"===j||e.status===j).slice(0,20).map(t=>e.jsxs("tr",{className:"hover:bg-white/5",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:t.item_name}),e.jsx("p",{className:"text-white/60 text-sm",children:t.category})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("p",{className:"text-white",children:t.seller_username})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-bold",children:t.price_tokens.toLocaleString()}),e.jsx("p",{className:"text-white/60 text-xs",children:t.quantity>1&&`×${t.quantity}`})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("sale"===t.listing_type?"bg-blue-500/20 text-blue-400":"auction"===t.listing_type?"bg-purple-500/20 text-purple-400":"bg-gray-500/20 text-gray-400"),children:t.listing_type.toUpperCase()})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("active"===t.status?"bg-green-500/20 text-green-400":"sold"===t.status?"bg-blue-500/20 text-blue-400":"bg-red-500/20 text-red-400"),children:t.status.toUpperCase()})}),e.jsx("td",{className:"px-6 py-4 text-white/80 text-sm",children:new Date(t.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>D(t),className:"p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors",title:"Adjust Price",children:e.jsx(Fs,{className:"w-4 h-4 text-white"})}),e.jsx("button",{className:"p-2 rounded-lg bg-red-500/20 hover:bg-red-500/30 transition-colors",title:"Remove Listing",children:e.jsx(hi,{className:"w-4 h-4 text-red-400"})})]})})]},t.listing_id))})]})})]})]}),"tokens"===o&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(di,{className:"w-12 h-12 text-yellow-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Token Management"}),e.jsx("p",{className:"text-white/60",children:"Advanced token economy controls coming soon."})]}),"rewards"===o&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(cs,{className:"w-12 h-12 text-yellow-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Reward System"}),e.jsx("p",{className:"text-white/60",children:"Reward management interface under development."})]}),"settings"===o&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ks,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Economy Settings"}),e.jsx("p",{className:"text-white/60",children:"Configuration panel coming soon."})]})]},o)}),e.jsx(c,{children:T&&e.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>P(!1),children:e.jsx(r.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"backdrop-blur-xl bg-white/10 rounded-2xl border border-white/20 max-w-md w-full",onClick:e=>e.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Mint Tokens"}),e.jsx("button",{onClick:()=>P(!1),className:"p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors",children:e.jsx(hi,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Amount to Mint"}),e.jsx("input",{type:"number",min:"1",max:"1000000",defaultValue:"1000",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-purple-400",id:"mintAmount"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"Reason"}),e.jsx("input",{type:"text",placeholder:"Event reward, system maintenance, etc.",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:border-purple-400",id:"mintReason"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>P(!1),className:"flex-1 px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white hover:bg-white/20",children:"Cancel"}),e.jsxs("button",{onClick:()=>{(async(e,t)=>{try{(await fetch(`/api/admin/economy/tokens/${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("adminToken")}`},body:JSON.stringify(t)})).ok&&(await O(),n({title:`Token ${e.charAt(0).toUpperCase()+e.slice(1)} Complete`,message:`Successfully ${e}ed ${t.amount} tokens`,priority:"medium",timestamp:(new Date).toISOString()}))}catch(s){n({title:`Token ${e.charAt(0).toUpperCase()+e.slice(1)} Failed`,message:`Failed to ${e} tokens`,priority:"high",timestamp:(new Date).toISOString()})}})("mint",{amount:parseInt(document.getElementById("mintAmount").value),reason:document.getElementById("mintReason").value}),P(!1)},className:"flex-1 px-4 py-2 bg-green-500 hover:bg-green-600 rounded-lg text-white font-medium",children:[e.jsx($s,{className:"w-4 h-4 inline mr-2"}),"Mint Tokens"]})]})]})]})})})}),e.jsx(c,{children:B&&e.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>D(null),children:e.jsx(r.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"backdrop-blur-xl bg-white/10 rounded-2xl border border-white/20 max-w-md w-full",onClick:e=>e.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Adjust Price"}),e.jsx("button",{onClick:()=>D(null),className:"p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors",children:e.jsx(hi,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-white/5 rounded-lg",children:[e.jsx("p",{className:"text-white font-medium",children:B.item_name}),e.jsxs("p",{className:"text-white/60 text-sm",children:["Current price: ",B.price_tokens.toLocaleString()," tokens"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/80 text-sm font-medium mb-2",children:"New Price"}),e.jsx("input",{type:"number",min:"1",defaultValue:B.price_tokens,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-purple-400",id:"newPrice"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>D(null),className:"flex-1 px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white hover:bg-white/20",children:"Cancel"}),e.jsxs("button",{onClick:()=>{const e=parseInt(document.getElementById("newPrice").value);(async(e,t)=>{try{(await fetch(`/api/admin/economy/marketplace/listings/${e}/price`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("adminToken")}`},body:JSON.stringify({price:t})})).ok&&(y(s=>s.map(s=>s.listing_id===e?{...s,price_tokens:t}:s)),n({title:"Price Adjusted",message:`Listing price updated to ${t} tokens`,priority:"medium",timestamp:(new Date).toISOString()}))}catch(s){}})(B.listing_id,e),D(null)},className:"flex-1 px-4 py-2 bg-purple-500 hover:bg-purple-600 rounded-lg text-white font-medium",children:[e.jsx(Fs,{className:"w-4 h-4 inline mr-2"}),"Update Price"]})]})]})]})})})})]})},_n=({user:t,permissions:i,realTimeData:a,onNotification:n})=>{const[o,c]=s.useState(!0),[l,h]=s.useState(null),[d,u]=s.useState([]),[m,p]=s.useState([]);s.useEffect(()=>{f()},[]);const f=async()=>{try{c(!0),await new Promise(e=>setTimeout(e,1e3)),h({totalGames:12,activeGames:8,totalSessions:1543,activeSessions:23,avgSessionTime:845,topGame:"Puzzle Quest"}),u([{id:"puzzle-quest",name:"Puzzle Quest",category:"Puzzle",status:"active",players:156,avgRating:4.8,sessions:543},{id:"action-arena",name:"Action Arena",category:"Action",status:"active",players:89,avgRating:4.6,sessions:342}]),p([{id:"session-1",gameId:"puzzle-quest",gameName:"Puzzle Quest",players:4,duration:1200,status:"active"}])}catch(e){}finally{c(!1)}};return o?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Gs,{className:"w-8 h-8 text-purple-400 animate-spin"}),e.jsx("span",{className:"ml-3 text-white font-medium",children:"Loading game system..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"Total Games"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:l?.totalGames||0}),e.jsxs("p",{className:"text-green-400 text-xs mt-1",children:[l?.activeGames||0," active"]})]}),e.jsx(Cs,{className:"w-8 h-8 text-purple-400"})]})}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"Active Sessions"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:l?.activeSessions||0}),e.jsxs("p",{className:"text-blue-400 text-xs mt-1",children:[l?.totalSessions||0," total"]})]}),e.jsx(as,{className:"w-8 h-8 text-green-400"})]})}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"Avg Session Time"}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:[Math.floor((l?.avgSessionTime||0)/60),"m"]}),e.jsxs("p",{className:"text-yellow-400 text-xs mt-1",children:[(l?.avgSessionTime||0)%60,"s"]})]}),e.jsx(si,{className:"w-8 h-8 text-yellow-400"})]})}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"Top Game"}),e.jsx("p",{className:"text-lg font-bold text-white",children:l?.topGame||"N/A"}),e.jsx("p",{className:"text-indigo-400 text-xs mt-1",children:"Most played"})]}),e.jsx(ai,{className:"w-8 h-8 text-indigo-400"})]})})]}),e.jsxs("div",{className:"backdrop-blur-xl bg-white/10 rounded-2xl border border-white/20",children:[e.jsx("div",{className:"p-6 border-b border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Game Management"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-purple-500/20 border border-purple-500/30 rounded-lg text-purple-400 hover:bg-purple-500/30",children:[e.jsx($s,{className:"w-4 h-4"}),"Add Game"]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-white/5 border-b border-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Game"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Category"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Players"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Rating"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Sessions"}),e.jsx("th",{className:"px-6 py-4 text-left text-white font-medium",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-white/10",children:d.map(t=>e.jsxs("tr",{className:"hover:bg-white/5",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(Cs,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:t.name}),e.jsxs("p",{className:"text-white/60 text-sm",children:["ID: ",t.id]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-blue-500/20 text-blue-400",children:t.category})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("active"===t.status?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"),children:t.status.toUpperCase()})}),e.jsx("td",{className:"px-6 py-4 text-white",children:t.players}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-white",children:t.avgRating}),e.jsx("span",{className:"text-yellow-400",children:"★"})]})}),e.jsx("td",{className:"px-6 py-4 text-white",children:t.sessions}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors",children:e.jsx(Fs,{className:"w-4 h-4 text-white"})}),e.jsx("button",{className:"p-2 rounded-lg bg-red-500/20 hover:bg-red-500/30 transition-colors",children:e.jsx(ii,{className:"w-4 h-4 text-red-400"})}),e.jsx("button",{className:"p-2 rounded-lg bg-green-500/20 hover:bg-green-500/30 transition-colors",children:"active"===t.status?e.jsx(Us,{className:"w-4 h-4 text-green-400"}):e.jsx(Hs,{className:"w-4 h-4 text-green-400"})})]})})]},t.id))})]})})]}),e.jsxs("div",{className:"backdrop-blur-xl bg-white/10 rounded-2xl border border-white/20",children:[e.jsx("div",{className:"p-6 border-b border-white/10",children:e.jsx("h3",{className:"text-xl font-bold text-white",children:"Active Game Sessions"})}),e.jsx("div",{className:"p-6",children:m.length>0?e.jsx("div",{className:"space-y-4",children:m.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full animate-pulse"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:t.gameName}),e.jsxs("p",{className:"text-white/60 text-sm",children:[t.players," players • ",Math.floor(t.duration/60),"m ",t.duration%60,"s"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-green-500/20 text-green-400",children:"ACTIVE"}),e.jsx("button",{className:"p-2 rounded-lg bg-red-500/20 hover:bg-red-500/30 transition-colors",children:e.jsx(Us,{className:"w-4 h-4 text-red-400"})})]})]},t.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(as,{className:"w-12 h-12 text-white/20 mx-auto mb-4"}),e.jsx("p",{className:"text-white/60",children:"No active game sessions"})]})})]})]})},En=({onNotification:t})=>{const[i,a]=s.useState(!0);return s.useEffect(()=>{setTimeout(()=>a(!1),1e3)},[]),i?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Gs,{className:"w-8 h-8 text-purple-400 animate-spin"}),e.jsx("span",{className:"ml-3 text-white font-medium",children:"Loading AI models..."})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ms,{className:"w-16 h-16 text-purple-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"AI Model Management"}),e.jsx("p",{className:"text-white/60 mb-6",children:"Advanced AI model controls and monitoring interface"}),e.jsxs("div",{className:"backdrop-blur-xl bg-white/10 rounded-2xl p-8 border border-white/20 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(gs,{className:"w-8 h-8 text-blue-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"Model Status"}),e.jsx("p",{className:"text-green-400 text-sm",children:"Online"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(di,{className:"w-8 h-8 text-yellow-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"Performance"}),e.jsx("p",{className:"text-white/80 text-sm",children:"Optimal"})]})]}),e.jsx("p",{className:"text-white/60 text-sm",children:"Comprehensive AI model management interface coming soon with real-time monitoring, performance metrics, and advanced controls."})]})]})},Bn=({onNotification:t})=>{const[i,a]=s.useState(!0);return s.useEffect(()=>{setTimeout(()=>a(!1),1e3)},[]),i?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Gs,{className:"w-8 h-8 text-purple-400 animate-spin"}),e.jsx("span",{className:"ml-3 text-white font-medium",children:"Loading Discord integration..."})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Rs,{className:"w-16 h-16 text-blue-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Discord Integration Controls"}),e.jsx("p",{className:"text-white/60 mb-6",children:"Manage Discord bot and activity integration"}),e.jsxs("div",{className:"backdrop-blur-xl bg-white/10 rounded-2xl p-8 border border-white/20 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(us,{className:"w-8 h-8 text-purple-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"Bot Status"}),e.jsx("p",{className:"text-green-400 text-sm",children:"Online"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(oi,{className:"w-8 h-8 text-indigo-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"Servers"}),e.jsx("p",{className:"text-white/80 text-sm",children:"5 Active"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(as,{className:"w-8 h-8 text-green-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"Activity"}),e.jsx("p",{className:"text-white/80 text-sm",children:"Running"})]})]}),e.jsx("p",{className:"text-white/60 text-sm",children:"Discord bot management, server analytics, activity controls, and OAuth integration interface under development."})]})]})},Dn=({onNotification:t})=>{const[i,a]=s.useState(!0);return s.useEffect(()=>{setTimeout(()=>a(!1),1e3)},[]),i?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Gs,{className:"w-8 h-8 text-purple-400 animate-spin"}),e.jsx("span",{className:"ml-3 text-white font-medium",children:"Loading moderation tools..."})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Qs,{className:"w-16 h-16 text-green-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Content & Community Moderation"}),e.jsx("p",{className:"text-white/60 mb-6",children:"AI-powered content moderation and community management"}),e.jsxs("div",{className:"backdrop-blur-xl bg-white/10 rounded-2xl p-8 border border-white/20 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(Ms,{className:"w-8 h-8 text-red-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"Reports"}),e.jsx("p",{className:"text-orange-400 text-sm",children:"3 Pending"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(oi,{className:"w-8 h-8 text-blue-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"Moderators"}),e.jsx("p",{className:"text-white/80 text-sm",children:"8 Active"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(Ns,{className:"w-8 h-8 text-purple-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"AI Detection"}),e.jsx("p",{className:"text-green-400 text-sm",children:"Active"})]})]}),e.jsx("p",{className:"text-white/60 text-sm",children:"Advanced content moderation tools, automated detection systems, community guidelines management, and appeal processing interface coming soon."})]})]})},Rn=({onNotification:t})=>{const[i,a]=s.useState(!0);return s.useEffect(()=>{setTimeout(()=>a(!1),1e3)},[]),i?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Gs,{className:"w-8 h-8 text-purple-400 animate-spin"}),e.jsx("span",{className:"ml-3 text-white font-medium",children:"Loading analytics..."})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(hs,{className:"w-16 h-16 text-blue-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-white/60 mb-6",children:"Comprehensive data analytics and insights"}),e.jsxs("div",{className:"backdrop-blur-xl bg-white/10 rounded-2xl p-8 border border-white/20 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(qs,{className:"w-8 h-8 text-purple-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"User Segments"}),e.jsx("p",{className:"text-white/80 text-sm",children:"5 Groups"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(ai,{className:"w-8 h-8 text-green-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"Growth Rate"}),e.jsx("p",{className:"text-green-400 text-sm",children:"+15.3%"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(ps,{className:"w-8 h-8 text-yellow-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"Retention"}),e.jsx("p",{className:"text-white/80 text-sm",children:"78.2%"})]})]}),e.jsx("p",{className:"text-white/60 text-sm",children:"Advanced analytics dashboard with user behavior tracking, engagement metrics, revenue analytics, and custom reporting tools under development."})]})]})},On=({onNotification:t})=>{const[i,a]=s.useState(!0);return s.useEffect(()=>{setTimeout(()=>a(!1),1e3)},[]),i?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Gs,{className:"w-8 h-8 text-purple-400 animate-spin"}),e.jsx("span",{className:"ml-3 text-white font-medium",children:"Loading system monitoring..."})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ps,{className:"w-16 h-16 text-green-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"System Monitoring"}),e.jsx("p",{className:"text-white/60 mb-6",children:"Real-time system health and performance monitoring"}),e.jsxs("div",{className:"backdrop-blur-xl bg-white/10 rounded-2xl p-8 border border-white/20 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(Vs,{className:"w-8 h-8 text-blue-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"Server Health"}),e.jsx("p",{className:"text-green-400 text-sm",children:"Optimal"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(vs,{className:"w-8 h-8 text-purple-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"Database"}),e.jsx("p",{className:"text-green-400 text-sm",children:"Connected"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(di,{className:"w-8 h-8 text-yellow-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"Performance"}),e.jsx("p",{className:"text-white/80 text-sm",children:"95.2%"})]})]}),e.jsx("p",{className:"text-white/60 text-sm",children:"Comprehensive system monitoring dashboard with real-time metrics, alerts, performance graphs, and infrastructure management tools coming soon."})]})]})},Ln=({onNotification:t})=>{const[i,a]=s.useState(!0);return s.useEffect(()=>{setTimeout(()=>a(!1),1e3)},[]),i?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Gs,{className:"w-8 h-8 text-purple-400 animate-spin"}),e.jsx("span",{className:"ml-3 text-white font-medium",children:"Loading audit logs..."})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ns,{className:"w-16 h-16 text-blue-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Audit Logs"}),e.jsx("p",{className:"text-white/60 mb-6",children:"Complete activity tracking and audit trail"}),e.jsxs("div",{className:"backdrop-blur-xl bg-white/10 rounded-2xl p-8 border border-white/20 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(xs,{className:"w-8 h-8 text-yellow-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"Recent Actions"}),e.jsx("p",{className:"text-white/80 text-sm",children:"247 Today"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(ri,{className:"w-8 h-8 text-purple-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"Active Admins"}),e.jsx("p",{className:"text-green-400 text-sm",children:"3 Online"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(as,{className:"w-8 h-8 text-green-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"Log Retention"}),e.jsx("p",{className:"text-white/80 text-sm",children:"90 Days"})]})]}),e.jsx("p",{className:"text-white/60 text-sm",children:"Comprehensive audit logging system with detailed activity tracking, security monitoring, compliance reporting, and forensic analysis tools under development."})]})]})},In=({onNotification:t})=>{const[i,a]=s.useState(!0);return s.useEffect(()=>{setTimeout(()=>a(!1),1e3)},[]),i?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Gs,{className:"w-8 h-8 text-purple-400 animate-spin"}),e.jsx("span",{className:"ml-3 text-white font-medium",children:"Loading settings..."})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ks,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Admin Settings"}),e.jsx("p",{className:"text-white/60 mb-6",children:"System configuration and administrative preferences"}),e.jsxs("div",{className:"backdrop-blur-xl bg-white/10 rounded-2xl p-8 border border-white/20 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(Es,{className:"w-8 h-8 text-yellow-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"API Keys"}),e.jsx("p",{className:"text-white/80 text-sm",children:"5 Active"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(Qs,{className:"w-8 h-8 text-green-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"Security"}),e.jsx("p",{className:"text-green-400 text-sm",children:"Enhanced"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(ds,{className:"w-8 h-8 text-blue-400 mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"Notifications"}),e.jsx("p",{className:"text-white/80 text-sm",children:"Enabled"})]})]}),e.jsx("p",{className:"text-white/60 text-sm",children:"Administrative settings panel with system configuration, security policies, notification preferences, and integration management coming soon."})]})]})},zn=({user:t,permissions:i})=>{const[a,n]=s.useState("overview"),[o,l]=s.useState(null),[h,d]=s.useState(!0),[u,m]=s.useState([]),[p,f]=s.useState({}),x=s.useMemo(()=>[{id:"overview",label:"Overview",icon:hs,permission:"admin.overview",component:null},{id:"users",label:"User Management",icon:oi,permission:"admin.users",component:Tn},{id:"economy",label:"Economy & Marketplace",icon:ws,permission:"admin.economy",component:Pn},{id:"games",label:"Gaming System",icon:as,permission:"admin.games",component:_n},{id:"ai",label:"AI Models",icon:ms,permission:"admin.ai",component:En},{id:"discord",label:"Discord Integration",icon:Rs,permission:"admin.discord",component:Bn},{id:"moderation",label:"Content Moderation",icon:Qs,permission:"admin.moderation",component:Dn},{id:"analytics",label:"Analytics",icon:ai,permission:"admin.analytics",component:Rn},{id:"monitoring",label:"System Monitoring",icon:Ps,permission:"admin.monitoring",component:On},{id:"audit",label:"Audit Logs",icon:Ns,permission:"admin.audit",component:Ln},{id:"settings",label:"Settings",icon:Ks,permission:"admin.settings",component:In}],[]),y=s.useMemo(()=>x.filter(e=>i.includes(e.permission)||i.includes("admin.all")),[x,i]);s.useEffect(()=>{g(),b(),v()},[]);const g=async()=>{try{const e=await fetch("/api/admin/stats",{headers:{Authorization:`Bearer ${localStorage.getItem("adminToken")}`}});if(e.ok){const t=await e.json();l(t)}}catch(e){}finally{d(!1)}},b=async()=>{try{const e=await fetch("/api/admin/notifications",{headers:{Authorization:`Bearer ${localStorage.getItem("adminToken")}`}});if(e.ok){const t=await e.json();m(t)}}catch(e){}},v=()=>{const e=new WebSocket(`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}/api/admin/ws`);return e.onmessage=e=>{const t=JSON.parse(e.data);f(e=>({...e,[t.type]:t.payload})),"stats_update"===t.type&&l(e=>({...e,...t.payload})),"notification"===t.type&&m(e=>[t.payload,...e.slice(0,9)])},()=>e.close()},w=e=>{switch(e){case"healthy":case"online":return"text-green-400";case"warning":return"text-yellow-400";case"critical":case"offline":return"text-red-400";case"maintenance":return"text-blue-400";default:return"text-gray-400"}};return h?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:e.jsx("div",{className:"backdrop-blur-xl bg-white/10 rounded-2xl p-8 border border-white/20",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Gs,{className:"w-6 h-6 text-purple-400 animate-spin"}),e.jsx("span",{className:"text-white font-medium",children:"Loading Admin Dashboard..."})]})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900",children:[e.jsx("div",{className:"fixed inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2260%22%20height%3D%2260%22%20viewBox%3D%220%200%2060%2060%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%239C92AC%22%20fill-opacity%3D%220.05%22%3E%3Ccircle%20cx%3D%227%22%20cy%3D%227%22%20r%3D%227%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-30"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("header",{className:"backdrop-blur-xl bg-white/5 border-b border-white/10 sticky top-0 z-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(Ds,{className:"w-4 h-4 text-white"})}),e.jsx("h1",{className:"text-xl font-bold text-white",children:"Admin Dashboard"})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-2 px-3 py-1 rounded-full bg-red-500/20 border border-red-500/30",children:[e.jsx(Qs,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:"text-red-400 text-sm font-medium",children:"Administrator Access"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:g,className:"p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors",title:"Refresh Data",children:e.jsx(Gs,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:t?.avatar||"/default-avatar.png",alt:t?.username||"Admin",className:"w-8 h-8 rounded-full border-2 border-white/20"}),e.jsxs("div",{className:"hidden md:block",children:[e.jsx("p",{className:"text-white text-sm font-medium",children:t?.username}),e.jsx("p",{className:"text-white/60 text-xs",children:"Administrator"})]})]})]})]})})}),e.jsx("nav",{className:"backdrop-blur-xl bg-white/5 border-b border-white/10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex space-x-8 overflow-x-auto py-4",children:y.map(t=>{const s=t.icon,i=a===t.id;return e.jsxs("button",{onClick:()=>n(t.id),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all whitespace-nowrap "+(i?"bg-white/20 text-white shadow-lg":"text-white/60 hover:text-white hover:bg-white/10"),children:[e.jsx(s,{className:"w-4 h-4"}),t.label]},t.id)})})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx(c,{mode:"wait",children:e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:"overview"===a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:o?.totalUsers?.toLocaleString()||"0"}),e.jsxs("p",{className:"text-green-400 text-xs mt-1",children:["+",o?.activeUsers24h||0," active today"]})]}),e.jsx(oi,{className:"w-8 h-8 text-purple-400"})]})}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"AI Tokens"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:o?.totalTokens?.toLocaleString()||"0"}),e.jsxs("p",{className:"text-blue-400 text-xs mt-1",children:[o?.dailyTokenTransactions||0," transactions today"]})]}),e.jsx(di,{className:"w-8 h-8 text-yellow-400"})]})}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"Game Sessions"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:o?.activeGameSessions||"0"}),e.jsxs("p",{className:"text-indigo-400 text-xs mt-1",children:[o?.totalGames||0," games available"]})]}),e.jsx(as,{className:"w-8 h-8 text-indigo-400"})]})}),e.jsx(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm font-medium",children:"System Health"}),e.jsx("p",{className:`text-2xl font-bold ${w(o?.systemHealth||"unknown")}`,children:o?.systemHealth?.toUpperCase()||"UNKNOWN"}),e.jsxs("p",{className:"text-orange-400 text-xs mt-1",children:[o?.pendingReports||0," pending reports"]})]}),e.jsx(Qs,{className:"w-8 h-8 text-emerald-400"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(r.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(vs,{className:"w-5 h-5"}),"System Status"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white/80",children:"AI Models"}),e.jsx("span",{className:`font-medium ${w(o?.aiModelStatus||"unknown")}`,children:o?.aiModelStatus?.toUpperCase()||"UNKNOWN"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white/80",children:"Discord Bot"}),e.jsx("span",{className:`font-medium ${w(o?.discordBotStatus||"unknown")}`,children:o?.discordBotStatus?.toUpperCase()||"UNKNOWN"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white/80",children:"Database"}),e.jsx("span",{className:"font-medium text-green-400",children:"HEALTHY"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white/80",children:"API Gateway"}),e.jsx("span",{className:"font-medium text-green-400",children:"ONLINE"})]})]})]}),e.jsxs(r.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.5},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5"}),"Recent Notifications"]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:u.length>0?u.map((t,s)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-white/5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full mt-2 "+("high"===t.priority?"bg-red-400":"medium"===t.priority?"bg-yellow-400":"bg-green-400")}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white text-sm font-medium truncate",children:t.title}),e.jsx("p",{className:"text-white/60 text-xs mt-1",children:t.message}),e.jsx("p",{className:"text-white/40 text-xs mt-1",children:new Date(t.timestamp).toLocaleString()})]})]},s)):e.jsx("p",{className:"text-white/60 text-sm",children:"No recent notifications"})})]})]}),e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-6 border border-white/20",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("button",{onClick:()=>n("users"),className:"flex items-center gap-2 p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[e.jsx(oi,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{className:"text-white text-sm font-medium",children:"Manage Users"})]}),e.jsxs("button",{onClick:()=>n("economy"),className:"flex items-center gap-2 p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[e.jsx(ws,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{className:"text-white text-sm font-medium",children:"Economy Tools"})]}),e.jsxs("button",{onClick:()=>n("monitoring"),className:"flex items-center gap-2 p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[e.jsx(Ps,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-white text-sm font-medium",children:"System Monitor"})]}),e.jsxs("button",{onClick:()=>n("audit"),className:"flex items-center gap-2 p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[e.jsx(Ns,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-white text-sm font-medium",children:"View Logs"})]})]})]})]}):(()=>{const s=y.find(e=>e.id===a)?.component;return s?e.jsx(s,{user:t,permissions:i,realTimeData:p,onNotification:e=>{m(t=>[e,...t.slice(0,9)])}}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ns,{className:"w-12 h-12 text-yellow-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Component Not Found"}),e.jsx("p",{className:"text-white/60",children:"This admin section is under development."})]})})()},a)})})]})]})},Un=()=>e.jsx(Mn,{children:e.jsx(Fn,{})}),Fn=()=>{const{user:t,isAuthenticated:i,isLoading:a,checkSession:n}=Cn(),[o,c]=s.useState(null);return s.useEffect(()=>{(async()=>{if(i&&t){const e=await n();c(e)}})()},[i,t,n]),a?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:e.jsxs(r.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-8 border border-white/20 text-center",children:[e.jsx(Bs,{className:"w-12 h-12 text-purple-400 animate-spin mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Initializing Admin System"}),e.jsx("p",{className:"text-white/60",children:"Verifying credentials and loading dashboard..."})]})}):i&&!1===o?e.jsx(qn,{}):i&&t?t.isAdmin?e.jsx(zn,{user:t,permissions:t.permissions}):e.jsx(Hn,{}):e.jsx(An,{onLoginSuccess:()=>window.location.reload()})},qn=()=>{const{logout:t}=Cn();return s.useEffect(()=>{const e=setTimeout(()=>{t()},3e3);return()=>clearTimeout(e)},[t]),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-8 border border-white/20 text-center max-w-md",children:[e.jsx(ns,{className:"w-16 h-16 text-orange-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Session Expired"}),e.jsx("p",{className:"text-white/60 mb-6",children:"Your admin session has expired for security reasons. You will be redirected to the login page."}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-white/40 text-sm",children:[e.jsx(Bs,{className:"w-4 h-4 animate-spin"}),"Redirecting in 3 seconds..."]})]})})},Hn=()=>e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"backdrop-blur-xl bg-white/10 rounded-2xl p-8 border border-white/20 text-center max-w-md",children:[e.jsx(Qs,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-white/60 mb-6",children:"You do not have administrative privileges to access this section. Please contact a system administrator if you believe this is an error."}),e.jsxs("div",{className:"space-y-2 text-sm text-white/40",children:[e.jsx("p",{children:"• Administrative access is required"}),e.jsx("p",{children:"• All access attempts are logged"}),e.jsx("p",{children:"• Contact your system administrator for access"})]}),e.jsx("button",{onClick:()=>window.history.back(),className:"mt-6 px-6 py-2 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg text-white transition-colors",children:"Go Back"})]})});function $n(){const t=ze();return e.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:e.jsxs(r.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},className:"glass-card p-8 text-center max-w-md w-full",children:[e.jsx(r.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},className:"text-8xl font-bold bg-gradient-to-r from-blue-400 to-purple-600 bg-clip-text text-transparent mb-4",children:"404"}),e.jsx(r.h1,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},className:"text-2xl font-bold text-white mb-4",children:"Page Not Found"}),e.jsx(r.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4},className:"text-gray-300 mb-8 leading-relaxed",children:"The page you're looking for doesn't exist or has been moved."}),e.jsxs(r.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5},className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:()=>t(-1),className:"btn-secondary flex items-center justify-center gap-2",children:[e.jsx(rs,{className:"w-4 h-4"}),"Go Back"]}),e.jsxs("button",{onClick:()=>t("/"),className:"btn-primary flex items-center justify-center gap-2",children:[e.jsx(_s,{className:"w-4 h-4"}),"Go Home"]})]})]})})}function Gn({message:t="Loading Opure...",progress:s}){return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900/20 to-blue-900/20 flex items-center justify-center p-4",children:e.jsxs(r.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},className:"glass-card p-8 text-center max-w-sm w-full",children:[e.jsx(r.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"w-16 h-16 mx-auto mb-6 rounded-full bg-gradient-to-br from-blue-400 to-purple-600 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 bg-white rounded-full opacity-80"})}),e.jsx(r.h2,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-xl font-semibold mb-4 text-white",children:t}),"number"==typeof s&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"w-full bg-white/20 rounded-full h-2 overflow-hidden",children:e.jsx(r.div,{initial:{width:0},animate:{width:`${Math.min(100,Math.max(0,s))}%`},transition:{duration:.3},className:"h-full bg-gradient-to-r from-blue-400 to-purple-600 rounded-full"})}),e.jsxs("p",{className:"text-sm text-white/70 mt-2",children:[Math.round(s),"%"]})]}),e.jsx("div",{className:"flex justify-center space-x-1",children:[0,1,2].map(t=>e.jsx(r.div,{animate:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0,delay:.2*t},className:"w-2 h-2 bg-blue-400 rounded-full"},t))}),e.jsx(r.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},className:"text-xs text-white/60 mt-4",children:"Connecting to Discord..."})]})})}const Wn={initial:{opacity:0,scale:.95,filter:"blur(10px)"},in:{opacity:1,scale:1,filter:"blur(0px)"},out:{opacity:0,scale:1.05,filter:"blur(10px)"}},Vn={type:"tween",ease:"anticipate",duration:.4};function Kn(){const t=Le(),{isLoading:s,discordSdk:i,user:a}=mi();return s?e.jsx(Gn,{}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 overflow-hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2260%22%20height%3D%2260%22%20viewBox%3D%220%200%2060%2060%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%239C92AC%22%20fill-opacity%3D%220.05%22%3E%3Ccircle%20cx%3D%227%22%20cy%3D%227%22%20r%3D%227%22/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-30"}),e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx(r.div,{animate:{x:[0,100,0],y:[0,-100,0]},transition:{duration:20,repeat:1/0,ease:"linear"},className:"absolute top-1/4 left-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl"}),e.jsx(r.div,{animate:{x:[0,-150,0],y:[0,150,0]},transition:{duration:25,repeat:1/0,ease:"linear"},className:"absolute bottom-1/4 right-1/4 w-80 h-80 bg-blue-500/10 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"relative z-10 min-h-screen",children:[e.jsx("nav",{className:"fixed top-0 left-0 right-0 z-50 backdrop-blur-xl bg-white/5 border-b border-white/10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs(r.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"O"})}),e.jsx("span",{className:"text-white font-semibold text-lg",children:"Opure"})]}),a&&e.jsxs(r.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"flex items-center space-x-3",children:[e.jsx("img",{src:a.avatar?`https://cdn.discordapp.com/avatars/${a.id}/${a.avatar}.png?size=64`:"/default-avatar.png",alt:a.username,className:"w-8 h-8 rounded-full border-2 border-white/20"}),e.jsx("span",{className:"text-white/90 text-sm font-medium",children:a.username})]})]})})}),e.jsx("div",{className:"pt-16 pb-safe",children:e.jsx(c,{mode:"wait",children:e.jsx(r.div,{initial:"initial",animate:"in",exit:"out",variants:Wn,transition:Vn,className:"min-h-screen",children:e.jsxs(Je,{location:t,children:[e.jsx(Qe,{path:"/",element:e.jsx(fi,{})}),e.jsx(Qe,{path:"/games",element:e.jsx(Sn,{})}),e.jsx(Qe,{path:"/music",element:e.jsx(xi,{})}),e.jsx(Qe,{path:"/settings",element:e.jsx(yi,{})}),e.jsx(Qe,{path:"/admin",element:e.jsx(Un,{})}),e.jsx(Qe,{path:"*",element:e.jsx($n,{})})]})},t.pathname)})}),e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-50 backdrop-blur-xl bg-white/5 border-t border-white/10 pb-safe",children:e.jsx("div",{className:"flex items-center justify-around py-2",children:[{path:"/",icon:"🏠",label:"Home"},{path:"/games",icon:"🎮",label:"Games"},{path:"/music",icon:"🎵",label:"Music"},{path:"/settings",icon:"⚙️",label:"Settings"},{path:"/admin",icon:"🛡️",label:"Admin",adminOnly:!0}].filter(e=>!e.adminOnly||a&&a.admin).map(({path:s,icon:i,label:a})=>e.jsxs(r.a,{href:s,whileHover:{scale:1.1},whileTap:{scale:.95},className:"flex flex-col items-center space-y-1 px-4 py-2 rounded-xl transition-colors "+(t.pathname===s?"bg-white/10 text-white":"text-white/60 hover:text-white/80"),children:[e.jsx("span",{className:"text-xl",children:i}),e.jsx("span",{className:"text-xs font-medium",children:a})]},s))})})]})]})}const Qn=s.createContext(null),Yn=({children:t})=>{const[i,a]=s.useState(null),[n,r]=s.useState(!1),[o,c]=s.useState(!1),[l,h]=s.useState(0),[d,u]=s.useState(0),[m,p]=s.useState(.8),[f,x]=s.useState(null),[y,g]=s.useState([]),[b,v]=s.useState([]),[w,j]=s.useState(null),[S,N]=s.useState(!1),[k,M]=s.useState(!1),[C,A]=s.useState(0),T=s.useRef(null),P=s.useRef(null),_=s.useRef(null),E=s.useRef(null);s.useEffect(()=>((()=>{try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createAnalyser();t.fftSize=256,P.current=e,_.current=t}catch(e){}})(),(()=>{const e=sn("https://api.opure.uk",{autoConnect:!0});e.on("connect",()=>{}),e.on("playlistUpdate",e=>{g(t=>{const s=t.findIndex(t=>t.id===e.id);if(s>=0){const i=[...t];return i[s]=e,i}return[...t,e]})}),E.current=e})(),()=>{E.current&&E.current.disconnect(),P.current&&P.current.close()}),[]),s.useEffect(()=>{if(!S||!_.current)return;const e=()=>{if(_.current){const e=_.current.frequencyBinCount,t=new Uint8Array(e);_.current.getByteFrequencyData(t),j(t)}S&&requestAnimationFrame(e)};e()},[S]);const B=async e=>{if(e&&a(e),T.current)try{await T.current.play(),r(!0),c(!1)}catch(t){}},D=()=>{if(b.length>0){const e=b[0];v(e=>e.slice(1)),B(e)}},R={currentTrack:i,isPlaying:n,isPaused:o,currentTime:l,duration:d,volume:m,currentPlaylist:f,playlists:y,queue:b,audioData:w,isVisualizerActive:S,play:B,pause:()=>{T.current&&(T.current.pause(),r(!1),c(!0))},stop:()=>{T.current&&(T.current.pause(),T.current.currentTime=0,r(!1),c(!1),h(0))},next:D,previous:()=>{},seek:e=>{T.current&&(T.current.currentTime=e,h(e))},setVolume:e=>{p(e),T.current&&(T.current.volume=e)},createPlaylist:async e=>{const t={id:`playlist_${Date.now()}`,name:e,tracks:[],createdBy:"current_user",isPublic:!1};return g(e=>[...e,t]),E.current&&E.current.emit("createPlaylist",t),t},addToPlaylist:(e,t)=>{g(s=>s.map(s=>s.id===e?{...s,tracks:[...s.tracks,t]}:s)),E.current&&E.current.emit("addToPlaylist",{playlistId:e,track:t})},removeFromPlaylist:(e,t)=>{g(s=>s.map(s=>s.id===e?{...s,tracks:s.tracks.filter(e=>e.id!==t)}:s)),E.current&&E.current.emit("removeFromPlaylist",{playlistId:e,trackId:t})},loadPlaylist:e=>{x(e),v(e.tracks)},addToQueue:e=>{v(t=>[...t,e])},removeFromQueue:e=>{v(t=>t.filter(t=>t.id!==e))},clearQueue:()=>{v([])},toggleVisualizer:()=>{N(e=>!e)},isDjMode:k,toggleDjMode:()=>{M(e=>!e)},crossfadeValue:C,setCrossfadeValue:A};return e.jsxs(Qn.Provider,{value:R,children:[t,e.jsx("audio",{ref:T,onTimeUpdate:()=>h(T.current?.currentTime||0),onLoadedMetadata:()=>u(T.current?.duration||0),onEnded:D,style:{display:"none"}})]})},Jn=new class{#b;#f;#h;#v;#w;#j;#S;#N;constructor(e={}){this.#b=e.queryCache||new I,this.#f=e.mutationCache||new U,this.#h=e.defaultOptions||{},this.#v=new Map,this.#w=new Map,this.#j=0}mount(){this.#j++,1===this.#j&&(this.#S=C.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#b.onFocus())}),this.#N=A.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#b.onOnline())}))}unmount(){this.#j--,0===this.#j&&(this.#S?.(),this.#S=void 0,this.#N?.(),this.#N=void 0)}isFetching(e){return this.#b.findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return this.#f.findAll({...e,status:"pending"}).length}getQueryData(e){const t=this.defaultQueryOptions({queryKey:e});return this.#b.get(t.queryHash)?.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),s=this.#b.build(this,t),i=s.state.data;return void 0===i?this.fetchQuery(e):(e.revalidateIfStale&&s.isStaleByTime(u(t.staleTime,s))&&this.prefetchQuery(t),Promise.resolve(i))}getQueriesData(e){return this.#b.findAll(e).map(({queryKey:e,state:t})=>[e,t.data])}setQueryData(e,t,s){const i=this.defaultQueryOptions({queryKey:e}),a=this.#b.get(i.queryHash),n=a?.state.data,r=function(e,t){return"function"==typeof e?e(t):e}(t,n);if(void 0!==r)return this.#b.build(this,i).setData(r,{...s,manual:!0})}setQueriesData(e,t,s){return R.batch(()=>this.#b.findAll(e).map(({queryKey:e})=>[e,this.setQueryData(e,t,s)]))}getQueryState(e){const t=this.defaultQueryOptions({queryKey:e});return this.#b.get(t.queryHash)?.state}removeQueries(e){const t=this.#b;R.batch(()=>{t.findAll(e).forEach(e=>{t.remove(e)})})}resetQueries(e,t){const s=this.#b;return R.batch(()=>(s.findAll(e).forEach(e=>{e.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const s={revert:!0,...t},i=R.batch(()=>this.#b.findAll(e).map(e=>e.cancel(s)));return Promise.all(i).then(d).catch(d)}invalidateQueries(e,t={}){return R.batch(()=>(this.#b.findAll(e).forEach(e=>{e.invalidate()}),"none"===e?.refetchType?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},t)))}refetchQueries(e,t={}){const s={...t,cancelRefetch:t.cancelRefetch??!0},i=R.batch(()=>this.#b.findAll(e).filter(e=>!e.isDisabled()&&!e.isStatic()).map(e=>{let t=e.fetch(void 0,s);return s.throwOnError||(t=t.catch(d)),"paused"===e.state.fetchStatus?Promise.resolve():t}));return Promise.all(i).then(d)}fetchQuery(e){const t=this.defaultQueryOptions(e);void 0===t.retry&&(t.retry=!1);const s=this.#b.build(this,t);return s.isStaleByTime(u(t.staleTime,s))?s.fetch(t):Promise.resolve(s.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(d).catch(d)}fetchInfiniteQuery(e){return e.behavior=q(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(d).catch(d)}ensureInfiniteQueryData(e){return e.behavior=q(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return A.isOnline()?this.#f.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#b}getMutationCache(){return this.#f}getDefaultOptions(){return this.#h}setDefaultOptions(e){this.#h=e}setQueryDefaults(e,t){this.#v.set(x(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...this.#v.values()],s={};return t.forEach(t=>{y(e,t.queryKey)&&Object.assign(s,t.defaultOptions)}),s}setMutationDefaults(e,t){this.#w.set(x(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...this.#w.values()],s={};return t.forEach(t=>{y(e,t.mutationKey)&&Object.assign(s,t.defaultOptions)}),s}defaultQueryOptions(e){if(e._defaulted)return e;const t={...this.#h.queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=f(t.queryKey,t)),void 0===t.refetchOnReconnect&&(t.refetchOnReconnect="always"!==t.networkMode),void 0===t.throwOnError&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===k&&(t.enabled=!1),t}defaultMutationOptions(e){return e?._defaulted?e:{...this.#h.mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){this.#b.clear(),this.#f.clear()}}({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1}}});t.createRoot(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(K,{client:Jn,children:e.jsx(et,{children:e.jsx(pi,{children:e.jsxs(Yn,{children:[e.jsx(Kn,{}),e.jsx(ts,{position:"top-right",toastOptions:{duration:4e3,style:{background:"rgba(17, 24, 39, 0.95)",color:"#ffffff",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"12px"}}})]})})})})}));
